/**
 * @license
 * PlayCanvas Engine v1.58.0 revision 6672f604c (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { Debug } from '../../core/debug.js';
import { CULLFACE_NONE, CULLFACE_BACK, CULLFACE_FRONT, CULLFACE_FRONTANDBACK, FUNC_NEVER, FUNC_LESS, FUNC_EQUAL, FUNC_LESSEQUAL, FUNC_GREATER, FUNC_NOTEQUAL, FUNC_GREATEREQUAL, FUNC_ALWAYS } from '../../platform/graphics/constants.js';
import { Texture } from '../../platform/graphics/texture.js';
import { SPECOCC_NONE, SPECOCC_AO, SPECOCC_GLOSSDEPENDENT, BLEND_SUBTRACTIVE, BLEND_ADDITIVE, BLEND_NORMAL, BLEND_NONE, BLEND_PREMULTIPLIED, BLEND_MULTIPLICATIVE, BLEND_ADDITIVEALPHA, BLEND_MULTIPLICATIVE2X, BLEND_SCREEN, BLEND_MIN, BLEND_MAX, SPECULAR_PHONG, SPECULAR_BLINN } from '../constants.js';
import { standardMaterialParameterTypes, standardMaterialRemovedParameters } from './standard-material-parameters.js';

class StandardMaterialValidator {
  constructor() {
    this.removeInvalid = true;
    this.valid = true;

    this.enumValidators = {
      occludeSpecular: this._createEnumValidator([SPECOCC_NONE, SPECOCC_AO, SPECOCC_GLOSSDEPENDENT]),
      cull: this._createEnumValidator([CULLFACE_NONE, CULLFACE_BACK, CULLFACE_FRONT, CULLFACE_FRONTANDBACK]),
      blendType: this._createEnumValidator([BLEND_SUBTRACTIVE, BLEND_ADDITIVE, BLEND_NORMAL, BLEND_NONE, BLEND_PREMULTIPLIED, BLEND_MULTIPLICATIVE, BLEND_ADDITIVEALPHA, BLEND_MULTIPLICATIVE2X, BLEND_SCREEN, BLEND_MIN, BLEND_MAX]),
      depthFunc: this._createEnumValidator([FUNC_NEVER, FUNC_LESS, FUNC_EQUAL, FUNC_LESSEQUAL, FUNC_GREATER, FUNC_NOTEQUAL, FUNC_GREATEREQUAL, FUNC_ALWAYS]),
      shadingModel: this._createEnumValidator([SPECULAR_PHONG, SPECULAR_BLINN])
    };
  }
  setInvalid(key, data) {
    this.valid = false;
    Debug.warn(`Ignoring invalid StandardMaterial property: ${key}`, data[key]);
    if (this.removeInvalid) {
      delete data[key];
    }
  }
  validate(data) {

    const TYPES = standardMaterialParameterTypes;
    const REMOVED = standardMaterialRemovedParameters;
    const pathMapping = data.mappingFormat === 'path';
    for (const key in data) {
      const type = TYPES[key];
      if (!type) {
        if (REMOVED[key]) {
          delete data[key];
        } else {
          Debug.warn(`Ignoring unsupported input property to standard material: ${key}`);
          this.valid = false;
        }
        continue;
      }
      if (type.startsWith('enum')) {
        const enumType = type.split(':')[1];
        if (this.enumValidators[enumType]) {
          if (!this.enumValidators[enumType](data[key])) {
            this.setInvalid(key, data);
          }
        }
      } else if (type === 'number') {
        if (typeof data[key] !== 'number') {
          this.setInvalid(key, data);
        }
      } else if (type === 'boolean') {
        if (typeof data[key] !== 'boolean') {
          this.setInvalid(key, data);
        }
      } else if (type === 'string') {
        if (typeof data[key] !== 'string') {
          this.setInvalid(key, data);
        }
      } else if (type === 'vec2') {
        if (!(data[key] instanceof Array && data[key].length === 2)) {
          this.setInvalid(key, data);
        }
      } else if (type === 'rgb') {
        if (!(data[key] instanceof Array && data[key].length === 3)) {
          this.setInvalid(key, data);
        }
      } else if (type === 'texture') {
        if (!pathMapping) {
          if (!(typeof data[key] === 'number' || data[key] === null)) {
            if (!(data[key] instanceof Texture)) {
              this.setInvalid(key, data);
            }
          }
        } else {
          if (!(typeof data[key] === 'string' || data[key] === null)) {
            if (!(data[key] instanceof Texture)) {
              this.setInvalid(key, data);
            }
          }
        }
      } else if (type === 'boundingbox') {
        if (!(data[key].center && data[key].center instanceof Array && data[key].center.length === 3)) {
          this.setInvalid(key, data);
        }
        if (!(data[key].halfExtents && data[key].halfExtents instanceof Array && data[key].halfExtents.length === 3)) {
          this.setInvalid(key, data);
        }
      } else if (type === 'cubemap') {
        if (!(typeof data[key] === 'number' || data[key] === null || data[key] === undefined)) {
          if (!(data[key] instanceof Texture && data[key].cubemap)) {
            this.setInvalid(key, data);
          }
        }
      } else if (type === 'chunks') {
        const chunkNames = Object.keys(data[key]);
        for (let i = 0; i < chunkNames.length; i++) {
          if (typeof data[key][chunkNames[i]] !== 'string') {
            this.setInvalid(chunkNames[i], data[key]);
          }
        }
      } else {
        console.error('Unknown material type: ' + type);
      }
    }

    data.validated = true;
    return this.valid;
  }
  _createEnumValidator(values) {
    return function (value) {
      return values.indexOf(value) >= 0;
    };
  }
}

export { StandardMaterialValidator };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhbmRhcmQtbWF0ZXJpYWwtdmFsaWRhdG9yLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvc2NlbmUvbWF0ZXJpYWxzL3N0YW5kYXJkLW1hdGVyaWFsLXZhbGlkYXRvci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEZWJ1ZyB9IGZyb20gJy4uLy4uL2NvcmUvZGVidWcuanMnO1xuaW1wb3J0IHtcbiAgICBDVUxMRkFDRV9CQUNLLCBDVUxMRkFDRV9GUk9OVCwgQ1VMTEZBQ0VfRlJPTlRBTkRCQUNLLCBDVUxMRkFDRV9OT05FLFxuICAgIEZVTkNfTkVWRVIsIEZVTkNfTEVTUywgRlVOQ19FUVVBTCwgRlVOQ19MRVNTRVFVQUwsIEZVTkNfR1JFQVRFUiwgRlVOQ19OT1RFUVVBTCxcbiAgICBGVU5DX0dSRUFURVJFUVVBTCwgRlVOQ19BTFdBWVNcbn0gZnJvbSAnLi4vLi4vcGxhdGZvcm0vZ3JhcGhpY3MvY29uc3RhbnRzLmpzJztcbmltcG9ydCB7IFRleHR1cmUgfSBmcm9tICcuLi8uLi9wbGF0Zm9ybS9ncmFwaGljcy90ZXh0dXJlLmpzJztcblxuaW1wb3J0IHtcbiAgICBTUEVDT0NDX0FPLCBTUEVDT0NDX0dMT1NTREVQRU5ERU5ULCBTUEVDT0NDX05PTkUsXG4gICAgQkxFTkRfU1VCVFJBQ1RJVkUsIEJMRU5EX0FERElUSVZFLCBCTEVORF9OT1JNQUwsIEJMRU5EX05PTkUsIEJMRU5EX1BSRU1VTFRJUExJRUQsXG4gICAgQkxFTkRfTVVMVElQTElDQVRJVkUsIEJMRU5EX0FERElUSVZFQUxQSEEsIEJMRU5EX01VTFRJUExJQ0FUSVZFMlgsIEJMRU5EX1NDUkVFTixcbiAgICBCTEVORF9NSU4sIEJMRU5EX01BWCxcbiAgICBTUEVDVUxBUl9CTElOTiwgU1BFQ1VMQVJfUEhPTkdcbn0gZnJvbSAnLi4vY29uc3RhbnRzLmpzJztcblxuaW1wb3J0IHsgc3RhbmRhcmRNYXRlcmlhbFBhcmFtZXRlclR5cGVzLCBzdGFuZGFyZE1hdGVyaWFsUmVtb3ZlZFBhcmFtZXRlcnMgfSBmcm9tICcuL3N0YW5kYXJkLW1hdGVyaWFsLXBhcmFtZXRlcnMuanMnO1xuXG5jbGFzcyBTdGFuZGFyZE1hdGVyaWFsVmFsaWRhdG9yIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5yZW1vdmVJbnZhbGlkID0gdHJ1ZTtcblxuICAgICAgICB0aGlzLnZhbGlkID0gdHJ1ZTsgLy8gc3RhcnQgb2ZmIHZhbGlkXG5cbiAgICAgICAgdGhpcy5lbnVtVmFsaWRhdG9ycyA9IHtcbiAgICAgICAgICAgIG9jY2x1ZGVTcGVjdWxhcjogdGhpcy5fY3JlYXRlRW51bVZhbGlkYXRvcihbXG4gICAgICAgICAgICAgICAgU1BFQ09DQ19OT05FLFxuICAgICAgICAgICAgICAgIFNQRUNPQ0NfQU8sXG4gICAgICAgICAgICAgICAgU1BFQ09DQ19HTE9TU0RFUEVOREVOVFxuICAgICAgICAgICAgXSksXG4gICAgICAgICAgICBjdWxsOiB0aGlzLl9jcmVhdGVFbnVtVmFsaWRhdG9yKFtcbiAgICAgICAgICAgICAgICBDVUxMRkFDRV9OT05FLFxuICAgICAgICAgICAgICAgIENVTExGQUNFX0JBQ0ssXG4gICAgICAgICAgICAgICAgQ1VMTEZBQ0VfRlJPTlQsXG4gICAgICAgICAgICAgICAgQ1VMTEZBQ0VfRlJPTlRBTkRCQUNLXG4gICAgICAgICAgICBdKSxcbiAgICAgICAgICAgIGJsZW5kVHlwZTogdGhpcy5fY3JlYXRlRW51bVZhbGlkYXRvcihbXG4gICAgICAgICAgICAgICAgQkxFTkRfU1VCVFJBQ1RJVkUsXG4gICAgICAgICAgICAgICAgQkxFTkRfQURESVRJVkUsXG4gICAgICAgICAgICAgICAgQkxFTkRfTk9STUFMLFxuICAgICAgICAgICAgICAgIEJMRU5EX05PTkUsXG4gICAgICAgICAgICAgICAgQkxFTkRfUFJFTVVMVElQTElFRCxcbiAgICAgICAgICAgICAgICBCTEVORF9NVUxUSVBMSUNBVElWRSxcbiAgICAgICAgICAgICAgICBCTEVORF9BRERJVElWRUFMUEhBLFxuICAgICAgICAgICAgICAgIEJMRU5EX01VTFRJUExJQ0FUSVZFMlgsXG4gICAgICAgICAgICAgICAgQkxFTkRfU0NSRUVOLFxuICAgICAgICAgICAgICAgIEJMRU5EX01JTixcbiAgICAgICAgICAgICAgICBCTEVORF9NQVhcbiAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgZGVwdGhGdW5jOiB0aGlzLl9jcmVhdGVFbnVtVmFsaWRhdG9yKFtcbiAgICAgICAgICAgICAgICBGVU5DX05FVkVSLFxuICAgICAgICAgICAgICAgIEZVTkNfTEVTUyxcbiAgICAgICAgICAgICAgICBGVU5DX0VRVUFMLFxuICAgICAgICAgICAgICAgIEZVTkNfTEVTU0VRVUFMLFxuICAgICAgICAgICAgICAgIEZVTkNfR1JFQVRFUixcbiAgICAgICAgICAgICAgICBGVU5DX05PVEVRVUFMLFxuICAgICAgICAgICAgICAgIEZVTkNfR1JFQVRFUkVRVUFMLFxuICAgICAgICAgICAgICAgIEZVTkNfQUxXQVlTXG4gICAgICAgICAgICBdKSxcbiAgICAgICAgICAgIHNoYWRpbmdNb2RlbDogdGhpcy5fY3JlYXRlRW51bVZhbGlkYXRvcihbXG4gICAgICAgICAgICAgICAgU1BFQ1VMQVJfUEhPTkcsXG4gICAgICAgICAgICAgICAgU1BFQ1VMQVJfQkxJTk5cbiAgICAgICAgICAgIF0pXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgc2V0SW52YWxpZChrZXksIGRhdGEpIHtcbiAgICAgICAgdGhpcy52YWxpZCA9IGZhbHNlO1xuXG4gICAgICAgIERlYnVnLndhcm4oYElnbm9yaW5nIGludmFsaWQgU3RhbmRhcmRNYXRlcmlhbCBwcm9wZXJ0eTogJHtrZXl9YCwgZGF0YVtrZXldKTtcblxuICAgICAgICBpZiAodGhpcy5yZW1vdmVJbnZhbGlkKSB7XG4gICAgICAgICAgICBkZWxldGUgZGF0YVtrZXldO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgdmFsaWRhdGUoZGF0YSkge1xuICAgICAgICAvLyB2YWxpZGF0ZSBpbnB1dCBkYXRhIGFnYWluc3QgZGVmaW5lZCBzdGFuZGFyZC1tYXRlcmlhbCBwcm9wZXJ0aWVzIGFuZCB0eXBlc1xcXG4gICAgICAgIC8vIGlmIHJlbW92ZUludmFsaWQgZmxhZyBpcyBzZXQgdG8gdHJ1ZSB0aGVuIHJlbW92ZSBpbnZhbGlkIHByb3BlcnRpZXMgZnJvbSBkYXRhXG5cbiAgICAgICAgY29uc3QgVFlQRVMgPSBzdGFuZGFyZE1hdGVyaWFsUGFyYW1ldGVyVHlwZXM7XG4gICAgICAgIGNvbnN0IFJFTU9WRUQgPSBzdGFuZGFyZE1hdGVyaWFsUmVtb3ZlZFBhcmFtZXRlcnM7XG5cbiAgICAgICAgY29uc3QgcGF0aE1hcHBpbmcgPSAoZGF0YS5tYXBwaW5nRm9ybWF0ID09PSAncGF0aCcpO1xuXG4gICAgICAgIGZvciAoY29uc3Qga2V5IGluIGRhdGEpIHtcbiAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBUWVBFU1trZXldO1xuXG4gICAgICAgICAgICBpZiAoIXR5cGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoUkVNT1ZFRFtrZXldKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBkYXRhW2tleV07XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgRGVidWcud2FybihgSWdub3JpbmcgdW5zdXBwb3J0ZWQgaW5wdXQgcHJvcGVydHkgdG8gc3RhbmRhcmQgbWF0ZXJpYWw6ICR7a2V5fWApO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnZhbGlkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodHlwZS5zdGFydHNXaXRoKCdlbnVtJykpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlbnVtVHlwZSA9IHR5cGUuc3BsaXQoJzonKVsxXTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5lbnVtVmFsaWRhdG9yc1tlbnVtVHlwZV0pIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmVudW1WYWxpZGF0b3JzW2VudW1UeXBlXShkYXRhW2tleV0pKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEludmFsaWQoa2V5LCBkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZGF0YVtrZXldICE9PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEludmFsaWQoa2V5LCBkYXRhKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZGF0YVtrZXldICE9PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRJbnZhbGlkKGtleSwgZGF0YSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZGF0YVtrZXldICE9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEludmFsaWQoa2V5LCBkYXRhKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICd2ZWMyJykge1xuICAgICAgICAgICAgICAgIGlmICghKGRhdGFba2V5XSBpbnN0YW5jZW9mIEFycmF5ICYmIGRhdGFba2V5XS5sZW5ndGggPT09IDIpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0SW52YWxpZChrZXksIGRhdGEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ3JnYicpIHtcbiAgICAgICAgICAgICAgICBpZiAoIShkYXRhW2tleV0gaW5zdGFuY2VvZiBBcnJheSAmJiBkYXRhW2tleV0ubGVuZ3RoID09PSAzKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEludmFsaWQoa2V5LCBkYXRhKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICd0ZXh0dXJlJykge1xuICAgICAgICAgICAgICAgIGlmICghcGF0aE1hcHBpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEodHlwZW9mIGRhdGFba2V5XSA9PT0gJ251bWJlcicgfHwgZGF0YVtrZXldID09PSBudWxsKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEoZGF0YVtrZXldIGluc3RhbmNlb2YgVGV4dHVyZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEludmFsaWQoa2V5LCBkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvLyBPVEhFUldJU0U6IG1hdGVyaWFscyBhcmUgb2Z0ZW4gaW5pdGlhbGl6ZWQgd2l0aCB0aGUgYXNzZXQgaWQgb2YgdGV4dHVyZXMgd2hpY2ggYXJlIGFzc2lnbmVkIGxhdGVyXG4gICAgICAgICAgICAgICAgICAgIC8vIHRoaXMgY291bnRzIGFzIGEgdmFsaWQgaW5wdXRcbiAgICAgICAgICAgICAgICAgICAgLy8gbnVsbCB0ZXh0dXJlIHJlZmVyZW5jZSBpcyBhbHNvIHZhbGlkXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEodHlwZW9mIGRhdGFba2V5XSA9PT0gJ3N0cmluZycgfHwgZGF0YVtrZXldID09PSBudWxsKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEoZGF0YVtrZXldIGluc3RhbmNlb2YgVGV4dHVyZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEludmFsaWQoa2V5LCBkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvLyBPVEhFUldJU0U6IGZwciBwYXRoIG1hcHBlZCB3ZSBleHBlY3QgYSBzdHJpbmcgbm90IGFuIGFzc2V0IGlkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnYm91bmRpbmdib3gnKSB7XG4gICAgICAgICAgICAgICAgaWYgKCEoZGF0YVtrZXldLmNlbnRlciAmJiBkYXRhW2tleV0uY2VudGVyIGluc3RhbmNlb2YgQXJyYXkgJiYgZGF0YVtrZXldLmNlbnRlci5sZW5ndGggPT09IDMpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0SW52YWxpZChrZXksIGRhdGEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIShkYXRhW2tleV0uaGFsZkV4dGVudHMgJiYgZGF0YVtrZXldLmhhbGZFeHRlbnRzIGluc3RhbmNlb2YgQXJyYXkgJiYgZGF0YVtrZXldLmhhbGZFeHRlbnRzLmxlbmd0aCA9PT0gMykpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRJbnZhbGlkKGtleSwgZGF0YSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnY3ViZW1hcCcpIHtcbiAgICAgICAgICAgICAgICBpZiAoISh0eXBlb2YgZGF0YVtrZXldID09PSAnbnVtYmVyJyB8fCBkYXRhW2tleV0gPT09IG51bGwgfHwgZGF0YVtrZXldID09PSB1bmRlZmluZWQpKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCEoZGF0YVtrZXldIGluc3RhbmNlb2YgVGV4dHVyZSAmJiBkYXRhW2tleV0uY3ViZW1hcCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0SW52YWxpZChrZXksIGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIE9USEVSV0lTRTogbWF0ZXJpYWxzIGFyZSBvZnRlbiBpbml0aWFsaXplZCB3aXRoIHRoZSBhc3NldCBpZCBvZiB0ZXh0dXJlcyB3aGljaCBhcmUgYXNzaWduZWQgbGF0ZXJcbiAgICAgICAgICAgICAgICAvLyB0aGlzIGNvdW50cyBhcyBhIHZhbGlkIGlucHV0XG4gICAgICAgICAgICAgICAgLy8gbnVsbCB0ZXh0dXJlIHJlZmVyZW5jZSBpcyBhbHNvIHZhbGlkXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdjaHVua3MnKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY2h1bmtOYW1lcyA9IE9iamVjdC5rZXlzKGRhdGFba2V5XSk7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjaHVua05hbWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZGF0YVtrZXldW2NodW5rTmFtZXNbaV1dICE9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRJbnZhbGlkKGNodW5rTmFtZXNbaV0sIGRhdGFba2V5XSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignVW5rbm93biBtYXRlcmlhbCB0eXBlOiAnICsgdHlwZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBtYXJrIGRhdGEgYXMgdmFsaWRhdGVkIHNvIHdlIGRvbid0IHZhbGlkYXRlIHR3aWNlXG4gICAgICAgIGRhdGEudmFsaWRhdGVkID0gdHJ1ZTtcblxuICAgICAgICByZXR1cm4gdGhpcy52YWxpZDtcbiAgICB9XG5cbiAgICBfY3JlYXRlRW51bVZhbGlkYXRvcih2YWx1ZXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgcmV0dXJuICh2YWx1ZXMuaW5kZXhPZih2YWx1ZSkgPj0gMCk7XG4gICAgICAgIH07XG4gICAgfVxufVxuXG5leHBvcnQgeyBTdGFuZGFyZE1hdGVyaWFsVmFsaWRhdG9yIH07XG4iXSwibmFtZXMiOlsiU3RhbmRhcmRNYXRlcmlhbFZhbGlkYXRvciIsImNvbnN0cnVjdG9yIiwicmVtb3ZlSW52YWxpZCIsInZhbGlkIiwiZW51bVZhbGlkYXRvcnMiLCJvY2NsdWRlU3BlY3VsYXIiLCJfY3JlYXRlRW51bVZhbGlkYXRvciIsIlNQRUNPQ0NfTk9ORSIsIlNQRUNPQ0NfQU8iLCJTUEVDT0NDX0dMT1NTREVQRU5ERU5UIiwiY3VsbCIsIkNVTExGQUNFX05PTkUiLCJDVUxMRkFDRV9CQUNLIiwiQ1VMTEZBQ0VfRlJPTlQiLCJDVUxMRkFDRV9GUk9OVEFOREJBQ0siLCJibGVuZFR5cGUiLCJCTEVORF9TVUJUUkFDVElWRSIsIkJMRU5EX0FERElUSVZFIiwiQkxFTkRfTk9STUFMIiwiQkxFTkRfTk9ORSIsIkJMRU5EX1BSRU1VTFRJUExJRUQiLCJCTEVORF9NVUxUSVBMSUNBVElWRSIsIkJMRU5EX0FERElUSVZFQUxQSEEiLCJCTEVORF9NVUxUSVBMSUNBVElWRTJYIiwiQkxFTkRfU0NSRUVOIiwiQkxFTkRfTUlOIiwiQkxFTkRfTUFYIiwiZGVwdGhGdW5jIiwiRlVOQ19ORVZFUiIsIkZVTkNfTEVTUyIsIkZVTkNfRVFVQUwiLCJGVU5DX0xFU1NFUVVBTCIsIkZVTkNfR1JFQVRFUiIsIkZVTkNfTk9URVFVQUwiLCJGVU5DX0dSRUFURVJFUVVBTCIsIkZVTkNfQUxXQVlTIiwic2hhZGluZ01vZGVsIiwiU1BFQ1VMQVJfUEhPTkciLCJTUEVDVUxBUl9CTElOTiIsInNldEludmFsaWQiLCJrZXkiLCJkYXRhIiwiRGVidWciLCJ3YXJuIiwidmFsaWRhdGUiLCJUWVBFUyIsInN0YW5kYXJkTWF0ZXJpYWxQYXJhbWV0ZXJUeXBlcyIsIlJFTU9WRUQiLCJzdGFuZGFyZE1hdGVyaWFsUmVtb3ZlZFBhcmFtZXRlcnMiLCJwYXRoTWFwcGluZyIsIm1hcHBpbmdGb3JtYXQiLCJ0eXBlIiwic3RhcnRzV2l0aCIsImVudW1UeXBlIiwic3BsaXQiLCJBcnJheSIsImxlbmd0aCIsIlRleHR1cmUiLCJjZW50ZXIiLCJoYWxmRXh0ZW50cyIsInVuZGVmaW5lZCIsImN1YmVtYXAiLCJjaHVua05hbWVzIiwiT2JqZWN0Iiwia2V5cyIsImkiLCJjb25zb2xlIiwiZXJyb3IiLCJ2YWxpZGF0ZWQiLCJ2YWx1ZXMiLCJ2YWx1ZSIsImluZGV4T2YiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBa0JBLE1BQU1BLHlCQUF5QixDQUFDO0FBQzVCQyxFQUFBQSxXQUFXLEdBQUc7SUFDVixJQUFJLENBQUNDLGFBQWEsR0FBRyxJQUFJLENBQUE7SUFFekIsSUFBSSxDQUFDQyxLQUFLLEdBQUcsSUFBSSxDQUFBOztJQUVqQixJQUFJLENBQUNDLGNBQWMsR0FBRztBQUNsQkMsTUFBQUEsZUFBZSxFQUFFLElBQUksQ0FBQ0Msb0JBQW9CLENBQUMsQ0FDdkNDLFlBQVksRUFDWkMsVUFBVSxFQUNWQyxzQkFBc0IsQ0FDekIsQ0FBQztBQUNGQyxNQUFBQSxJQUFJLEVBQUUsSUFBSSxDQUFDSixvQkFBb0IsQ0FBQyxDQUM1QkssYUFBYSxFQUNiQyxhQUFhLEVBQ2JDLGNBQWMsRUFDZEMscUJBQXFCLENBQ3hCLENBQUM7QUFDRkMsTUFBQUEsU0FBUyxFQUFFLElBQUksQ0FBQ1Qsb0JBQW9CLENBQUMsQ0FDakNVLGlCQUFpQixFQUNqQkMsY0FBYyxFQUNkQyxZQUFZLEVBQ1pDLFVBQVUsRUFDVkMsbUJBQW1CLEVBQ25CQyxvQkFBb0IsRUFDcEJDLG1CQUFtQixFQUNuQkMsc0JBQXNCLEVBQ3RCQyxZQUFZLEVBQ1pDLFNBQVMsRUFDVEMsU0FBUyxDQUNaLENBQUM7TUFDRkMsU0FBUyxFQUFFLElBQUksQ0FBQ3JC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
