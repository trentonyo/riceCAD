/**
 * @license
 * PlayCanvas Engine v1.58.0 revision 6672f604c (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { platform } from '../core/platform.js';
import { WebglGraphicsDevice } from '../platform/graphics/webgl/webgl-graphics-device.js';
import { SoundManager } from '../platform/sound/manager.js';
import { Lightmapper } from './lightmapper/lightmapper.js';
import { BatchManager } from '../scene/batching/batch-manager.js';
import { AppBase } from './app-base.js';
import { AppOptions } from './app-options.js';
import { script } from './script.js';
import { AnimationComponentSystem } from './components/animation/system.js';
import { AnimComponentSystem } from './components/anim/system.js';
import { AudioListenerComponentSystem } from './components/audio-listener/system.js';
import { AudioSourceComponentSystem } from './components/audio-source/system.js';
import { ButtonComponentSystem } from './components/button/system.js';
import { CollisionComponentSystem } from './components/collision/system.js';
import { ElementComponentSystem } from './components/element/system.js';
import { JointComponentSystem } from './components/joint/system.js';
import { LayoutChildComponentSystem } from './components/layout-child/system.js';
import { LayoutGroupComponentSystem } from './components/layout-group/system.js';
import { ModelComponentSystem } from './components/model/system.js';
import { ParticleSystemComponentSystem } from './components/particle-system/system.js';
import { RenderComponentSystem } from './components/render/system.js';
import { RigidBodyComponentSystem } from './components/rigid-body/system.js';
import { ScreenComponentSystem } from './components/screen/system.js';
import { ScriptLegacyComponentSystem } from './components/script-legacy/system.js';
import { ScrollViewComponentSystem } from './components/scroll-view/system.js';
import { ScrollbarComponentSystem } from './components/scrollbar/system.js';
import { SoundComponentSystem } from './components/sound/system.js';
import { SpriteComponentSystem } from './components/sprite/system.js';
import { ZoneComponentSystem } from './components/zone/system.js';
import { CameraComponentSystem } from './components/camera/system.js';
import { LightComponentSystem } from './components/light/system.js';
import { ScriptComponentSystem } from './components/script/system.js';
import { RenderHandler } from './handlers/render.js';
import { AnimationHandler } from './handlers/animation.js';
import { AnimClipHandler } from './handlers/anim-clip.js';
import { AnimStateGraphHandler } from './handlers/anim-state-graph.js';
import { AudioHandler } from './handlers/audio.js';
import { BinaryHandler } from './handlers/binary.js';
import { ContainerHandler } from './handlers/container.js';
import { CssHandler } from './handlers/css.js';
import { CubemapHandler } from './handlers/cubemap.js';
import { FolderHandler } from './handlers/folder.js';
import { FontHandler } from './handlers/font.js';
import { HierarchyHandler } from './handlers/hierarchy.js';
import { HtmlHandler } from './handlers/html.js';
import { JsonHandler } from './handlers/json.js';
import { MaterialHandler } from './handlers/material.js';
import { ModelHandler } from './handlers/model.js';
import { SceneHandler } from './handlers/scene.js';
import { ScriptHandler } from './handlers/script.js';
import { ShaderHandler } from './handlers/shader.js';
import { SpriteHandler } from './handlers/sprite.js';
import { TemplateHandler } from './handlers/template.js';
import { TextHandler } from './handlers/text.js';
import { TextureAtlasHandler } from './handlers/texture-atlas.js';
import { TextureHandler } from './handlers/texture.js';
import { XrManager } from './xr/xr-manager.js';

class Application extends AppBase {
  constructor(canvas, options = {}) {
    super(canvas);
    const appOptions = new AppOptions();
    appOptions.graphicsDevice = this.createDevice(canvas, options);
    this.addComponentSystems(appOptions);
    this.addResourceHandles(appOptions);
    appOptions.elementInput = options.elementInput;
    appOptions.keyboard = options.keyboard;
    appOptions.mouse = options.mouse;
    appOptions.touch = options.touch;
    appOptions.gamepads = options.gamepads;
    appOptions.scriptPrefix = options.scriptPrefix;
    appOptions.assetPrefix = options.assetPrefix;
    appOptions.scriptsOrder = options.scriptsOrder;
    appOptions.soundManager = new SoundManager();
    appOptions.lightmapper = Lightmapper;
    appOptions.batchManager = BatchManager;
    appOptions.xr = XrManager;
    this.init(appOptions);
  }
  createDevice(canvas, options) {
    if (!options.graphicsDeviceOptions) {
      options.graphicsDeviceOptions = {};
    }
    if (platform.browser && !!navigator.xr) {
      options.graphicsDeviceOptions.xrCompatible = true;
    }
    options.graphicsDeviceOptions.alpha = options.graphicsDeviceOptions.alpha || false;
    return new WebglGraphicsDevice(canvas, options.graphicsDeviceOptions);
  }
  addComponentSystems(appOptions) {
    appOptions.componentSystems = [RigidBodyComponentSystem, CollisionComponentSystem, JointComponentSystem, AnimationComponentSystem, AnimComponentSystem, ModelComponentSystem, RenderComponentSystem, CameraComponentSystem, LightComponentSystem, script.legacy ? ScriptLegacyComponentSystem : ScriptComponentSystem, AudioSourceComponentSystem, SoundComponentSystem, AudioListenerComponentSystem, ParticleSystemComponentSystem, ScreenComponentSystem, ElementComponentSystem, ButtonComponentSystem, ScrollViewComponentSystem, ScrollbarComponentSystem, SpriteComponentSystem, LayoutGroupComponentSystem, LayoutChildComponentSystem, ZoneComponentSystem];
  }
  addResourceHandles(appOptions) {
    appOptions.resourceHandlers = [RenderHandler, AnimationHandler, AnimClipHandler, AnimStateGraphHandler, ModelHandler, MaterialHandler, TextureHandler, TextHandler, JsonHandler, AudioHandler, ScriptHandler, SceneHandler, CubemapHandler, HtmlHandler, CssHandler, ShaderHandler, HierarchyHandler, FolderHandler, FontHandler, BinaryHandler, TextureAtlasHandler, SpriteHandler, TemplateHandler, ContainerHandler];
  }
}

export { Application };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwbGljYXRpb24uanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9mcmFtZXdvcmsvYXBwbGljYXRpb24uanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcGxhdGZvcm0gfSBmcm9tICcuLi9jb3JlL3BsYXRmb3JtLmpzJztcblxuaW1wb3J0IHsgV2ViZ2xHcmFwaGljc0RldmljZSB9IGZyb20gJy4uL3BsYXRmb3JtL2dyYXBoaWNzL3dlYmdsL3dlYmdsLWdyYXBoaWNzLWRldmljZS5qcyc7XG5cbmltcG9ydCB7IFNvdW5kTWFuYWdlciB9IGZyb20gJy4uL3BsYXRmb3JtL3NvdW5kL21hbmFnZXIuanMnO1xuXG5pbXBvcnQgeyBMaWdodG1hcHBlciB9IGZyb20gJy4vbGlnaHRtYXBwZXIvbGlnaHRtYXBwZXIuanMnO1xuaW1wb3J0IHsgQmF0Y2hNYW5hZ2VyIH0gZnJvbSAnLi4vc2NlbmUvYmF0Y2hpbmcvYmF0Y2gtbWFuYWdlci5qcyc7XG5cbmltcG9ydCB7IEFwcEJhc2UgfSBmcm9tICcuL2FwcC1iYXNlLmpzJztcbmltcG9ydCB7IEFwcE9wdGlvbnMgfSBmcm9tICcuL2FwcC1vcHRpb25zLmpzJztcbmltcG9ydCB7IHNjcmlwdCB9IGZyb20gJy4vc2NyaXB0LmpzJztcbmltcG9ydCB7IEFuaW1hdGlvbkNvbXBvbmVudFN5c3RlbSB9IGZyb20gJy4vY29tcG9uZW50cy9hbmltYXRpb24vc3lzdGVtLmpzJztcbmltcG9ydCB7IEFuaW1Db21wb25lbnRTeXN0ZW0gfSBmcm9tICcuL2NvbXBvbmVudHMvYW5pbS9zeXN0ZW0uanMnO1xuaW1wb3J0IHsgQXVkaW9MaXN0ZW5lckNvbXBvbmVudFN5c3RlbSB9IGZyb20gJy4vY29tcG9uZW50cy9hdWRpby1saXN0ZW5lci9zeXN0ZW0uanMnO1xuaW1wb3J0IHsgQXVkaW9Tb3VyY2VDb21wb25lbnRTeXN0ZW0gfSBmcm9tICcuL2NvbXBvbmVudHMvYXVkaW8tc291cmNlL3N5c3RlbS5qcyc7XG5pbXBvcnQgeyBCdXR0b25Db21wb25lbnRTeXN0ZW0gfSBmcm9tICcuL2NvbXBvbmVudHMvYnV0dG9uL3N5c3RlbS5qcyc7XG5pbXBvcnQgeyBDb2xsaXNpb25Db21wb25lbnRTeXN0ZW0gfSBmcm9tICcuL2NvbXBvbmVudHMvY29sbGlzaW9uL3N5c3RlbS5qcyc7XG5pbXBvcnQgeyBFbGVtZW50Q29tcG9uZW50U3lzdGVtIH0gZnJvbSAnLi9jb21wb25lbnRzL2VsZW1lbnQvc3lzdGVtLmpzJztcbmltcG9ydCB7IEpvaW50Q29tcG9uZW50U3lzdGVtIH0gZnJvbSAnLi9jb21wb25lbnRzL2pvaW50L3N5c3RlbS5qcyc7XG5pbXBvcnQgeyBMYXlvdXRDaGlsZENvbXBvbmVudFN5c3RlbSB9IGZyb20gJy4vY29tcG9uZW50cy9sYXlvdXQtY2hpbGQvc3lzdGVtLmpzJztcbmltcG9ydCB7IExheW91dEdyb3VwQ29tcG9uZW50U3lzdGVtIH0gZnJvbSAnLi9jb21wb25lbnRzL2xheW91dC1ncm91cC9zeXN0ZW0uanMnO1xuaW1wb3J0IHsgTW9kZWxDb21wb25lbnRTeXN0ZW0gfSBmcm9tICcuL2NvbXBvbmVudHMvbW9kZWwvc3lzdGVtLmpzJztcbmltcG9ydCB7IFBhcnRpY2xlU3lzdGVtQ29tcG9uZW50U3lzdGVtIH0gZnJvbSAnLi9jb21wb25lbnRzL3BhcnRpY2xlLXN5c3RlbS9zeXN0ZW0uanMnO1xuaW1wb3J0IHsgUmVuZGVyQ29tcG9uZW50U3lzdGVtIH0gZnJvbSAnLi9jb21wb25lbnRzL3JlbmRlci9zeXN0ZW0uanMnO1xuaW1wb3J0IHsgUmlnaWRCb2R5Q29tcG9uZW50U3lzdGVtIH0gZnJvbSAnLi9jb21wb25lbnRzL3JpZ2lkLWJvZHkvc3lzdGVtLmpzJztcbmltcG9ydCB7IFNjcmVlbkNvbXBvbmVudFN5c3RlbSB9IGZyb20gJy4vY29tcG9uZW50cy9zY3JlZW4vc3lzdGVtLmpzJztcbmltcG9ydCB7IFNjcmlwdExlZ2FjeUNvbXBvbmVudFN5c3RlbSB9IGZyb20gJy4vY29tcG9uZW50cy9zY3JpcHQtbGVnYWN5L3N5c3RlbS5qcyc7XG5pbXBvcnQgeyBTY3JvbGxWaWV3Q29tcG9uZW50U3lzdGVtIH0gZnJvbSAnLi9jb21wb25lbnRzL3Njcm9sbC12aWV3L3N5c3RlbS5qcyc7XG5pbXBvcnQgeyBTY3JvbGxiYXJDb21wb25lbnRTeXN0ZW0gfSBmcm9tICcuL2NvbXBvbmVudHMvc2Nyb2xsYmFyL3N5c3RlbS5qcyc7XG5pbXBvcnQgeyBTb3VuZENvbXBvbmVudFN5c3RlbSB9IGZyb20gJy4vY29tcG9uZW50cy9zb3VuZC9zeXN0ZW0uanMnO1xuaW1wb3J0IHsgU3ByaXRlQ29tcG9uZW50U3lzdGVtIH0gZnJvbSAnLi9jb21wb25lbnRzL3Nwcml0ZS9zeXN0ZW0uanMnO1xuaW1wb3J0IHsgWm9uZUNvbXBvbmVudFN5c3RlbSB9IGZyb20gJy4vY29tcG9uZW50cy96b25lL3N5c3RlbS5qcyc7XG5pbXBvcnQgeyBDYW1lcmFDb21wb25lbnRTeXN0ZW0gfSBmcm9tICcuL2NvbXBvbmVudHMvY2FtZXJhL3N5c3RlbS5qcyc7XG5pbXBvcnQgeyBMaWdodENvbXBvbmVudFN5c3RlbSB9IGZyb20gJy4vY29tcG9uZW50cy9saWdodC9zeXN0ZW0uanMnO1xuaW1wb3J0IHsgU2NyaXB0Q29tcG9uZW50U3lzdGVtIH0gZnJvbSAnLi9jb21wb25lbnRzL3NjcmlwdC9zeXN0ZW0uanMnO1xuXG5pbXBvcnQgeyBSZW5kZXJIYW5kbGVyIH0gZnJvbSAnLi4vZnJhbWV3b3JrL2hhbmRsZXJzL3JlbmRlci5qcyc7XG5pbXBvcnQgeyBBbmltYXRpb25IYW5kbGVyIH0gZnJvbSAnLi4vZnJhbWV3b3JrL2hhbmRsZXJzL2FuaW1hdGlvbi5qcyc7XG5pbXBvcnQgeyBBbmltQ2xpcEhhbmRsZXIgfSBmcm9tICcuL2hhbmRsZXJzL2FuaW0tY2xpcC5qcyc7XG5pbXBvcnQgeyBBbmltU3RhdGVHcmFwaEhhbmRsZXIgfSBmcm9tICcuLi9mcmFtZXdvcmsvaGFuZGxlcnMvYW5pbS1zdGF0ZS1ncmFwaC5qcyc7XG5pbXBvcnQgeyBBdWRpb0hhbmRsZXIgfSBmcm9tICcuLi9mcmFtZXdvcmsvaGFuZGxlcnMvYXVkaW8uanMnO1xuaW1wb3J0IHsgQmluYXJ5SGFuZGxlciB9IGZyb20gJy4uL2ZyYW1ld29yay9oYW5kbGVycy9iaW5hcnkuanMnO1xuaW1wb3J0IHsgQ29udGFpbmVySGFuZGxlciB9IGZyb20gJy4uL2ZyYW1ld29yay9oYW5kbGVycy9jb250YWluZXIuanMnO1xuaW1wb3J0IHsgQ3NzSGFuZGxlciB9IGZyb20gJy4uL2ZyYW1ld29yay9oYW5kbGVycy9jc3MuanMnO1xuaW1wb3J0IHsgQ3ViZW1hcEhhbmRsZXIgfSBmcm9tICcuLi9mcmFtZXdvcmsvaGFuZGxlcnMvY3ViZW1hcC5qcyc7XG5pbXBvcnQgeyBGb2xkZXJIYW5kbGVyIH0gZnJvbSAnLi4vZnJhbWV3b3JrL2hhbmRsZXJzL2ZvbGRlci5qcyc7XG5pbXBvcnQgeyBGb250SGFuZGxlciB9IGZyb20gJy4uL2ZyYW1ld29yay9oYW5kbGVycy9mb250LmpzJztcbmltcG9ydCB7IEhpZXJhcmNoeUhhbmRsZXIgfSBmcm9tICcuLi9mcmFtZXdvcmsvaGFuZGxlcnMvaGllcmFyY2h5LmpzJztcbmltcG9ydCB7IEh0bWxIYW5kbGVyIH0gZnJvbSAnLi4vZnJhbWV3b3JrL2hhbmRsZXJzL2h0bWwuanMnO1xuaW1wb3J0IHsgSnNvbkhhbmRsZXIgfSBmcm9tICcuLi9mcmFtZXdvcmsvaGFuZGxlcnMvanNvbi5qcyc7XG5pbXBvcnQgeyBNYXRlcmlhbEhhbmRsZXIgfSBmcm9tICcuLi9mcmFtZXdvcmsvaGFuZGxlcnMvbWF0ZXJpYWwuanMnO1xuaW1wb3J0IHsgTW9kZWxIYW5kbGVyIH0gZnJvbSAnLi4vZnJhbWV3b3JrL2hhbmRsZXJzL21vZGVsLmpzJztcbmltcG9ydCB7IFNjZW5lSGFuZGxlciB9IGZyb20gJy4uL2ZyYW1ld29yay9oYW5kbGVycy9zY2VuZS5qcyc7XG5pbXBvcnQgeyBTY3JpcHRIYW5kbGVyIH0gZnJvbSAnLi4vZnJhbWV3b3JrL2hhbmRsZXJzL3NjcmlwdC5qcyc7XG5pbXBvcnQgeyBTaGFkZXJIYW5kbGVyIH0gZnJvbSAnLi4vZnJhbWV3b3JrL2hhbmRsZXJzL3NoYWRlci5qcyc7XG5pbXBvcnQgeyBTcHJpdGVIYW5kbGVyIH0gZnJvbSAnLi4vZnJhbWV3b3JrL2hhbmRsZXJzL3Nwcml0ZS5qcyc7XG5pbXBvcnQgeyBUZW1wbGF0ZUhhbmRsZXIgfSBmcm9tICcuLi9mcmFtZXdvcmsvaGFuZGxlcnMvdGVtcGxhdGUuanMnO1xuaW1wb3J0IHsgVGV4dEhhbmRsZXIgfSBmcm9tICcuLi9mcmFtZXdvcmsvaGFuZGxlcnMvdGV4dC5qcyc7XG5pbXBvcnQgeyBUZXh0dXJlQXRsYXNIYW5kbGVyIH0gZnJvbSAnLi4vZnJhbWV3b3JrL2hhbmRsZXJzL3RleHR1cmUtYXRsYXMuanMnO1xuaW1wb3J0IHsgVGV4dHVyZUhhbmRsZXIgfSBmcm9tICcuLi9mcmFtZXdvcmsvaGFuZGxlcnMvdGV4dHVyZS5qcyc7XG5cbmltcG9ydCB7IFhyTWFuYWdlciB9IGZyb20gJy4veHIveHItbWFuYWdlci5qcyc7XG5cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCcuL2lucHV0L2VsZW1lbnQtaW5wdXQuanMnKS5FbGVtZW50SW5wdXR9IEVsZW1lbnRJbnB1dCAqL1xuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4uL3BsYXRmb3JtL2lucHV0L2dhbWUtcGFkcy5qcycpLkdhbWVQYWRzfSBHYW1lUGFkcyAqL1xuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4uL3BsYXRmb3JtL2lucHV0L2tleWJvYXJkLmpzJykuS2V5Ym9hcmR9IEtleWJvYXJkICovXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnLi4vcGxhdGZvcm0vaW5wdXQvbW91c2UuanMnKS5Nb3VzZX0gTW91c2UgKi9cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCcuLi9wbGF0Zm9ybS9pbnB1dC90b3VjaC1kZXZpY2UuanMnKS5Ub3VjaERldmljZX0gVG91Y2hEZXZpY2UgKi9cblxuLyoqXG4gKiBBbiBBcHBsaWNhdGlvbiByZXByZXNlbnRzIGFuZCBtYW5hZ2VzIHlvdXIgUGxheUNhbnZhcyBhcHBsaWNhdGlvbi4gSWYgeW91IGFyZSBkZXZlbG9waW5nIHVzaW5nXG4gKiB0aGUgUGxheUNhbnZhcyBFZGl0b3IsIHRoZSBBcHBsaWNhdGlvbiBpcyBjcmVhdGVkIGZvciB5b3UuIFlvdSBjYW4gYWNjZXNzIHlvdXIgQXBwbGljYXRpb25cbiAqIGluc3RhbmNlIGluIHlvdXIgc2NyaXB0cy4gQmVsb3cgaXMgYSBza2VsZXRvbiBzY3JpcHQgd2hpY2ggc2hvd3MgaG93IHlvdSBjYW4gYWNjZXNzIHRoZVxuICogYXBwbGljYXRpb24gJ2FwcCcgcHJvcGVydHkgaW5zaWRlIHRoZSBpbml0aWFsaXplIGFuZCB1cGRhdGUgZnVuY3Rpb25zOlxuICpcbiAqIGBgYGphdmFzY3JpcHRcbiAqIC8vIEVkaXRvciBleGFtcGxlOiBhY2Nlc3NpbmcgdGhlIHBjLkFwcGxpY2F0aW9uIGZyb20gYSBzY3JpcHRcbiAqIHZhciBNeVNjcmlwdCA9IHBjLmNyZWF0ZVNjcmlwdCgnbXlTY3JpcHQnKTtcbiAqXG4gKiBNeVNjcmlwdC5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKCkge1xuICogICAgIC8vIEV2ZXJ5IHNjcmlwdCBpbnN0YW5jZSBoYXMgYSBwcm9wZXJ0eSAndGhpcy5hcHAnIGFjY2Vzc2libGUgaW4gdGhlIGluaXRpYWxpemUuLi5cbiAqICAgICB2YXIgYXBwID0gdGhpcy5hcHA7XG4gKiB9O1xuICpcbiAqIE15U2NyaXB0LnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbihkdCkge1xuICogICAgIC8vIC4uLmFuZCB1cGRhdGUgZnVuY3Rpb25zLlxuICogICAgIHZhciBhcHAgPSB0aGlzLmFwcDtcbiAqIH07XG4gKiBgYGBcbiAqXG4gKiBJZiB5b3UgYXJlIHVzaW5nIHRoZSBFbmdpbmUgd2l0aG91dCB0aGUgRWRpdG9yLCB5b3UgaGF2ZSB0byBjcmVhdGUgdGhlIGFwcGxpY2F0aW9uIGluc3RhbmNlXG4gKiBtYW51YWxseS5cbiAqXG4gKiBAYXVnbWVudHMgQXBwQmFzZVxuICovXG5jbGFzcyBBcHBsaWNhdGlvbiBleHRlbmRzIEFwcEJhc2Uge1xuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIG5ldyBBcHBsaWNhdGlvbiBpbnN0YW5jZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7RWxlbWVudH0gY2FudmFzIC0gVGhlIGNhbnZhcyBlbGVtZW50LlxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBbb3B0aW9uc10gLSBUaGUgb3B0aW9ucyBvYmplY3QgdG8gY29uZmlndXJlIHRoZSBBcHBsaWNhdGlvbi5cbiAgICAgKiBAcGFyYW0ge0VsZW1lbnRJbnB1dH0gW29wdGlvbnMuZWxlbWVudElucHV0XSAtIElucHV0IGhhbmRsZXIgZm9yIHtAbGluayBFbGVtZW50Q29tcG9uZW50fXMuXG4gICAgICogQHBhcmFtIHtLZXlib2FyZH0gW29wdGlvbnMua2V5Ym9hcmRdIC0gS2V5Ym9hcmQgaGFuZGxlciBmb3IgaW5wdXQuXG4gICAgICogQHBhcmFtIHtNb3VzZX0gW29wdGlvbnMubW91c2VdIC0gTW91c2UgaGFuZGxlciBmb3IgaW5wdXQuXG4gICAgICogQHBhcmFtIHtUb3VjaERldmljZX0gW29wdGlvbnMudG91Y2hdIC0gVG91Y2hEZXZpY2UgaGFuZGxlciBmb3IgaW5wdXQuXG4gICAgICogQHBhcmFtIHtHYW1lUGFkc30gW29wdGlvbnMuZ2FtZXBhZHNdIC0gR2FtZXBhZCBoYW5kbGVyIGZvciBpbnB1dC5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW29wdGlvbnMuc2NyaXB0UHJlZml4XSAtIFByZWZpeCB0byBhcHBseSB0byBzY3JpcHQgdXJscyBiZWZvcmUgbG9hZGluZy5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW29wdGlvbnMuYXNzZXRQcmVmaXhdIC0gUHJlZml4IHRvIGFwcGx5IHRvIGFzc2V0IHVybHMgYmVmb3JlIGxvYWRpbmcuXG4gICAgICogQHBhcmFtIHtvYmplY3R9IFtvcHRpb25zLmdyYXBoaWNzRGV2aWNlT3B0aW9uc10gLSBPcHRpb25zIG9iamVjdCB0aGF0IGlzIHBhc3NlZCBpbnRvIHRoZVxuICAgICAqIHtAbGluayBHcmFwaGljc0RldmljZX0gY29uc3RydWN0b3IuXG4gICAgICogQHBhcmFtIHtzdHJpbmdbXX0gW29wdGlvbnMuc2NyaXB0c09yZGVyXSAtIFNjcmlwdHMgaW4gb3JkZXIgb2YgbG9hZGluZyBmaXJzdC5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIC8vIEVuZ2luZS1vbmx5IGV4YW1wbGU6IGNyZWF0ZSB0aGUgYXBwbGljYXRpb24gbWFudWFsbHlcbiAgICAgKiB2YXIgYXBwID0gbmV3IHBjLkFwcGxpY2F0aW9uKGNhbnZhcywgb3B0aW9ucyk7XG4gICAgICpcbiAgICAgKiAvLyBTdGFydCB0aGUgYXBwbGljYXRpb24ncyBtYWluIGxvb3BcbiAgICAgKiBhcHAuc3RhcnQoKTtcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihjYW52YXMsIG9wdGlvbnMgPSB7fSkge1xuICAgICAgICBzdXBlcihjYW52YXMpO1xuXG4gICAgICAgIGNvbnN0IGFwcE9wdGlvbnMgPSBuZXcgQXBwT3B0aW9ucygpO1xuXG4gICAgICAgIGFwcE9wdGlvbnMuZ3JhcGhpY3NEZXZpY2UgPSB0aGlzLmNyZWF0ZURldmljZShjYW52YXMsIG9wdGlvbnMpO1xuICAgICAgICB0aGlzLmFkZENvbXBvbmVudFN5c3RlbXMoYXBwT3B0aW9ucyk7XG4gICAgICAgIHRoaXMuYWRkUmVzb3VyY2VIYW5kbGVzKGFwcE9wdGlvbnMpO1xuXG4gICAgICAgIGFwcE9wdGlvbnMuZWxlbWVudElucHV0ID0gb3B0aW9ucy5lbGVtZW50SW5wdXQ7XG4gICAgICAgIGFwcE9wdGlvbnMua2V5Ym9hcmQgPSBvcHRpb25zLmtleWJvYXJkO1xuICAgICAgICBhcHBPcHRpb25zLm1vdXNlID0gb3B0aW9ucy5tb3VzZTtcbiAgICAgICAgYXBwT3B0aW9ucy50b3VjaCA9IG9wdGlvbnMudG91Y2g7XG4gICAgICAgIGFwcE9wdGlvbnMuZ2FtZXBhZHMgPSBvcHRpb25zLmdhbWVwYWRzO1xuXG4gICAgICAgIGFwcE9wdGlvbnMuc2NyaXB0UHJlZml4ID0gb3B0aW9ucy5zY3JpcHRQcmVmaXg7XG4gICAgICAgIGFwcE9wdGlvbnMuYXNzZXRQcmVmaXggPSBvcHRpb25zLmFzc2V0UHJlZml4O1xuICAgICAgICBhcHBPcHRpb25zLnNjcmlwdHNPcmRlciA9IG9wdGlvbnMuc2NyaXB0c09yZGVyO1xuXG4gICAgICAgIGFwcE9wdGlvbnMuc291bmRNYW5hZ2VyID0gbmV3IFNvdW5kTWFuYWdlcigpO1xuICAgICAgICBhcHBPcHRpb25zLmxpZ2h0bWFwcGVyID0gTGlnaHRtYXBwZXI7XG4gICAgICAgIGFwcE9wdGlvbnMuYmF0Y2hNYW5hZ2VyID0gQmF0Y2hNYW5hZ2VyO1xuICAgICAgICBhcHBPcHRpb25zLnhyID0gWHJNYW5hZ2VyO1xuXG4gICAgICAgIHRoaXMuaW5pdChhcHBPcHRpb25zKTtcbiAgICB9XG5cbiAgICBjcmVhdGVEZXZpY2UoY2FudmFzLCBvcHRpb25zKSB7XG5cbiAgICAgICAgaWYgKCFvcHRpb25zLmdyYXBoaWNzRGV2aWNlT3B0aW9ucykge1xuICAgICAgICAgICAgb3B0aW9ucy5ncmFwaGljc0RldmljZU9wdGlvbnMgPSB7IH07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHBsYXRmb3JtLmJyb3dzZXIgJiYgISFuYXZpZ2F0b3IueHIpIHtcbiAgICAgICAgICAgIG9wdGlvbnMuZ3JhcGhpY3NEZXZpY2VPcHRpb25zLnhyQ29tcGF0aWJsZSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgb3B0aW9ucy5ncmFwaGljc0RldmljZU9wdGlvbnMuYWxwaGEgPSBvcHRpb25zLmdyYXBoaWNzRGV2aWNlT3B0aW9ucy5hbHBoYSB8fCBmYWxzZTtcblxuICAgICAgICByZXR1cm4gbmV3IFdlYmdsR3JhcGhpY3NEZXZpY2UoY2FudmFzLCBvcHRpb25zLmdyYXBoaWNzRGV2aWNlT3B0aW9ucyk7XG4gICAgfVxuXG4gICAgYWRkQ29tcG9uZW50U3lzdGVtcyhhcHBPcHRpb25zKSB7XG4gICAgICAgIGFwcE9wdGlvbnMuY29tcG9uZW50U3lzdGVtcyA9IFtcbiAgICAgICAgICAgIFJpZ2lkQm9keUNvbXBvbmVudFN5c3RlbSxcbiAgICAgICAgICAgIENvbGxpc2lvbkNvbXBvbmVudFN5c3RlbSxcbiAgICAgICAgICAgIEpvaW50Q29tcG9uZW50U3lzdGVtLFxuICAgICAgICAgICAgQW5pbWF0aW9uQ29tcG9uZW50U3lzdGVtLFxuICAgICAgICAgICAgQW5pbUNvbXBvbmVudFN5c3RlbSxcbiAgICAgICAgICAgIE1vZGVsQ29tcG9uZW50U3lzdGVtLFxuICAgICAgICAgICAgUmVuZGVyQ29tcG9uZW50U3lzdGVtLFxuICAgICAgICAgICAgQ2FtZXJhQ29tcG9uZW50U3lzdGVtLFxuICAgICAgICAgICAgTGlnaHRDb21wb25lbnRTeXN0ZW0sXG4gICAgICAgICAgICBzY3JpcHQubGVnYWN5ID8gU2NyaXB0TGVnYWN5Q29tcG9uZW50U3lzdGVtIDogU2NyaXB0Q29tcG9uZW50U3lzdGVtLFxuICAgICAgICAgICAgQXVkaW9Tb3VyY2VDb21wb25lbnRTeXN0ZW0sXG4gICAgICAgICAgICBTb3VuZENvbXBvbmVudFN5c3RlbSxcbiAgICAgICAgICAgIEF1ZGlvTGlzdGVuZXJDb21wb25lbnRTeXN0ZW0sXG4gICAgICAgICAgICBQYXJ0aWNsZVN5c3RlbUNvbXBvbmVudFN5c3RlbSxcbiAgICAgICAgICAgIFNjcmVlbkNvbXBvbmVudFN5c3RlbSxcbiAgICAgICAgICAgIEVsZW1lbnRDb21wb25lbnRTeXN0ZW0sXG4gICAgICAgICAgICBCdXR0b25Db21wb25lbnRTeXN0ZW0sXG4gICAgICAgICAgICBTY3JvbGxWaWV3Q29tcG9uZW50U3lzdGVtLFxuICAgICAgICAgICAgU2Nyb2xsYmFyQ29tcG9uZW50U3lzdGVtLFxuICAgICAgICAgICAgU3ByaXRlQ29tcG9uZW50U3lzdGVtLFxuICAgICAgICAgICAgTGF5b3V0R3JvdXBDb21wb25lbnRTeXN0ZW0sXG4gICAgICAgICAgICBMYXlvdXRDaGlsZENvbXBvbmVudFN5c3RlbSxcbiAgICAgICAgICAgIFpvbmVDb21wb25lbnRTeXN0ZW1cbiAgICAgICAgXTtcbiAgICB9XG5cbiAgICBhZGRSZXNvdXJjZUhhbmRsZXMoYXBwT3B0aW9ucykge1xuICAgICAgICBhcHBPcHRpb25zLnJlc291cmNlSGFuZGxlcnMgPSBbXG4gICAgICAgICAgICBSZW5kZXJIYW5kbGVyLFxuICAgICAgICAgICAgQW5pbWF0aW9uSGFuZGxlcixcbiAgICAgICAgICAgIEFuaW1DbGlwSGFuZGxlcixcbiAgICAgICAgICAgIEFuaW1TdGF0ZUdyYXBoSGFuZGxlcixcbiAgICAgICAgICAgIE1vZGVsSGFuZGxlcixcbiAgICAgICAgICAgIE1hdGVyaWFsSGFuZGxlcixcbiAgICAgICAgICAgIFRleHR1cmVIYW5kbGVyLFxuICAgICAgICAgICAgVGV4dEhhbmRsZXIsXG4gICAgICAgICAgICBKc29uSGFuZGxlcixcbiAgICAgICAgICAgIEF1ZGlvSGFuZGxlcixcbiAgICAgICAgICAgIFNjcmlwdEhhbmRsZXIsXG4gICAgICAgICAgICBTY2VuZUhhbmRsZXIsXG4gICAgICAgICAgICBDdWJlbWFwSGFuZGxlcixcbiAgICAgICAgICAgIEh0bWxIYW5kbGVyLFxuICAgICAgICAgICAgQ3NzSGFuZGxlcixcbiAgICAgICAgICAgIFNoYWRlckhhbmRsZXIsXG4gICAgICAgICAgICBIaWVyYXJjaHlIYW5kbGVyLFxuICAgICAgICAgICAgRm9sZGVySGFuZGxlcixcbiAgICAgICAgICAgIEZvbnRIYW5kbGVyLFxuICAgICAgICAgICAgQmluYXJ5SGFuZGxlcixcbiAgICAgICAgICAgIFRleHR1cmVBdGxhc0hhbmRsZXIsXG4gICAgICAgICAgICBTcHJpdGVIYW5kbGVyLFxuICAgICAgICAgICAgVGVtcGxhdGVIYW5kbGVyLFxuICAgICAgICAgICAgQ29udGFpbmVySGFuZGxlclxuICAgICAgICBdO1xuICAgIH1cbn1cblxuZXhwb3J0IHsgQXBwbGljYXRpb24gfTtcbiJdLCJuYW1lcyI6WyJBcHBsaWNhdGlvbiIsIkFwcEJhc2UiLCJjb25zdHJ1Y3RvciIsImNhbnZhcyIsIm9wdGlvbnMiLCJhcHBPcHRpb25zIiwiQXBwT3B0aW9ucyIsImdyYXBoaWNzRGV2aWNlIiwiY3JlYXRlRGV2aWNlIiwiYWRkQ29tcG9uZW50U3lzdGVtcyIsImFkZFJlc291cmNlSGFuZGxlcyIsImVsZW1lbnRJbnB1dCIsImtleWJvYXJkIiwibW91c2UiLCJ0b3VjaCIsImdhbWVwYWRzIiwic2NyaXB0UHJlZml4IiwiYXNzZXRQcmVmaXgiLCJzY3JpcHRzT3JkZXIiLCJzb3VuZE1hbmFnZXIiLCJTb3VuZE1hbmFnZXIiLCJsaWdodG1hcHBlciIsIkxpZ2h0bWFwcGVyIiwiYmF0Y2hNYW5hZ2VyIiwiQmF0Y2hNYW5hZ2VyIiwieHIiLCJYck1hbmFnZXIiLCJpbml0IiwiZ3JhcGhpY3NEZXZpY2VPcHRpb25zIiwicGxhdGZvcm0iLCJicm93c2VyIiwibmF2aWdhdG9yIiwieHJDb21wYXRpYmxlIiwiYWxwaGEiLCJXZWJnbEdyYXBoaWNzRGV2aWNlIiwiY29tcG9uZW50U3lzdGVtcyIsIlJpZ2lkQm9keUNvbXBvbmVudFN5c3RlbSIsIkNvbGxpc2lvbkNvbXBvbmVudFN5c3RlbSIsIkpvaW50Q29tcG9uZW50U3lzdGVtIiwiQW5pbWF0aW9uQ29tcG9uZW50U3lzdGVtIiwiQW5pbUNvbXBvbmVudFN5c3RlbSIsIk1vZGVsQ29tcG9uZW50U3lzdGVtIiwiUmVuZGVyQ29tcG9uZW50U3lzdGVtIiwiQ2FtZXJhQ29tcG9uZW50U3lzdGVtIiwiTGlnaHRDb21wb25lbnRTeXN0ZW0iLCJzY3JpcHQiLCJsZWdhY3kiLCJTY3JpcHRMZWdhY3lDb21wb25lbnRTeXN0ZW0iLCJTY3JpcHRDb21wb25lbnRTeXN0ZW0iLCJBdWRpb1NvdXJjZUNvbXBvbmVudFN5c3RlbSIsIlNvdW5kQ29tcG9uZW50U3lzdGVtIiwiQXVkaW9MaXN0ZW5lckNvbXBvbmVudFN5c3RlbSIsIlBhcnRpY2xlU3lzdGVtQ29tcG9uZW50U3lzdGVtIiwiU2NyZWVuQ29tcG9uZW50U3lzdGVtIiwiRWxlbWVudENvbXBvbmVudFN5c3RlbSIsIkJ1dHRvbkNvbXBvbmVudFN5c3RlbSIsIlNjcm9sbFZpZXdDb21wb25lbnRTeXN0ZW0iLCJTY3JvbGxiYXJDb21wb25lbnRTeXN0ZW0iLCJTcHJpdGVDb21wb25lbnRTeXN0ZW0iLCJMYXlvdXRHcm91cENvbXBvbmVudFN5c3RlbSIsIkxheW91dENoaWxkQ29tcG9uZW50U3lzdGVtIiwiWm9uZUNvbXBvbmVudFN5c3RlbSIsInJlc291cmNlSGFuZGxlcnMiLCJSZW5kZXJIYW5kbGVyIiwiQW5pbWF0aW9uSGFuZGxlciIsIkFuaW1DbGlwSGFuZGxlciIsIkFuaW1TdGF0ZUdyYXBoSGFuZGxlciIsIk1vZGVsSGFuZGxlciIsIk1hdGVyaWFsSGFuZGxlciIsIlRleHR1cmVIYW5kbGVyIiwiVGV4dEhhbmRsZXIiLCJKc29uSGFuZGxlciIsIkF1ZGlvSGFuZGxlciIsIlNjcmlwdEhhbmRsZXIiLCJTY2VuZUhhbmRsZXIiLCJDdWJlbWFwSGFuZGxlciIsIkh0bWxIYW5kbGVyIiwiQ3NzSGFuZGxlciIsIlNoYWRlckhhbmRsZXIiLCJIaWVyYXJjaHlIYW5kbGVyIiwiRm9sZGVySGFuZGxlciIsIkZvbnRIYW5kbGVyIiwiQmluYXJ5SGFuZGxlciIsIlRleHR1cmVBdGxhc0hhbmRsZXIiLCJTcHJpdGVIYW5kbGVyIiwiVGVtcGxhdGVIYW5kbGVyIiwiQ29udGFpbmVySGFuZGxlciJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBZ0dBLE1BQU1BLFdBQVcsU0FBU0MsT0FBTyxDQUFDO0FBdUI5QkMsRUFBQUEsV0FBVyxDQUFDQyxNQUFNLEVBQUVDLE9BQU8sR0FBRyxFQUFFLEVBQUU7SUFDOUIsS0FBSyxDQUFDRCxNQUFNLENBQUMsQ0FBQTtBQUViLElBQUEsTUFBTUUsVUFBVSxHQUFHLElBQUlDLFVBQVUsRUFBRSxDQUFBO0lB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
