/**
 * @license
 * PlayCanvas Engine v1.58.0 revision 6672f604c (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { path } from '../../core/path.js';
import { PIXELFORMAT_R8_G8_B8, TEXTURETYPE_RGBM, TEXTURETYPE_SWIZZLEGGGR, ADDRESS_REPEAT, ADDRESS_CLAMP_TO_EDGE, ADDRESS_MIRRORED_REPEAT, FILTER_NEAREST, FILTER_LINEAR, FILTER_NEAREST_MIPMAP_NEAREST, FILTER_LINEAR_MIPMAP_NEAREST, FILTER_NEAREST_MIPMAP_LINEAR, FILTER_LINEAR_MIPMAP_LINEAR, TEXTURETYPE_DEFAULT, TEXTURETYPE_RGBE, TEXTURETYPE_RGBP, PIXELFORMAT_R8_G8_B8_A8, PIXELFORMAT_RGBA32F } from '../../platform/graphics/constants.js';
import { Texture } from '../../platform/graphics/texture.js';
import { BasisParser } from '../parsers/texture/basis.js';
import { ImgParser } from '../parsers/texture/img.js';
import { KtxParser } from '../parsers/texture/ktx.js';
import { Ktx2Parser } from '../parsers/texture/ktx2.js';
import { DdsParser } from '../parsers/texture/dds.js';
import { HdrParser } from '../parsers/texture/hdr.js';

const JSON_ADDRESS_MODE = {
  'repeat': ADDRESS_REPEAT,
  'clamp': ADDRESS_CLAMP_TO_EDGE,
  'mirror': ADDRESS_MIRRORED_REPEAT
};
const JSON_FILTER_MODE = {
  'nearest': FILTER_NEAREST,
  'linear': FILTER_LINEAR,
  'nearest_mip_nearest': FILTER_NEAREST_MIPMAP_NEAREST,
  'linear_mip_nearest': FILTER_LINEAR_MIPMAP_NEAREST,
  'nearest_mip_linear': FILTER_NEAREST_MIPMAP_LINEAR,
  'linear_mip_linear': FILTER_LINEAR_MIPMAP_LINEAR
};
const JSON_TEXTURE_TYPE = {
  'default': TEXTURETYPE_DEFAULT,
  'rgbm': TEXTURETYPE_RGBM,
  'rgbe': TEXTURETYPE_RGBE,
  'rgbp': TEXTURETYPE_RGBP,
  'swizzleGGGR': TEXTURETYPE_SWIZZLEGGGR
};

class TextureParser {
  load(url, callback, asset) {
    throw new Error('not implemented');
  }

  open(url, data, device) {
    throw new Error('not implemented');
  }
}

const _completePartialMipmapChain = function _completePartialMipmapChain(texture) {
  const requiredMipLevels = Math.log2(Math.max(texture._width, texture._height)) + 1;
  const isHtmlElement = function isHtmlElement(object) {
    return object instanceof HTMLCanvasElement || object instanceof HTMLImageElement || object instanceof HTMLVideoElement;
  };
  if (!(texture._format === PIXELFORMAT_R8_G8_B8_A8 || texture._format === PIXELFORMAT_RGBA32F) || texture._volume || texture._compressed || texture._levels.length === 1 || texture._levels.length === requiredMipLevels || isHtmlElement(texture._cubemap ? texture._levels[0][0] : texture._levels[0])) {
    return;
  }
  const downsample = function downsample(width, height, data) {
    const sampledWidth = Math.max(1, width >> 1);
    const sampledHeight = Math.max(1, height >> 1);
    const sampledData = new data.constructor(sampledWidth * sampledHeight * 4);
    const xs = Math.floor(width / sampledWidth);
    const ys = Math.floor(height / sampledHeight);
    const xsys = xs * ys;
    for (let y = 0; y < sampledHeight; ++y) {
      for (let x = 0; x < sampledWidth; ++x) {
        for (let e = 0; e < 4; ++e) {
          let sum = 0;
          for (let sy = 0; sy < ys; ++sy) {
            for (let sx = 0; sx < xs; ++sx) {
              sum += data[(x * xs + sx + (y * ys + sy) * width) * 4 + e];
            }
          }
          sampledData[(x + y * sampledWidth) * 4 + e] = sum / xsys;
        }
      }
    }
    return sampledData;
  };

  for (let level = texture._levels.length; level < requiredMipLevels; ++level) {
    const width = Math.max(1, texture._width >> level - 1);
    const height = Math.max(1, texture._height >> level - 1);
    if (texture._cubemap) {
      const mips = [];
      for (let face = 0; face < 6; ++face) {
        mips.push(downsample(width, height, texture._levels[level - 1][face]));
      }
      texture._levels.push(mips);
    } else {
      texture._levels.push(downsample(width, height, texture._levels[level - 1]));
    }
  }
  texture._levelsUpdated = texture._cubemap ? [[true, true, true, true, true, true]] : [true];
};

class TextureHandler {

  constructor(app) {
    this.handlerType = "texture";
    const assets = app.assets;
    const device = app.graphicsDevice;
    this._device = device;
    this._assets = assets;
    this._loader = app.loader;

    this.imgParser = new ImgParser(assets, device);
    this.parsers = {
      dds: new DdsParser(assets),
      ktx: new KtxParser(assets),
      ktx2: new Ktx2Parser(assets, device),
      basis: new BasisParser(assets, device),
      hdr: new HdrParser(assets)
    };
  }
  set crossOrigin(value) {
    this.imgParser.crossOrigin = value;
  }
  get crossOrigin() {
    return this.imgParser.crossOrigin;
  }
  set maxRetries(value) {
    this.imgParser.maxRetries = value;
    for (const parser in this.parsers) {
      if (this.parsers.hasOwnProperty(parser)) {
        this.parsers[parser].maxRetries = value;
      }
    }
  }
  get maxRetries() {
    return this.imgParser.maxRetries;
  }
  _getUrlWithoutParams(url) {
    return url.indexOf('?') >= 0 ? url.split('?')[0] : url;
  }
  _getParser(url) {
    const ext = path.getExtension(this._getUrlWithoutParams(url)).toLowerCase().replace('.', '');
    return this.parsers[ext] || this.imgParser;
  }
  load(url, callback, asset) {
    if (typeof url === 'string') {
      url = {
        load: url,
        original: url
      };
    }
    this._getParser(url.original).load(url, callback, asset);
  }
  open(url, data, asset) {
    if (!url) return undefined;
    let texture = this._getParser(url).open(url, data, this._device);
    if (texture === null) {
      texture = new Texture(this._device, {
        width: 4,
        height: 4,
        format: PIXELFORMAT_R8_G8_B8
      });
    } else {
      _completePartialMipmapChain(texture);

      if (data.unswizzledGGGR) {
        asset.file.variants.basis.opt &= ~8;
      }
    }
    return texture;
  }
  patch(asset, assets) {
    const texture = asset.resource;
    if (!texture) {
      return;
    }
    if (asset.name && asset.name.length > 0) {
      texture.name = asset.name;
    }
    const assetData = asset.data;
    if (assetData.hasOwnProperty('minfilter')) {
      texture.minFilter = JSON_FILTER_MODE[assetData.minfilter];
    }
    if (assetData.hasOwnProperty('magfilter')) {
      texture.magFilter = JSON_FILTER_MODE[assetData.magfilter];
    }
    if (!texture.cubemap) {
      if (assetData.hasOwnProperty('addressu')) {
        texture.addressU = JSON_ADDRESS_MODE[assetData.addressu];
      }
      if (assetData.hasOwnProperty('addressv')) {
        texture.addressV = JSON_ADDRESS_MODE[assetData.addressv];
      }
    }
    if (assetData.hasOwnProperty('mipmaps')) {
      texture.mipmaps = assetData.mipmaps;
    }
    if (assetData.hasOwnProperty('anisotropy')) {
      texture.anisotropy = assetData.anisotropy;
    }
    if (assetData.hasOwnProperty('flipY')) {
      texture.flipY = !!assetData.flipY;
    }

    if (assetData.hasOwnProperty('type')) {
      texture.type = JSON_TEXTURE_TYPE[assetData.type];
    } else if (assetData.hasOwnProperty('rgbm') && assetData.rgbm) {
      texture.type = TEXTURETYPE_RGBM;
    } else if (asset.file && (asset.file.opt & 8) !== 0) {
      texture.type = TEXTURETYPE_SWIZZLEGGGR;
    }
  }
}

export { TextureHandler, TextureParser };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGV4dHVyZS5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2ZyYW1ld29yay9oYW5kbGVycy90ZXh0dXJlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHBhdGggfSBmcm9tICcuLi8uLi9jb3JlL3BhdGguanMnO1xuXG5pbXBvcnQge1xuICAgIEFERFJFU1NfQ0xBTVBfVE9fRURHRSwgQUREUkVTU19NSVJST1JFRF9SRVBFQVQsIEFERFJFU1NfUkVQRUFULFxuICAgIEZJTFRFUl9MSU5FQVIsIEZJTFRFUl9ORUFSRVNULCBGSUxURVJfTkVBUkVTVF9NSVBNQVBfTkVBUkVTVCwgRklMVEVSX05FQVJFU1RfTUlQTUFQX0xJTkVBUiwgRklMVEVSX0xJTkVBUl9NSVBNQVBfTkVBUkVTVCwgRklMVEVSX0xJTkVBUl9NSVBNQVBfTElORUFSLFxuICAgIFBJWEVMRk9STUFUX1I4X0c4X0I4LCBQSVhFTEZPUk1BVF9SOF9HOF9COF9BOCwgUElYRUxGT1JNQVRfUkdCQTMyRixcbiAgICBURVhUVVJFVFlQRV9ERUZBVUxULCBURVhUVVJFVFlQRV9SR0JFLCBURVhUVVJFVFlQRV9SR0JNLCBURVhUVVJFVFlQRV9TV0laWkxFR0dHUiwgVEVYVFVSRVRZUEVfUkdCUFxufSBmcm9tICcuLi8uLi9wbGF0Zm9ybS9ncmFwaGljcy9jb25zdGFudHMuanMnO1xuaW1wb3J0IHsgVGV4dHVyZSB9IGZyb20gJy4uLy4uL3BsYXRmb3JtL2dyYXBoaWNzL3RleHR1cmUuanMnO1xuXG5pbXBvcnQgeyBCYXNpc1BhcnNlciB9IGZyb20gJy4uL3BhcnNlcnMvdGV4dHVyZS9iYXNpcy5qcyc7XG5pbXBvcnQgeyBJbWdQYXJzZXIgfSBmcm9tICcuLi9wYXJzZXJzL3RleHR1cmUvaW1nLmpzJztcbmltcG9ydCB7IEt0eFBhcnNlciB9IGZyb20gJy4uL3BhcnNlcnMvdGV4dHVyZS9rdHguanMnO1xuaW1wb3J0IHsgS3R4MlBhcnNlciB9IGZyb20gJy4uL3BhcnNlcnMvdGV4dHVyZS9rdHgyLmpzJztcbmltcG9ydCB7IERkc1BhcnNlciB9IGZyb20gJy4uL3BhcnNlcnMvdGV4dHVyZS9kZHMuanMnO1xuaW1wb3J0IHsgSGRyUGFyc2VyIH0gZnJvbSAnLi4vcGFyc2Vycy90ZXh0dXJlL2hkci5qcyc7XG5cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCcuLi8uLi9mcmFtZXdvcmsvYXBwLWJhc2UuanMnKS5BcHBCYXNlfSBBcHBCYXNlICovXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnLi4vLi4vZnJhbWV3b3JrL2Fzc2V0L2Fzc2V0LmpzJykuQXNzZXR9IEFzc2V0ICovXG4vKiogQHR5cGVkZWYge2ltcG9ydCgnLi9oYW5kbGVyLmpzJykuUmVzb3VyY2VIYW5kbGVyfSBSZXNvdXJjZUhhbmRsZXIgKi9cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCcuL2hhbmRsZXIuanMnKS5SZXNvdXJjZUhhbmRsZXJDYWxsYmFja30gUmVzb3VyY2VIYW5kbGVyQ2FsbGJhY2sgKi9cblxuY29uc3QgSlNPTl9BRERSRVNTX01PREUgPSB7XG4gICAgJ3JlcGVhdCc6IEFERFJFU1NfUkVQRUFULFxuICAgICdjbGFtcCc6IEFERFJFU1NfQ0xBTVBfVE9fRURHRSxcbiAgICAnbWlycm9yJzogQUREUkVTU19NSVJST1JFRF9SRVBFQVRcbn07XG5cbmNvbnN0IEpTT05fRklMVEVSX01PREUgPSB7XG4gICAgJ25lYXJlc3QnOiBGSUxURVJfTkVBUkVTVCxcbiAgICAnbGluZWFyJzogRklMVEVSX0xJTkVBUixcbiAgICAnbmVhcmVzdF9taXBfbmVhcmVzdCc6IEZJTFRFUl9ORUFSRVNUX01JUE1BUF9ORUFSRVNULFxuICAgICdsaW5lYXJfbWlwX25lYXJlc3QnOiBGSUxURVJfTElORUFSX01JUE1BUF9ORUFSRVNULFxuICAgICduZWFyZXN0X21pcF9saW5lYXInOiBGSUxURVJfTkVBUkVTVF9NSVBNQVBfTElORUFSLFxuICAgICdsaW5lYXJfbWlwX2xpbmVhcic6IEZJTFRFUl9MSU5FQVJfTUlQTUFQX0xJTkVBUlxufTtcblxuY29uc3QgSlNPTl9URVhUVVJFX1RZUEUgPSB7XG4gICAgJ2RlZmF1bHQnOiBURVhUVVJFVFlQRV9ERUZBVUxULFxuICAgICdyZ2JtJzogVEVYVFVSRVRZUEVfUkdCTSxcbiAgICAncmdiZSc6IFRFWFRVUkVUWVBFX1JHQkUsXG4gICAgJ3JnYnAnOiBURVhUVVJFVFlQRV9SR0JQLFxuICAgICdzd2l6emxlR0dHUic6IFRFWFRVUkVUWVBFX1NXSVpaTEVHR0dSXG59O1xuXG4vKipcbiAqIEBpbnRlcmZhY2VcbiAqIEBuYW1lIFRleHR1cmVQYXJzZXJcbiAqIEBkZXNjcmlwdGlvbiBJbnRlcmZhY2UgdG8gYSB0ZXh0dXJlIHBhcnNlci4gSW1wbGVtZW50YXRpb25zIG9mIHRoaXMgaW50ZXJmYWNlIGhhbmRsZSB0aGUgbG9hZGluZ1xuICogYW5kIG9wZW5pbmcgb2YgdGV4dHVyZSBhc3NldHMuXG4gKi9cbmNsYXNzIFRleHR1cmVQYXJzZXIge1xuICAgIC8qIGVzbGludC1kaXNhYmxlIGpzZG9jL3JlcXVpcmUtcmV0dXJucy1jaGVjayAqL1xuICAgIC8qKlxuICAgICAqIEBmdW5jdGlvblxuICAgICAqIEBuYW1lIFRleHR1cmVQYXJzZXIjbG9hZFxuICAgICAqIEBkZXNjcmlwdGlvbiBMb2FkIHRoZSB0ZXh0dXJlIGZyb20gdGhlIHJlbW90ZSBVUkwuIFdoZW4gbG9hZGVkIChvciBmYWlsZWQpLFxuICAgICAqIHVzZSB0aGUgY2FsbGJhY2sgdG8gcmV0dXJuIGFuIHRoZSByYXcgcmVzb3VyY2UgZGF0YSAob3IgZXJyb3IpLlxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSB1cmwgLSBUaGUgVVJMIG9mIHRoZSByZXNvdXJjZSB0byBsb2FkLlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB1cmwubG9hZCAtIFRoZSBVUkwgdG8gdXNlIGZvciBsb2FkaW5nIHRoZSByZXNvdXJjZS5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdXJsLm9yaWdpbmFsIC0gVGhlIG9yaWdpbmFsIFVSTCB1c2VmdWwgZm9yIGlkZW50aWZ5aW5nIHRoZSByZXNvdXJjZSB0eXBlLlxuICAgICAqIEBwYXJhbSB7UmVzb3VyY2VIYW5kbGVyQ2FsbGJhY2t9IGNhbGxiYWNrIC0gVGhlIGNhbGxiYWNrIHVzZWQgd2hlbiB0aGUgcmVzb3VyY2UgaXMgbG9hZGVkIG9yIGFuIGVycm9yIG9jY3Vycy5cbiAgICAgKiBAcGFyYW0ge0Fzc2V0fSBbYXNzZXRdIC0gT3B0aW9uYWwgYXNzZXQgdGhhdCBpcyBwYXNzZWQgYnkgUmVzb3VyY2VMb2FkZXIuXG4gICAgICovXG4gICAgbG9hZCh1cmwsIGNhbGxiYWNrLCBhc3NldCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ25vdCBpbXBsZW1lbnRlZCcpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBmdW5jdGlvblxuICAgICAqIEBuYW1lIFRleHR1cmVQYXJzZXIjb3BlblxuICAgICAqIEBkZXNjcmlwdGlvbiBDb252ZXJ0IHJhdyByZXNvdXJjZSBkYXRhIGludG8gYSByZXNvdXJjZSBpbnN0YW5jZS4gRS5nLiBUYWtlIDNEIG1vZGVsIGZvcm1hdCBKU09OIGFuZCByZXR1cm4gYSB7QGxpbmsgTW9kZWx9LlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgLSBUaGUgVVJMIG9mIHRoZSByZXNvdXJjZSB0byBvcGVuLlxuICAgICAqIEBwYXJhbSB7Kn0gZGF0YSAtIFRoZSByYXcgcmVzb3VyY2UgZGF0YSBwYXNzZWQgYnkgY2FsbGJhY2sgZnJvbSB7QGxpbmsgUmVzb3VyY2VIYW5kbGVyI2xvYWR9LlxuICAgICAqIEBwYXJhbSB7R3JhcGhpY3NEZXZpY2V9IGRldmljZSAtIFRoZSBncmFwaGljcyBkZXZpY2UuXG4gICAgICogQHJldHVybnMge1RleHR1cmV9IFRoZSBwYXJzZWQgcmVzb3VyY2UgZGF0YS5cbiAgICAgKi9cbiAgICBvcGVuKHVybCwgZGF0YSwgZGV2aWNlKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignbm90IGltcGxlbWVudGVkJyk7XG4gICAgfVxuICAgIC8qIGVzbGludC1lbmFibGUganNkb2MvcmVxdWlyZS1yZXR1cm5zLWNoZWNrICovXG59XG5cbi8vIEluIHRoZSBjYXNlIHdoZXJlIGEgdGV4dHVyZSBoYXMgbW9yZSB0aGFuIDEgbGV2ZWwgb2YgbWlwIGRhdGEgc3BlY2lmaWVkLCBidXQgbm90IHRoZSBmdWxsXG4vLyBtaXAgY2hhaW4sIHdlIGdlbmVyYXRlIHRoZSBtaXNzaW5nIGxldmVscyBoZXJlLlxuLy8gVGhpcyBpcyB0byBvdmVyY29tZSBhbiBpc3N1ZSB3aGVyZSBpcGhvbmUgeHIgYW5kIHhzIGlnbm9yZXMgZnVydGhlciB1cGRhdGVzIHRvIHRoZSBtaXAgZGF0YVxuLy8gYWZ0ZXIgaW52b2tpbmcgZ2wuZ2VuZXJhdGVNaXBtYXAgb24gdGhlIHRleHR1cmUgKHdoaWNoIHdhcyB0aGUgcHJldmlvdXMgbWV0aG9kIG9mIGVuc3VyaW5nXG4vLyB0aGUgdGV4dHVyZSdzIGZ1bGwgbWlwIGNoYWluIHdhcyBjb21wbGV0ZSkuXG4vLyBOT1RFOiB0aGlzIGZ1bmN0aW9uIG9ubHkgcmVzYW1wbGVzIFJHQkE4IGFuZCBSR0JBRmxvYXQzMiBkYXRhLlxuY29uc3QgX2NvbXBsZXRlUGFydGlhbE1pcG1hcENoYWluID0gZnVuY3Rpb24gKHRleHR1cmUpIHtcblxuICAgIGNvbnN0IHJlcXVpcmVkTWlwTGV2ZWxzID0gTWF0aC5sb2cyKE1hdGgubWF4KHRleHR1cmUuX3dpZHRoLCB0ZXh0dXJlLl9oZWlnaHQpKSArIDE7XG5cbiAgICBjb25zdCBpc0h0bWxFbGVtZW50ID0gZnVuY3Rpb24gKG9iamVjdCkge1xuICAgICAgICByZXR1cm4gKG9iamVjdCBpbnN0YW5jZW9mIEhUTUxDYW52YXNFbGVtZW50KSB8fFxuICAgICAgICAgICAgICAgKG9iamVjdCBpbnN0YW5jZW9mIEhUTUxJbWFnZUVsZW1lbnQpIHx8XG4gICAgICAgICAgICAgICAob2JqZWN0IGluc3RhbmNlb2YgSFRNTFZpZGVvRWxlbWVudCk7XG4gICAgfTtcblxuICAgIGlmICghKHRleHR1cmUuX2Zvcm1hdCA9PT0gUElYRUxGT1JNQVRfUjhfRzhfQjhfQTggfHxcbiAgICAgICAgICB0ZXh0dXJlLl9mb3JtYXQgPT09IFBJWEVMRk9STUFUX1JHQkEzMkYpIHx8XG4gICAgICAgICAgdGV4dHVyZS5fdm9sdW1lIHx8XG4gICAgICAgICAgdGV4dHVyZS5fY29tcHJlc3NlZCB8fFxuICAgICAgICAgIHRleHR1cmUuX2xldmVscy5sZW5ndGggPT09IDEgfHxcbiAgICAgICAgICB0ZXh0dXJlLl9sZXZlbHMubGVuZ3RoID09PSByZXF1aXJlZE1pcExldmVscyB8fFxuICAgICAgICAgIGlzSHRtbEVsZW1lbnQodGV4dHVyZS5fY3ViZW1hcCA/IHRleHR1cmUuX2xldmVsc1swXVswXSA6IHRleHR1cmUuX2xldmVsc1swXSkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGRvd25zYW1wbGUgPSBmdW5jdGlvbiAod2lkdGgsIGhlaWdodCwgZGF0YSkge1xuICAgICAgICBjb25zdCBzYW1wbGVkV2lkdGggPSBNYXRoLm1heCgxLCB3aWR0aCA+PiAxKTtcbiAgICAgICAgY29uc3Qgc2FtcGxlZEhlaWdodCA9IE1hdGgubWF4KDEsIGhlaWdodCA+PiAxKTtcbiAgICAgICAgY29uc3Qgc2FtcGxlZERhdGEgPSBuZXcgZGF0YS5jb25zdHJ1Y3RvcihzYW1wbGVkV2lkdGggKiBzYW1wbGVkSGVpZ2h0ICogNCk7XG5cbiAgICAgICAgY29uc3QgeHMgPSBNYXRoLmZsb29yKHdpZHRoIC8gc2FtcGxlZFdpZHRoKTtcbiAgICAgICAgY29uc3QgeXMgPSBNYXRoLmZsb29yKGhlaWdodCAvIHNhbXBsZWRIZWlnaHQpO1xuICAgICAgICBjb25zdCB4c3lzID0geHMgKiB5cztcblxuICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IHNhbXBsZWRIZWlnaHQ7ICsreSkge1xuICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCBzYW1wbGVkV2lkdGg7ICsreCkge1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGUgPSAwOyBlIDwgNDsgKytlKSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBzdW0gPSAwO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBzeSA9IDA7IHN5IDwgeXM7ICsrc3kpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IHN4ID0gMDsgc3ggPCB4czsgKytzeCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1bSArPSBkYXRhWyh4ICogeHMgKyBzeCArICh5ICogeXMgKyBzeSkgKiB3aWR0aCkgKiA0ICsgZV07XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgc2FtcGxlZERhdGFbKHggKyB5ICogc2FtcGxlZFdpZHRoKSAqIDQgKyBlXSA9IHN1bSAvIHhzeXM7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHNhbXBsZWREYXRhO1xuICAgIH07XG5cbiAgICAvLyBzdGVwIHRocm91Z2ggbGV2ZWxzXG4gICAgZm9yIChsZXQgbGV2ZWwgPSB0ZXh0dXJlLl9sZXZlbHMubGVuZ3RoOyBsZXZlbCA8IHJlcXVpcmVkTWlwTGV2ZWxzOyArK2xldmVsKSB7XG4gICAgICAgIGNvbnN0IHdpZHRoID0gTWF0aC5tYXgoMSwgdGV4dHVyZS5fd2lkdGggPj4gKGxldmVsIC0gMSkpO1xuICAgICAgICBjb25zdCBoZWlnaHQgPSBNYXRoLm1heCgxLCB0ZXh0dXJlLl9oZWlnaHQgPj4gKGxldmVsIC0gMSkpO1xuICAgICAgICBpZiAodGV4dHVyZS5fY3ViZW1hcCkge1xuICAgICAgICAgICAgY29uc3QgbWlwcyA9IFtdO1xuICAgICAgICAgICAgZm9yIChsZXQgZmFjZSA9IDA7IGZhY2UgPCA2OyArK2ZhY2UpIHtcbiAgICAgICAgICAgICAgICBtaXBzLnB1c2goZG93bnNhbXBsZSh3aWR0aCwgaGVpZ2h0LCB0ZXh0dXJlLl9sZXZlbHNbbGV2ZWwgLSAxXVtmYWNlXSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGV4dHVyZS5fbGV2ZWxzLnB1c2gobWlwcyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0ZXh0dXJlLl9sZXZlbHMucHVzaChkb3duc2FtcGxlKHdpZHRoLCBoZWlnaHQsIHRleHR1cmUuX2xldmVsc1tsZXZlbCAtIDFdKSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICB0ZXh0dXJlLl9sZXZlbHNVcGRhdGVkID0gdGV4dHVyZS5fY3ViZW1hcCA/IFtbdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZV1dIDogW3RydWVdO1xufTtcblxuLyoqXG4gKiBSZXNvdXJjZSBoYW5kbGVyIHVzZWQgZm9yIGxvYWRpbmcgMkQgYW5kIDNEIHtAbGluayBUZXh0dXJlfSByZXNvdXJjZXMuXG4gKlxuICogQGltcGxlbWVudHMge1Jlc291cmNlSGFuZGxlcn1cbiAqL1xuY2xhc3MgVGV4dHVyZUhhbmRsZXIge1xuICAgIC8qKlxuICAgICAqIFR5cGUgb2YgdGhlIHJlc291cmNlIHRoZSBoYW5kbGVyIGhhbmRsZXMuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7c3RyaW5nfVxuICAgICAqL1xuICAgIGhhbmRsZXJUeXBlID0gXCJ0ZXh0dXJlXCI7XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgVGV4dHVyZUhhbmRsZXIgaW5zdGFuY2UuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0FwcEJhc2V9IGFwcCAtIFRoZSBydW5uaW5nIHtAbGluayBBcHBCYXNlfS5cbiAgICAgKiBAaGlkZWNvbnN0cnVjdG9yXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoYXBwKSB7XG4gICAgICAgIGNvbnN0IGFzc2V0cyA9IGFwcC5hc3NldHM7XG4gICAgICAgIGNvbnN0IGRldmljZSA9IGFwcC5ncmFwaGljc0RldmljZTtcblxuICAgICAgICB0aGlzLl9kZXZpY2UgPSBkZXZpY2U7XG4gICAgICAgIHRoaXMuX2Fzc2V0cyA9IGFzc2V0cztcbiAgICAgICAgdGhpcy5fbG9hZGVyID0gYXBwLmxvYWRlcjtcblxuICAgICAgICAvLyBpbWcgcGFyc2VyIGhhbmRsZXMgYWxsIGJyb3dzZXItc3VwcG9ydGVkIGltYWdlIGZvcm1hdHMsIHRoaXNcbiAgICAgICAgLy8gcGFyc2VyIHdpbGwgYmUgdXNlZCB3aGVuIG90aGVyIG1vcmUgc3BlY2lmaWMgcGFyc2VycyBhcmUgbm90IGZvdW5kLlxuICAgICAgICB0aGlzLmltZ1BhcnNlciA9IG5ldyBJbWdQYXJzZXIoYXNzZXRzLCBkZXZpY2UpO1xuXG4gICAgICAgIHRoaXMucGFyc2VycyA9IHtcbiAgICAgICAgICAgIGRkczogbmV3IERkc1BhcnNlcihhc3NldHMpLFxuICAgICAgICAgICAga3R4OiBuZXcgS3R4UGFyc2VyKGFzc2V0cyksXG4gICAgICAgICAgICBrdHgyOiBuZXcgS3R4MlBhcnNlcihhc3NldHMsIGRldmljZSksXG4gICAgICAgICAgICBiYXNpczogbmV3IEJhc2lzUGFyc2VyKGFzc2V0cywgZGV2aWNlKSxcbiAgICAgICAgICAgIGhkcjogbmV3IEhkclBhcnNlcihhc3NldHMpXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgc2V0IGNyb3NzT3JpZ2luKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuaW1nUGFyc2VyLmNyb3NzT3JpZ2luID0gdmFsdWU7XG4gICAgfVxuXG4gICAgZ2V0IGNyb3NzT3JpZ2luKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5pbWdQYXJzZXIuY3Jvc3NPcmlnaW47XG4gICAgfVxuXG4gICAgc2V0IG1heFJldHJpZXModmFsdWUpIHtcbiAgICAgICAgdGhpcy5pbWdQYXJzZXIubWF4UmV0cmllcyA9IHZhbHVlO1xuICAgICAgICBmb3IgKGNvbnN0IHBhcnNlciBpbiB0aGlzLnBhcnNlcnMpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnBhcnNlcnMuaGFzT3duUHJvcGVydHkocGFyc2VyKSkge1xuICAgICAgICAgICAgICAgIHRoaXMucGFyc2Vyc1twYXJzZXJdLm1heFJldHJpZXMgPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldCBtYXhSZXRyaWVzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5pbWdQYXJzZXIubWF4UmV0cmllcztcbiAgICB9XG5cbiAgICBfZ2V0VXJsV2l0aG91dFBhcmFtcyh1cmwpIHtcbiAgICAgICAgcmV0dXJuIHVybC5pbmRleE9mKCc/JykgPj0gMCA/IHVybC5zcGxpdCgnPycpWzBdIDogdXJsO1xuICAgIH1cblxuICAgIF9nZXRQYXJzZXIodXJsKSB7XG4gICAgICAgIGNvbnN0IGV4dCA9IHBhdGguZ2V0RXh0ZW5zaW9uKHRoaXMuX2dldFVybFdpdGhvdXRQYXJhbXModXJsKSkudG9Mb3dlckNhc2UoKS5yZXBsYWNlKCcuJywgJycpO1xuICAgICAgICByZXR1cm4gdGhpcy5wYXJzZXJzW2V4dF0gfHwgdGhpcy5pbWdQYXJzZXI7XG4gICAgfVxuXG4gICAgbG9hZCh1cmwsIGNhbGxiYWNrLCBhc3NldCkge1xuICAgICAgICBpZiAodHlwZW9mIHVybCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHVybCA9IHtcbiAgICAgICAgICAgICAgICBsb2FkOiB1cmwsXG4gICAgICAgICAgICAgICAgb3JpZ2luYWw6IHVybFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX2dldFBhcnNlcih1cmwub3JpZ2luYWwpLmxvYWQodXJsLCBjYWxsYmFjaywgYXNzZXQpO1xuICAgIH1cblxuICAgIG9wZW4odXJsLCBkYXRhLCBhc3NldCkge1xuICAgICAgICBpZiAoIXVybClcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG5cbiAgICAgICAgbGV0IHRleHR1cmUgPSB0aGlzLl9nZXRQYXJzZXIodXJsKS5vcGVuKHVybCwgZGF0YSwgdGhpcy5fZGV2aWNlKTtcblxuICAgICAgICBpZiAodGV4dHVyZSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgdGV4dHVyZSA9IG5ldyBUZXh0dXJlKHRoaXMuX2RldmljZSwge1xuICAgICAgICAgICAgICAgIHdpZHRoOiA0LFxuICAgICAgICAgICAgICAgIGhlaWdodDogNCxcbiAgICAgICAgICAgICAgICBmb3JtYXQ6IFBJWEVMRk9STUFUX1I4X0c4X0I4XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIGNoZWNrIGlmIHRoZSB0ZXh0dXJlIGhhcyBvbmx5IGEgcGFydGlhbCBtaXBtYXAgY2hhaW4gc3BlY2lmaWVkIGFuZCBnZW5lcmF0ZSB0aGVcbiAgICAgICAgICAgIC8vIG1pc3NpbmcgbGV2ZWxzIGlmIHBvc3NpYmxlLlxuICAgICAgICAgICAgX2NvbXBsZXRlUGFydGlhbE1pcG1hcENoYWluKHRleHR1cmUpO1xuXG4gICAgICAgICAgICAvLyBpZiB0aGUgYmFzaXMgdHJhbnNjb2RlciB1bnN3aXp6bGVkIGEgR0dHUiB0ZXh0dXJlLCByZW1vdmUgdGhlIGZsYWcgZnJvbSB0aGUgYXNzZXRcbiAgICAgICAgICAgIGlmIChkYXRhLnVuc3dpenpsZWRHR0dSKSB7XG4gICAgICAgICAgICAgICAgYXNzZXQuZmlsZS52YXJpYW50cy5iYXNpcy5vcHQgJj0gfjg7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGV4dHVyZTtcbiAgICB9XG5cbiAgICBwYXRjaChhc3NldCwgYXNzZXRzKSB7XG4gICAgICAgIGNvbnN0IHRleHR1cmUgPSBhc3NldC5yZXNvdXJjZTtcbiAgICAgICAgaWYgKCF0ZXh0dXJlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoYXNzZXQubmFtZSAmJiBhc3NldC5uYW1lLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHRleHR1cmUubmFtZSA9IGFzc2V0Lm5hbWU7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBhc3NldERhdGEgPSBhc3NldC5kYXRhO1xuXG4gICAgICAgIGlmIChhc3NldERhdGEuaGFzT3duUHJvcGVydHkoJ21pbmZpbHRlcicpKSB7XG4gICAgICAgICAgICB0ZXh0dXJlLm1pbkZpbHRlciA9IEpTT05fRklMVEVSX01PREVbYXNzZXREYXRhLm1pbmZpbHRlcl07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoYXNzZXREYXRhLmhhc093blByb3BlcnR5KCdtYWdmaWx0ZXInKSkge1xuICAgICAgICAgICAgdGV4dHVyZS5tYWdGaWx0ZXIgPSBKU09OX0ZJTFRFUl9NT0RFW2Fzc2V0RGF0YS5tYWdmaWx0ZXJdO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCF0ZXh0dXJlLmN1YmVtYXApIHtcbiAgICAgICAgICAgIGlmIChhc3NldERhdGEuaGFzT3duUHJvcGVydHkoJ2FkZHJlc3N1JykpIHtcbiAgICAgICAgICAgICAgICB0ZXh0dXJlLmFkZHJlc3NVID0gSlNPTl9BRERSRVNTX01PREVbYXNzZXREYXRhLmFkZHJlc3N1XTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGFzc2V0RGF0YS5oYXNPd25Qcm9wZXJ0eSgnYWRkcmVzc3YnKSkge1xuICAgICAgICAgICAgICAgIHRleHR1cmUuYWRkcmVzc1YgPSBKU09OX0FERFJFU1NfTU9ERVthc3NldERhdGEuYWRkcmVzc3ZdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGFzc2V0RGF0YS5oYXNPd25Qcm9wZXJ0eSgnbWlwbWFwcycpKSB7XG4gICAgICAgICAgICB0ZXh0dXJlLm1pcG1hcHMgPSBhc3NldERhdGEubWlwbWFwcztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChhc3NldERhdGEuaGFzT3duUHJvcGVydHkoJ2FuaXNvdHJvcHknKSkge1xuICAgICAgICAgICAgdGV4dHVyZS5hbmlzb3Ryb3B5ID0gYXNzZXREYXRhLmFuaXNvdHJvcHk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoYXNzZXREYXRhLmhhc093blByb3BlcnR5KCdmbGlwWScpKSB7XG4gICAgICAgICAgICB0ZXh0dXJlLmZsaXBZID0gISFhc3NldERhdGEuZmxpcFk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBleHRyYWN0IGFzc2V0IHR5cGUgKHRoaXMgaXMgYml0IG9mIGEgbWVzcylcbiAgICAgICAgaWYgKGFzc2V0RGF0YS5oYXNPd25Qcm9wZXJ0eSgndHlwZScpKSB7XG4gICAgICAgICAgICB0ZXh0dXJlLnR5cGUgPSBKU09OX1RFWFRVUkVfVFlQRVthc3NldERhdGEudHlwZV07XG4gICAgICAgIH0gZWxzZSBpZiAoYXNzZXREYXRhLmhhc093blByb3BlcnR5KCdyZ2JtJykgJiYgYXNzZXREYXRhLnJnYm0pIHtcbiAgICAgICAgICAgIHRleHR1cmUudHlwZSA9IFRFWFRVUkVUWVBFX1JHQk07XG4gICAgICAgIH0gZWxzZSBpZiAoYXNzZXQuZmlsZSAmJiAoYXNzZXQuZmlsZS5vcHQgJiA4KSAhPT0gMCkge1xuICAgICAgICAgICAgLy8gYmFzaXMgbm9ybWFsbWFwcyBmbGFnIHRoZSB2YXJpYW50IGFzIHN3aXp6bGVkXG4gICAgICAgICAgICB0ZXh0dXJlLnR5cGUgPSBURVhUVVJFVFlQRV9TV0laWkxFR0dHUjtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IHsgVGV4dHVyZUhhbmRsZXIsIFRleHR1cmVQYXJzZXIgfTtcbiJdLCJuYW1lcyI6WyJKU09OX0FERFJFU1NfTU9ERSIsIkFERFJFU1NfUkVQRUFUIiwiQUREUkVTU19DTEFNUF9UT19FREdFIiwiQUREUkVTU19NSVJST1JFRF9SRVBFQVQiLCJKU09OX0ZJTFRFUl9NT0RFIiwiRklMVEVSX05FQVJFU1QiLCJGSUxURVJfTElORUFSIiwiRklMVEVSX05FQVJFU1RfTUlQTUFQX05FQVJFU1QiLCJGSUxURVJfTElORUFSX01JUE1BUF9ORUFSRVNUIiwiRklMVEVSX05FQVJFU1RfTUlQTUFQX0xJTkVBUiIsIkZJTFRFUl9MSU5FQVJfTUlQTUFQX0xJTkVBUiIsIkpTT05fVEVYVFVSRV9UWVBFIiwiVEVYVFVSRVRZUEVfREVGQVVMVCIsIlRFWFRVUkVUWVBFX1JHQk0iLCJURVhUVVJFVFlQRV9SR0JFIiwiVEVYVFVSRVRZUEVfUkdCUCIsIlRFWFRVUkVUWVBFX1NXSVpaTEVHR0dSIiwiVGV4dHVyZVBhcnNlciIsImxvYWQiLCJ1cmwiLCJjYWxsYmFjayIsImFzc2V0IiwiRXJyb3IiLCJvcGVuIiwiZGF0YSIsImRldmljZSIsIl9jb21wbGV0ZVBhcnRpYWxNaXBtYXBDaGFpbiIsInRleHR1cmUiLCJyZXF1aXJlZE1pcExldmVscyIsIk1hdGgiLCJsb2cyIiwibWF4IiwiX3dpZHRoIiwiX2hlaWdodCIsImlzSHRtbEVsZW1lbnQiLCJvYmplY3QiLCJIVE1MQ2FudmFzRWxlbWVudCIsIkhUTUxJbWFnZUVsZW1lbnQiLCJIVE1MVmlkZW9FbGVtZW50IiwiX2Zvcm1hdCIsIlBJWEVMRk9STUFUX1I4X0c4X0I4X0E4IiwiUElYRUxGT1JNQVRfUkdCQTMyRiIsIl92b2x1bWUiLCJfY29tcHJlc3NlZCIsIl9sZXZlbHMiLCJsZW5ndGgiLCJfY3ViZW1hcCIsImRvd25zYW1wbGUiLCJ3aWR0aCIsImhlaWdodCIsInNhbXBsZWRXaWR0aCIsInNhbXBsZWRIZWlnaHQiLCJzYW1wbGVkRGF0YSIsImNvbnN0cnVjdG9yIiwieHMiLCJmbG9vciIsInlzIiwieHN5cyIsInkiLCJ4IiwiZSIsInN1bSIsInN5Iiwic3giLCJsZXZlbCIsIm1pcHMiLCJmYWNlIiwicHVzaCIsIl9sZXZlbHNVcGRhdGVkIiwiVGV4dHVyZUhhbmRsZXIiLCJhcHAiLCJoYW5kbGVyVHlwZSIsImFzc2V0cyIsImdyYXBoaWNzRGV2aWNlIiwiX2RldmljZSIsIl9hc3NldHMiLCJfbG9hZGVyIiwibG9hZGVyIiwiaW1nUGFyc2VyIiwiSW1nUGFyc2VyIiwicGFyc2VycyIsImRkcyIsIkRkc1BhcnNlciIsImt0eCIsIkt0eFBhcnNlciIsImt0eDIiLCJLdHgyUGFyc2VyIiwiYmFzaXMiLCJCYXNpc1BhcnNlciIsImhkciIsIkhkclBhcnNlciIsImNyb3NzT3JpZ2luIiwidmFsdWUiLCJtYXhSZXRyaWVzIiwicGFyc2VyIiwiaGFzT3duUHJvcGVydHkiLCJfZ2V0VXJsV2l0aG91dFBhcmFtcyIsImluZGV4T2YiLCJzcGxpdCIsIl9nZXRQYXJzZXIiLCJleHQiLCJwYXRoIiwiZ2V0RXh0ZW5zaW9uIiwidG9Mb3dlckNhc2UiLCJyZXBsYWNlIiwib3JpZ2luYWwiLCJ1bmRlZmluZWQiLCJUZXh0dXJlIiwiZm9ybWF0IiwiUElYRUxGT1JNQVRfUjhfRzhfQjgiLCJ1bnN3aXp6bGVkR0dHUiIsImZpbGUiLCJ2YXJpYW50cyIsIm9wdCIsInBhdGNoIiwicmVzb3VyY2UiLCJuYW1lIiwiYXNzZXREYXRhIiwibWluRmlsdGVyIiwibWluZmlsdGVyIiwibWFnRmlsdGVyIiwibWFnZmlsdGVyIiwiY3ViZW1hcCIsImFkZHJlc3NVIiwiYWRkcmVzc3UiLCJhZGRyZXNzViIsImFkZHJlc3N2IiwibWlwbWFwcyIsImFuaXNvdHJvcHkiLCJmbGlwWSIsInR5cGUiLCJyZ2JtIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFzQkEsTUFBTUEsaUJBQWlCLEdBQUc7QUFDdEIsRUFBQSxRQUFRLEVBQUVDLGNBQWM7QUFDeEIsRUFBQSxPQUFPLEVBQUVDLHFCQUFxQjtBQUM5QixFQUFBLFFBQVEsRUFBRUMsdUJBQUFBO0FBQ2QsQ0FBQyxDQUFBO0FBRUQsTUFBTUMsZ0JBQWdCLEdBQUc7QUFDckIsRUFBQSxTQUFTLEVBQUVDLGNBQWM7QUFDekIsRUFBQSxRQUFRLEVBQUVDLGFBQWE7QUFDdkIsRUFBQSxxQkFBcUIsRUFBRUMsNkJBQTZCO0FBQ3BELEVBQUEsb0JBQW9CLEVBQUVDLDRCQUE0QjtBQUNsRCxFQUFBLG9CQUFvQixFQUFFQyw0QkFBNEI7QUFDbEQsRUFBQSxtQkFBbUIsRUFBRUMsMkJBQUFBO0FBQ3pCLENBQUMsQ0FBQTtBQUVELE1BQU1DLGlCQUFpQixHQUFHO0FBQ3RCLEVBQUEsU0FBUyxFQUFFQyxtQkFBbUI7QUFDOUIsRUFBQSxNQUFNLEVBQUVDLGdC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
