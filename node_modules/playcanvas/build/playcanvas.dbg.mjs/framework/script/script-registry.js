/**
 * @license
 * PlayCanvas Engine v1.58.0 revision 6672f604c (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { EventHandler } from '../../core/event-handler.js';

class ScriptRegistry extends EventHandler {
  constructor(app) {
    super();
    this.app = app;
    this._scripts = {};
    this._list = [];
  }
  destroy() {
    this.app = null;
    this.off();
  }

  add(script) {
    const scriptName = script.__name;
    if (this._scripts.hasOwnProperty(scriptName)) {
      setTimeout(() => {
        if (script.prototype.swap) {
          const old = this._scripts[scriptName];
          const ind = this._list.indexOf(old);
          this._list[ind] = script;
          this._scripts[scriptName] = script;
          this.fire('swap', scriptName, script);
          this.fire('swap:' + scriptName, script);
        } else {
          console.warn(`script registry already has '${scriptName}' script, define 'swap' method for new script type to enable code hot swapping`);
        }
      });
      return false;
    }
    this._scripts[scriptName] = script;
    this._list.push(script);
    this.fire('add', scriptName, script);
    this.fire('add:' + scriptName, script);

    setTimeout(() => {
      if (!this._scripts.hasOwnProperty(scriptName)) return;

      if (!this.app || !this.app.systems || !this.app.systems.script) {
        return;
      }
      const components = this.app.systems.script._components;
      let attributes;
      const scriptInstances = [];
      const scriptInstancesInitialized = [];
      for (components.loopIndex = 0; components.loopIndex < components.length; components.loopIndex++) {
        const component = components.items[components.loopIndex];
        if (component._scriptsIndex[scriptName] && component._scriptsIndex[scriptName].awaiting) {
          if (component._scriptsData && component._scriptsData[scriptName]) attributes = component._scriptsData[scriptName].attributes;
          const scriptInstance = component.create(scriptName, {
            preloading: true,
            ind: component._scriptsIndex[scriptName].ind,
            attributes: attributes
          });
          if (scriptInstance) scriptInstances.push(scriptInstance);
        }
      }

      for (let i = 0; i < scriptInstances.length; i++) scriptInstances[i].__initializeAttributes();

      for (let i = 0; i < scriptInstances.length; i++) {
        if (scriptInstances[i].enabled) {
          scriptInstances[i]._initialized = true;
          scriptInstancesInitialized.push(scriptInstances[i]);
          if (scriptInstances[i].initialize) scriptInstances[i].initialize();
        }
      }

      for (let i = 0; i < scriptInstancesInitialized.length; i++) {
        if (!scriptInstancesInitialized[i].enabled || scriptInstancesInitialized[i]._postInitialized) {
          continue;
        }
        scriptInstancesInitialized[i]._postInitialized = true;
        if (scriptInstancesInitialized[i].postInitialize) scriptInstancesInitialized[i].postInitialize();
      }
    });
    return true;
  }

  remove(nameOrType) {
    let scriptType = nameOrType;
    let scriptName = nameOrType;
    if (typeof scriptName !== 'string') {
      scriptName = scriptType.__name;
    } else {
      scriptType = this.get(scriptName);
    }
    if (this.get(scriptName) !== scriptType) return false;
    delete this._scripts[scriptName];
    const ind = this._list.indexOf(scriptType);
    this._list.splice(ind, 1);
    this.fire('remove', scriptName, scriptType);
    this.fire('remove:' + scriptName, scriptType);
    return true;
  }

  get(name) {
    return this._scripts[name] || null;
  }

  has(nameOrType) {
    if (typeof nameOrType === 'string') {
      return this._scripts.hasOwnProperty(nameOrType);
    }
    if (!nameOrType) return false;
    const scriptName = nameOrType.__name;
    return this._scripts[scriptName] === nameOrType;
  }

  list() {
    return this._list;
  }
}

export { ScriptRegistry };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NyaXB0LXJlZ2lzdHJ5LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvZnJhbWV3b3JrL3NjcmlwdC9zY3JpcHQtcmVnaXN0cnkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRXZlbnRIYW5kbGVyIH0gZnJvbSAnLi4vLi4vY29yZS9ldmVudC1oYW5kbGVyLmpzJztcblxuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4uL2FwcC1iYXNlLmpzJykuQXBwQmFzZX0gQXBwQmFzZSAqL1xuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4vc2NyaXB0LXR5cGUuanMnKS5TY3JpcHRUeXBlfSBTY3JpcHRUeXBlICovXG5cbi8qKlxuICogQ29udGFpbmVyIGZvciBhbGwge0BsaW5rIFNjcmlwdFR5cGV9cyB0aGF0IGFyZSBhdmFpbGFibGUgdG8gdGhpcyBhcHBsaWNhdGlvbi4gTm90ZSB0aGF0XG4gKiBQbGF5Q2FudmFzIHNjcmlwdHMgY2FuIGFjY2VzcyB0aGUgU2NyaXB0IFJlZ2lzdHJ5IGZyb20gaW5zaWRlIHRoZSBhcHBsaWNhdGlvbiB3aXRoXG4gKiB7QGxpbmsgQXBwQmFzZSNzY3JpcHRzfS5cbiAqXG4gKiBAYXVnbWVudHMgRXZlbnRIYW5kbGVyXG4gKi9cbmNsYXNzIFNjcmlwdFJlZ2lzdHJ5IGV4dGVuZHMgRXZlbnRIYW5kbGVyIHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgU2NyaXB0UmVnaXN0cnkgaW5zdGFuY2UuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0FwcEJhc2V9IGFwcCAtIEFwcGxpY2F0aW9uIHRvIGF0dGFjaCByZWdpc3RyeSB0by5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihhcHApIHtcbiAgICAgICAgc3VwZXIoKTtcblxuICAgICAgICB0aGlzLmFwcCA9IGFwcDtcbiAgICAgICAgdGhpcy5fc2NyaXB0cyA9IHsgfTtcbiAgICAgICAgdGhpcy5fbGlzdCA9IFtdO1xuICAgIH1cblxuICAgIGRlc3Ryb3koKSB7XG4gICAgICAgIHRoaXMuYXBwID0gbnVsbDtcbiAgICAgICAgdGhpcy5vZmYoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBZGQge0BsaW5rIFNjcmlwdFR5cGV9IHRvIHJlZ2lzdHJ5LiBOb3RlOiB3aGVuIHtAbGluayBjcmVhdGVTY3JpcHR9IGlzIGNhbGxlZCwgaXQgd2lsbCBhZGRcbiAgICAgKiB0aGUge0BsaW5rIFNjcmlwdFR5cGV9IHRvIHRoZSByZWdpc3RyeSBhdXRvbWF0aWNhbGx5LiBJZiBhIHNjcmlwdCBhbHJlYWR5IGV4aXN0cyBpblxuICAgICAqIHJlZ2lzdHJ5LCBhbmQgdGhlIG5ldyBzY3JpcHQgaGFzIGEgYHN3YXBgIG1ldGhvZCBkZWZpbmVkLCBpdCB3aWxsIHBlcmZvcm0gY29kZSBob3Qgc3dhcHBpbmdcbiAgICAgKiBhdXRvbWF0aWNhbGx5IGluIGFzeW5jIG1hbm5lci5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7Q2xhc3M8U2NyaXB0VHlwZT59IHNjcmlwdCAtIFNjcmlwdCBUeXBlIHRoYXQgaXMgY3JlYXRlZCB1c2luZyB7QGxpbmsgY3JlYXRlU2NyaXB0fS5cbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gVHJ1ZSBpZiBhZGRlZCBmb3IgdGhlIGZpcnN0IHRpbWUgb3IgZmFsc2UgaWYgc2NyaXB0IGFscmVhZHkgZXhpc3RzLlxuICAgICAqIEBleGFtcGxlXG4gICAgICogdmFyIFBsYXllckNvbnRyb2xsZXIgPSBwYy5jcmVhdGVTY3JpcHQoJ3BsYXllckNvbnRyb2xsZXInKTtcbiAgICAgKiAvLyBwbGF5ZXJDb250cm9sbGVyIFNjcmlwdCBUeXBlIHdpbGwgYmUgYWRkZWQgdG8gcGMuU2NyaXB0UmVnaXN0cnkgYXV0b21hdGljYWxseVxuICAgICAqIGNvbnNvbGUubG9nKGFwcC5zY3JpcHRzLmhhcygncGxheWVyQ29udHJvbGxlcicpKTsgLy8gb3V0cHV0cyB0cnVlXG4gICAgICovXG4gICAgYWRkKHNjcmlwdCkge1xuICAgICAgICBjb25zdCBzY3JpcHROYW1lID0gc2NyaXB0Ll9fbmFtZTtcblxuICAgICAgICBpZiAodGhpcy5fc2NyaXB0cy5oYXNPd25Qcm9wZXJ0eShzY3JpcHROYW1lKSkge1xuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHNjcmlwdC5wcm90b3R5cGUuc3dhcCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBzd2FwcGluZ1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBvbGQgPSB0aGlzLl9zY3JpcHRzW3NjcmlwdE5hbWVdO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBpbmQgPSB0aGlzLl9saXN0LmluZGV4T2Yob2xkKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbGlzdFtpbmRdID0gc2NyaXB0O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9zY3JpcHRzW3NjcmlwdE5hbWVdID0gc2NyaXB0O1xuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmlyZSgnc3dhcCcsIHNjcmlwdE5hbWUsIHNjcmlwdCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmlyZSgnc3dhcDonICsgc2NyaXB0TmFtZSwgc2NyaXB0KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYHNjcmlwdCByZWdpc3RyeSBhbHJlYWR5IGhhcyAnJHtzY3JpcHROYW1lfScgc2NyaXB0LCBkZWZpbmUgJ3N3YXAnIG1ldGhvZCBmb3IgbmV3IHNjcmlwdCB0eXBlIHRvIGVuYWJsZSBjb2RlIGhvdCBzd2FwcGluZ2ApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fc2NyaXB0c1tzY3JpcHROYW1lXSA9IHNjcmlwdDtcbiAgICAgICAgdGhpcy5fbGlzdC5wdXNoKHNjcmlwdCk7XG5cbiAgICAgICAgdGhpcy5maXJlKCdhZGQnLCBzY3JpcHROYW1lLCBzY3JpcHQpO1xuICAgICAgICB0aGlzLmZpcmUoJ2FkZDonICsgc2NyaXB0TmFtZSwgc2NyaXB0KTtcblxuICAgICAgICAvLyBmb3IgYWxsIGNvbXBvbmVudHMgYXdhaXRpbmcgU2NyaXB0IFR5cGVcbiAgICAgICAgLy8gY3JlYXRlIHNjcmlwdCBpbnN0YW5jZVxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIGlmICghdGhpcy5fc2NyaXB0cy5oYXNPd25Qcm9wZXJ0eShzY3JpcHROYW1lKSlcbiAgICAgICAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgICAgIC8vIHRoaXMgaXMgYSBjaGVjayBmb3IgYSBwb3NzaWJsZSBlcnJvclxuICAgICAgICAgICAgLy8gdGhhdCBtaWdodCBoYXBwZW4gaWYgdGhlIGFwcCBoYXMgYmVlbiBkZXN0cm95ZWQgYmVmb3JlXG4gICAgICAgICAgICAvLyBzZXRUaW1lb3V0IGhhcyBmaW5pc2hlZFxuICAgICAgICAgICAgaWYgKCF0aGlzLmFwcCB8fCAhdGhpcy5hcHAuc3lzdGVtcyB8fCAhdGhpcy5hcHAuc3lzdGVtcy5zY3JpcHQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IGNvbXBvbmVudHMgPSB0aGlzLmFwcC5zeXN0ZW1zLnNjcmlwdC5fY29tcG9uZW50cztcbiAgICAgICAgICAgIGxldCBhdHRyaWJ1dGVzO1xuICAgICAgICAgICAgY29uc3Qgc2NyaXB0SW5zdGFuY2VzID0gW107XG4gICAgICAgICAgICBjb25zdCBzY3JpcHRJbnN0YW5jZXNJbml0aWFsaXplZCA9IFtdO1xuXG4gICAgICAgICAgICBmb3IgKGNvbXBvbmVudHMubG9vcEluZGV4ID0gMDsgY29tcG9uZW50cy5sb29wSW5kZXggPCBjb21wb25lbnRzLmxlbmd0aDsgY29tcG9uZW50cy5sb29wSW5kZXgrKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvbXBvbmVudCA9IGNvbXBvbmVudHMuaXRlbXNbY29tcG9uZW50cy5sb29wSW5kZXhdO1xuICAgICAgICAgICAgICAgIC8vIGNoZWNrIGlmIGF3YWl0aW5nIGZvciBzY3JpcHRcbiAgICAgICAgICAgICAgICBpZiAoY29tcG9uZW50Ll9zY3JpcHRzSW5kZXhbc2NyaXB0TmFtZV0gJiYgY29tcG9uZW50Ll9zY3JpcHRzSW5kZXhbc2NyaXB0TmFtZV0uYXdhaXRpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbXBvbmVudC5fc2NyaXB0c0RhdGEgJiYgY29tcG9uZW50Ll9zY3JpcHRzRGF0YVtzY3JpcHROYW1lXSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXMgPSBjb21wb25lbnQuX3NjcmlwdHNEYXRhW3NjcmlwdE5hbWVdLmF0dHJpYnV0ZXM7XG5cbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2NyaXB0SW5zdGFuY2UgPSBjb21wb25lbnQuY3JlYXRlKHNjcmlwdE5hbWUsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByZWxvYWRpbmc6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBpbmQ6IGNvbXBvbmVudC5fc2NyaXB0c0luZGV4W3NjcmlwdE5hbWVdLmluZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXM6IGF0dHJpYnV0ZXNcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjcmlwdEluc3RhbmNlKVxuICAgICAgICAgICAgICAgICAgICAgICAgc2NyaXB0SW5zdGFuY2VzLnB1c2goc2NyaXB0SW5zdGFuY2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gaW5pdGlhbGl6ZSBhdHRyaWJ1dGVzXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNjcmlwdEluc3RhbmNlcy5sZW5ndGg7IGkrKylcbiAgICAgICAgICAgICAgICBzY3JpcHRJbnN0YW5jZXNbaV0uX19pbml0aWFsaXplQXR0cmlidXRlcygpO1xuXG4gICAgICAgICAgICAvLyBjYWxsIGluaXRpYWxpemUoKVxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzY3JpcHRJbnN0YW5jZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAoc2NyaXB0SW5zdGFuY2VzW2ldLmVuYWJsZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NyaXB0SW5zdGFuY2VzW2ldLl9pbml0aWFsaXplZCA9IHRydWU7XG5cbiAgICAgICAgICAgICAgICAgICAgc2NyaXB0SW5zdGFuY2VzSW5pdGlhbGl6ZWQucHVzaChzY3JpcHRJbnN0YW5jZXNbaV0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY3JpcHRJbnN0YW5jZXNbaV0uaW5pdGlhbGl6ZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjcmlwdEluc3RhbmNlc1tpXS5pbml0aWFsaXplKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBjYWxsIHBvc3RJbml0aWFsaXplKClcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2NyaXB0SW5zdGFuY2VzSW5pdGlhbGl6ZWQubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAoIXNjcmlwdEluc3RhbmNlc0luaXRpYWxpemVkW2ldLmVuYWJsZWQgfHwgc2NyaXB0SW5zdGFuY2VzSW5pdGlhbGl6ZWRbaV0uX3Bvc3RJbml0aWFsaXplZCkge1xuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBzY3JpcHRJbnN0YW5jZXNJbml0aWFsaXplZFtpXS5fcG9zdEluaXRpYWxpemVkID0gdHJ1ZTtcblxuICAgICAgICAgICAgICAgIGlmIChzY3JpcHRJbnN0YW5jZXNJbml0aWFsaXplZFtpXS5wb3N0SW5pdGlhbGl6ZSlcbiAgICAgICAgICAgICAgICAgICAgc2NyaXB0SW5zdGFuY2VzSW5pdGlhbGl6ZWRbaV0ucG9zdEluaXRpYWxpemUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlIHtAbGluayBTY3JpcHRUeXBlfS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfENsYXNzPFNjcmlwdFR5cGU+fSBuYW1lT3JUeXBlIC0gVGhlIG5hbWUgb3IgdHlwZSBvZiB7QGxpbmsgU2NyaXB0VHlwZX0uXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFRydWUgaWYgcmVtb3ZlZCBvciBGYWxzZSBpZiBhbHJlYWR5IG5vdCBpbiByZWdpc3RyeS5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIGFwcC5zY3JpcHRzLnJlbW92ZSgncGxheWVyQ29udHJvbGxlcicpO1xuICAgICAqL1xuICAgIHJlbW92ZShuYW1lT3JUeXBlKSB7XG4gICAgICAgIGxldCBzY3JpcHRUeXBlID0gbmFtZU9yVHlwZTtcbiAgICAgICAgbGV0IHNjcmlwdE5hbWUgPSBuYW1lT3JUeXBlO1xuXG4gICAgICAgIGlmICh0eXBlb2Ygc2NyaXB0TmFtZSAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHNjcmlwdE5hbWUgPSBzY3JpcHRUeXBlLl9fbmFtZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHNjcmlwdFR5cGUgPSB0aGlzLmdldChzY3JpcHROYW1lKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmdldChzY3JpcHROYW1lKSAhPT0gc2NyaXB0VHlwZSlcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcblxuICAgICAgICBkZWxldGUgdGhpcy5fc2NyaXB0c1tzY3JpcHROYW1lXTtcbiAgICAgICAgY29uc3QgaW5kID0gdGhpcy5fbGlzdC5pbmRleE9mKHNjcmlwdFR5cGUpO1xuICAgICAgICB0aGlzLl9saXN0LnNwbGljZShpbmQsIDEpO1xuXG4gICAgICAgIHRoaXMuZmlyZSgncmVtb3ZlJywgc2NyaXB0TmFtZSwgc2NyaXB0VHlwZSk7XG4gICAgICAgIHRoaXMuZmlyZSgncmVtb3ZlOicgKyBzY3JpcHROYW1lLCBzY3JpcHRUeXBlKTtcblxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQge0BsaW5rIFNjcmlwdFR5cGV9IGJ5IG5hbWUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbmFtZSAtIE5hbWUgb2YgYSB7QGxpbmsgU2NyaXB0VHlwZX0uXG4gICAgICogQHJldHVybnMge0NsYXNzPFNjcmlwdFR5cGU+fSBUaGUgU2NyaXB0IFR5cGUgaWYgaXQgZXhpc3RzIGluIHRoZSByZWdpc3RyeSBvciBudWxsIG90aGVyd2lzZS5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIHZhciBQbGF5ZXJDb250cm9sbGVyID0gYXBwLnNjcmlwdHMuZ2V0KCdwbGF5ZXJDb250cm9sbGVyJyk7XG4gICAgICovXG4gICAgZ2V0KG5hbWUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NjcmlwdHNbbmFtZV0gfHwgbnVsbDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVjayBpZiBhIHtAbGluayBTY3JpcHRUeXBlfSB3aXRoIHRoZSBzcGVjaWZpZWQgbmFtZSBpcyBpbiB0aGUgcmVnaXN0cnkuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ3xDbGFzczxTY3JpcHRUeXBlPn0gbmFtZU9yVHlwZSAtIFRoZSBuYW1lIG9yIHR5cGUgb2Yge0BsaW5rIFNjcmlwdFR5cGV9LlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBUcnVlIGlmIHtAbGluayBTY3JpcHRUeXBlfSBpcyBpbiByZWdpc3RyeS5cbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIGlmIChhcHAuc2NyaXB0cy5oYXMoJ3BsYXllckNvbnRyb2xsZXInKSkge1xuICAgICAqICAgICAvLyBwbGF5ZXJDb250cm9sbGVyIGlzIGluIHBjLlNjcmlwdFJlZ2lzdHJ5XG4gICAgICogfVxuICAgICAqL1xuICAgIGhhcyhuYW1lT3JUeXBlKSB7XG4gICAgICAgIGlmICh0eXBlb2YgbmFtZU9yVHlwZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zY3JpcHRzLmhhc093blByb3BlcnR5KG5hbWVPclR5cGUpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFuYW1lT3JUeXBlKSByZXR1cm4gZmFsc2U7XG4gICAgICAgIGNvbnN0IHNjcmlwdE5hbWUgPSBuYW1lT3JUeXBlLl9fbmFtZTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NjcmlwdHNbc2NyaXB0TmFtZV0gPT09IG5hbWVPclR5cGU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IGxpc3Qgb2YgYWxsIHtAbGluayBTY3JpcHRUeXBlfXMgZnJvbSByZWdpc3RyeS5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtBcnJheTxDbGFzczxTY3JpcHRUeXBlPj59IGxpc3Qgb2YgYWxsIHtAbGluayBTY3JpcHRUeXBlfXMgaW4gcmVnaXN0cnkuXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiAvLyBsb2dzIGFycmF5IG9mIGFsbCBTY3JpcHQgVHlwZSBuYW1lcyBhdmFpbGFibGUgaW4gcmVnaXN0cnlcbiAgICAgKiBjb25zb2xlLmxvZyhhcHAuc2NyaXB0cy5saXN0KCkubWFwKGZ1bmN0aW9uIChvKSB7XG4gICAgICogICAgIHJldHVybiBvLm5hbWU7XG4gICAgICogfSkpO1xuICAgICAqL1xuICAgIGxpc3QoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9saXN0O1xuICAgIH1cbn1cblxuZXhwb3J0IHsgU2NyaXB0UmVnaXN0cnkgfTtcbiJdLCJuYW1lcyI6WyJTY3JpcHRSZWdpc3RyeSIsIkV2ZW50SGFuZGxlciIsImNvbnN0cnVjdG9yIiwiYXBwIiwiX3NjcmlwdHMiLCJfbGlzdCIsImRlc3Ryb3kiLCJvZmYiLCJhZGQiLCJzY3JpcHQiLCJzY3JpcHROYW1lIiwiX19uYW1lIiwiaGFzT3duUHJvcGVydHkiLCJzZXRUaW1lb3V0IiwicHJvdG90eXBlIiwic3dhcCIsIm9sZCIsImluZCIsImluZGV4T2YiLCJmaXJlIiwiY29uc29sZSIsIndhcm4iLCJwdXNoIiwic3lzdGVtcyIsImNvbXBvbmVudHMiLCJfY29tcG9uZW50cyIsImF0dHJpYnV0ZXMiLCJzY3JpcHRJbnN0YW5jZXMiLCJzY3JpcHRJbnN0YW5jZXNJbml0aWFsaXplZCIsImxvb3BJbmRleCIsImxlbmd0aCIsImNvbXBvbmVudCIsIml0ZW1zIiwiX3NjcmlwdHNJbmRleCIsImF3YWl0aW5nIiwiX3NjcmlwdHNEYXRhIiwic2NyaXB0SW5zdGFuY2UiLCJjcmVhdGUiLCJwcmVsb2FkaW5nIiwiaSIsIl9faW5pdGlhbGl6ZUF0dHJpYnV0ZXMiLCJlbmFibGVkIiwiX2luaXRpYWxpemVkIiwiaW5pdGlhbGl6ZSIsIl9wb3N0SW5pdGlhbGl6ZWQiLCJwb3N0SW5pdGlhbGl6ZSIsInJlbW92ZSIsIm5hbWVPclR5cGUiLCJzY3JpcHRUeXBlIiwiZ2V0Iiwic3BsaWNlIiwibmFtZSIsImhhcyIsImxpc3QiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFZQSxNQUFNQSxjQUFjLFNBQVNDLFlBQVksQ0FBQztFQU10Q0MsV0FBVyxDQUFDQyxHQUFHLEVBQUU7QUFDYixJQUFBLEtBQUssRUFBRSxDQUFBO0lBRVAsSUFBSSxDQUFDQSxHQUFHLEdBQUdBLEdBQUcsQ0FBQTtBQUNkLElBQUEsSUFBSSxDQUFDQyxRQUFRLEdBQUcsRUFBRyxDQUFBO0lBQ25CLElBQUksQ0FBQ0MsS0FBSyxHQUFHLEVBQUUsQ0FBQTtBQUNuQixHQUFBO0FBRUFDLEVBQUFBLE9BQU8sR0FBRztJQUNOLElBQUksQ0FBQ0gsR0FBRyxHQUFHLElBQUksQ0FBQTtJQUNmLElBQUksQ0FBQ0ksR0FBRyxFQUFFLENBQUE7QUFDZCxHQUFBOztFQWVBQyxHQUFHLENBQUNDLE1BQU0sRUFBRTtBQUNSLElBQUEsTUFBTUMsVUFBVSxH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
