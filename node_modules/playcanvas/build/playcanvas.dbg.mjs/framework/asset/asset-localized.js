/**
 * @license
 * PlayCanvas Engine v1.58.0 revision 6672f604c (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { EventHandler } from '../../core/event-handler.js';
import { Asset } from './asset.js';

class LocalizedAsset extends EventHandler {
  constructor(app) {
    super();
    this._app = app;
    app.i18n.on('set:locale', this._onSetLocale, this);
    this._autoLoad = false;
    this._disableLocalization = false;
    this._defaultAsset = null;
    this._localizedAsset = null;
  }
  set defaultAsset(value) {
    const id = value instanceof Asset ? value.id : value;
    if (this._defaultAsset === id) return;
    if (this._defaultAsset) {
      this._unbindDefaultAsset();
    }
    this._defaultAsset = id;
    if (this._defaultAsset) {
      this._bindDefaultAsset();
    }

    this._onSetLocale(this._app.i18n.locale);
  }
  get defaultAsset() {
    return this._defaultAsset;
  }
  set localizedAsset(value) {
    const id = value instanceof Asset ? value.id : value;
    if (this._localizedAsset === id) {
      return;
    }
    if (this._localizedAsset) {
      this._app.assets.off('add:' + this._localizedAsset, this._onLocalizedAssetAdd, this);
      this._unbindLocalizedAsset();
      this._localizedAsset = null;
    }
    this._localizedAsset = id;
    if (this._localizedAsset) {
      const asset = this._app.assets.get(this._localizedAsset);
      if (!asset) {
        this._app.assets.once('add:' + this._localizedAsset, this._onLocalizedAssetAdd, this);
      } else {
        this._bindLocalizedAsset();
      }
    }
  }
  get localizedAsset() {
    return this._localizedAsset;
  }
  set autoLoad(value) {
    if (this._autoLoad === value) return;
    this._autoLoad = value;
    if (this._autoLoad && this._localizedAsset) {
      this._unbindLocalizedAsset();
      this._bindLocalizedAsset();
    }
  }
  get autoLoad() {
    return this._autoLoad;
  }
  set disableLocalization(value) {
    if (this._disableLocalization === value) return;
    this._disableLocalization = value;

    this._onSetLocale(this._app.i18n.locale);
  }
  get disableLocalization() {
    return this._disableLocalization;
  }
  _bindDefaultAsset() {
    const asset = this._app.assets.get(this._defaultAsset);
    if (!asset) {
      this._app.assets.once('add:' + this._defaultAsset, this._onDefaultAssetAdd, this);
    } else {
      this._onDefaultAssetAdd(asset);
    }
  }
  _unbindDefaultAsset() {
    if (!this._defaultAsset) return;
    this._app.assets.off('add:' + this._defaultAsset, this._onDefaultAssetAdd, this);
    const asset = this._app.assets.get(this._defaultAsset);
    if (!asset) return;
    asset.off('add:localized', this._onLocaleAdd, this);
    asset.off('remove:localized', this._onLocaleRemove, this);
    asset.off('remove', this._onDefaultAssetRemove, this);
  }
  _onDefaultAssetAdd(asset) {
    if (this._defaultAsset !== asset.id) return;
    asset.on('add:localized', this._onLocaleAdd, this);
    asset.on('remove:localized', this._onLocaleRemove, this);
    asset.once('remove', this._onDefaultAssetRemove, this);
  }
  _onDefaultAssetRemove(asset) {
    if (this._defaultAsset !== asset.id) return;
    asset.off('add:localized', this._onLocaleAdd, this);
    asset.off('remove:localized', this._onLocaleAdd, this);
    this._app.assets.once('add:' + this._defaultAsset, this._onDefaultAssetAdd, this);
  }
  _bindLocalizedAsset() {
    if (!this._autoLoad) return;
    const asset = this._app.assets.get(this._localizedAsset);
    if (!asset) return;
    asset.on('load', this._onLocalizedAssetLoad, this);
    asset.on('change', this._onLocalizedAssetChange, this);
    asset.on('remove', this._onLocalizedAssetRemove, this);
    if (asset.resource) {
      this._onLocalizedAssetLoad(asset);
    } else {
      this._app.assets.load(asset);
    }
  }
  _unbindLocalizedAsset() {
    const asset = this._app.assets.get(this._localizedAsset);
    if (!asset) return;
    asset.off('load', this._onLocalizedAssetLoad, this);
    asset.off('change', this._onLocalizedAssetChange, this);
    asset.off('remove', this._onLocalizedAssetRemove, this);
  }
  _onLocalizedAssetAdd(asset) {
    if (this._localizedAsset !== asset.id) return;
    this._bindLocalizedAsset();
  }
  _onLocalizedAssetLoad(asset) {
    this.fire('load', asset);
  }
  _onLocalizedAssetChange(asset, name, newValue, oldValue) {
    this.fire('change', asset, name, newValue, oldValue);
  }
  _onLocalizedAssetRemove(asset) {
    if (this._localizedAsset === asset.id) {
      this.localizedAsset = this._defaultAsset;
    }
    this.fire('remove', asset);
  }
  _onLocaleAdd(locale, assetId) {
    if (this._app.i18n.locale !== locale) return;

    this._onSetLocale(locale);
  }
  _onLocaleRemove(locale, assetId) {
    if (this._app.i18n.locale !== locale) return;

    this._onSetLocale(locale);
  }
  _onSetLocale(locale) {
    if (!this._defaultAsset) {
      this.localizedAsset = null;
      return;
    }
    const asset = this._app.assets.get(this._defaultAsset);
    if (!asset || this._disableLocalization) {
      this.localizedAsset = this._defaultAsset;
      return;
    }
    const localizedAssetId = asset.getLocalizedAssetId(locale);
    if (!localizedAssetId) {
      this.localizedAsset = this._defaultAsset;
      return;
    }
    this.localizedAsset = localizedAssetId;
  }
  destroy() {
    this.defaultAsset = null;
    this._app.i18n.off('set:locale', this._onSetLocale, this);
    this.off();
  }
}

export { LocalizedAsset };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXNzZXQtbG9jYWxpemVkLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvZnJhbWV3b3JrL2Fzc2V0L2Fzc2V0LWxvY2FsaXplZC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFdmVudEhhbmRsZXIgfSBmcm9tICcuLi8uLi9jb3JlL2V2ZW50LWhhbmRsZXIuanMnO1xuXG5pbXBvcnQgeyBBc3NldCB9IGZyb20gJy4vYXNzZXQuanMnO1xuXG5jbGFzcyBMb2NhbGl6ZWRBc3NldCBleHRlbmRzIEV2ZW50SGFuZGxlciB7XG4gICAgY29uc3RydWN0b3IoYXBwKSB7XG4gICAgICAgIHN1cGVyKCk7XG5cbiAgICAgICAgdGhpcy5fYXBwID0gYXBwO1xuICAgICAgICBhcHAuaTE4bi5vbignc2V0OmxvY2FsZScsIHRoaXMuX29uU2V0TG9jYWxlLCB0aGlzKTtcblxuICAgICAgICB0aGlzLl9hdXRvTG9hZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLl9kaXNhYmxlTG9jYWxpemF0aW9uID0gZmFsc2U7XG5cbiAgICAgICAgdGhpcy5fZGVmYXVsdEFzc2V0ID0gbnVsbDtcbiAgICAgICAgdGhpcy5fbG9jYWxpemVkQXNzZXQgPSBudWxsO1xuICAgIH1cblxuICAgIHNldCBkZWZhdWx0QXNzZXQodmFsdWUpIHtcbiAgICAgICAgY29uc3QgaWQgPSB2YWx1ZSBpbnN0YW5jZW9mIEFzc2V0ID8gdmFsdWUuaWQgOiB2YWx1ZTtcblxuICAgICAgICBpZiAodGhpcy5fZGVmYXVsdEFzc2V0ID09PSBpZCkgcmV0dXJuO1xuXG4gICAgICAgIGlmICh0aGlzLl9kZWZhdWx0QXNzZXQpIHtcbiAgICAgICAgICAgIHRoaXMuX3VuYmluZERlZmF1bHRBc3NldCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fZGVmYXVsdEFzc2V0ID0gaWQ7XG5cbiAgICAgICAgaWYgKHRoaXMuX2RlZmF1bHRBc3NldCkge1xuICAgICAgICAgICAgdGhpcy5fYmluZERlZmF1bHRBc3NldCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gcmVzZXQgbG9jYWxpemVkIGFzc2V0XG4gICAgICAgIHRoaXMuX29uU2V0TG9jYWxlKHRoaXMuX2FwcC5pMThuLmxvY2FsZSk7XG4gICAgfVxuXG4gICAgZ2V0IGRlZmF1bHRBc3NldCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2RlZmF1bHRBc3NldDtcbiAgICB9XG5cbiAgICBzZXQgbG9jYWxpemVkQXNzZXQodmFsdWUpIHtcbiAgICAgICAgY29uc3QgaWQgPSB2YWx1ZSBpbnN0YW5jZW9mIEFzc2V0ID8gdmFsdWUuaWQgOiB2YWx1ZTtcbiAgICAgICAgaWYgKHRoaXMuX2xvY2FsaXplZEFzc2V0ID09PSBpZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuX2xvY2FsaXplZEFzc2V0KSB7XG4gICAgICAgICAgICB0aGlzLl9hcHAuYXNzZXRzLm9mZignYWRkOicgKyB0aGlzLl9sb2NhbGl6ZWRBc3NldCwgdGhpcy5fb25Mb2NhbGl6ZWRBc3NldEFkZCwgdGhpcyk7XG4gICAgICAgICAgICB0aGlzLl91bmJpbmRMb2NhbGl6ZWRBc3NldCgpO1xuICAgICAgICAgICAgdGhpcy5fbG9jYWxpemVkQXNzZXQgPSBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fbG9jYWxpemVkQXNzZXQgPSBpZDtcblxuICAgICAgICBpZiAodGhpcy5fbG9jYWxpemVkQXNzZXQpIHtcbiAgICAgICAgICAgIGNvbnN0IGFzc2V0ID0gdGhpcy5fYXBwLmFzc2V0cy5nZXQodGhpcy5fbG9jYWxpemVkQXNzZXQpO1xuICAgICAgICAgICAgaWYgKCFhc3NldCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2FwcC5hc3NldHMub25jZSgnYWRkOicgKyB0aGlzLl9sb2NhbGl6ZWRBc3NldCwgdGhpcy5fb25Mb2NhbGl6ZWRBc3NldEFkZCwgdGhpcyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuX2JpbmRMb2NhbGl6ZWRBc3NldCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0IGxvY2FsaXplZEFzc2V0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fbG9jYWxpemVkQXNzZXQ7XG4gICAgfVxuXG4gICAgc2V0IGF1dG9Mb2FkKHZhbHVlKSB7XG4gICAgICAgIGlmICh0aGlzLl9hdXRvTG9hZCA9PT0gdmFsdWUpIHJldHVybjtcblxuICAgICAgICB0aGlzLl9hdXRvTG9hZCA9IHZhbHVlO1xuXG4gICAgICAgIGlmICh0aGlzLl9hdXRvTG9hZCAmJiB0aGlzLl9sb2NhbGl6ZWRBc3NldCkge1xuICAgICAgICAgICAgdGhpcy5fdW5iaW5kTG9jYWxpemVkQXNzZXQoKTtcbiAgICAgICAgICAgIHRoaXMuX2JpbmRMb2NhbGl6ZWRBc3NldCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0IGF1dG9Mb2FkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fYXV0b0xvYWQ7XG4gICAgfVxuXG4gICAgc2V0IGRpc2FibGVMb2NhbGl6YXRpb24odmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMuX2Rpc2FibGVMb2NhbGl6YXRpb24gPT09IHZhbHVlKSByZXR1cm47XG5cbiAgICAgICAgdGhpcy5fZGlzYWJsZUxvY2FsaXphdGlvbiA9IHZhbHVlO1xuXG4gICAgICAgIC8vIHJlc2V0IGxvY2FsaXplZCBhc3NldFxuICAgICAgICB0aGlzLl9vblNldExvY2FsZSh0aGlzLl9hcHAuaTE4bi5sb2NhbGUpO1xuICAgIH1cblxuICAgIGdldCBkaXNhYmxlTG9jYWxpemF0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fZGlzYWJsZUxvY2FsaXphdGlvbjtcbiAgICB9XG5cbiAgICBfYmluZERlZmF1bHRBc3NldCgpIHtcbiAgICAgICAgY29uc3QgYXNzZXQgPSB0aGlzLl9hcHAuYXNzZXRzLmdldCh0aGlzLl9kZWZhdWx0QXNzZXQpO1xuICAgICAgICBpZiAoIWFzc2V0KSB7XG4gICAgICAgICAgICB0aGlzLl9hcHAuYXNzZXRzLm9uY2UoJ2FkZDonICsgdGhpcy5fZGVmYXVsdEFzc2V0LCB0aGlzLl9vbkRlZmF1bHRBc3NldEFkZCwgdGhpcyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9vbkRlZmF1bHRBc3NldEFkZChhc3NldCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBfdW5iaW5kRGVmYXVsdEFzc2V0KCkge1xuICAgICAgICBpZiAoIXRoaXMuX2RlZmF1bHRBc3NldCkgcmV0dXJuO1xuXG4gICAgICAgIHRoaXMuX2FwcC5hc3NldHMub2ZmKCdhZGQ6JyArIHRoaXMuX2RlZmF1bHRBc3NldCwgdGhpcy5fb25EZWZhdWx0QXNzZXRBZGQsIHRoaXMpO1xuXG4gICAgICAgIGNvbnN0IGFzc2V0ID0gdGhpcy5fYXBwLmFzc2V0cy5nZXQodGhpcy5fZGVmYXVsdEFzc2V0KTtcbiAgICAgICAgaWYgKCFhc3NldCkgcmV0dXJuO1xuXG4gICAgICAgIGFzc2V0Lm9mZignYWRkOmxvY2FsaXplZCcsIHRoaXMuX29uTG9jYWxlQWRkLCB0aGlzKTtcbiAgICAgICAgYXNzZXQub2ZmKCdyZW1vdmU6bG9jYWxpemVkJywgdGhpcy5fb25Mb2NhbGVSZW1vdmUsIHRoaXMpO1xuICAgICAgICBhc3NldC5vZmYoJ3JlbW92ZScsIHRoaXMuX29uRGVmYXVsdEFzc2V0UmVtb3ZlLCB0aGlzKTtcbiAgICB9XG5cbiAgICBfb25EZWZhdWx0QXNzZXRBZGQoYXNzZXQpIHtcbiAgICAgICAgaWYgKHRoaXMuX2RlZmF1bHRBc3NldCAhPT0gYXNzZXQuaWQpIHJldHVybjtcblxuICAgICAgICBhc3NldC5vbignYWRkOmxvY2FsaXplZCcsIHRoaXMuX29uTG9jYWxlQWRkLCB0aGlzKTtcbiAgICAgICAgYXNzZXQub24oJ3JlbW92ZTpsb2NhbGl6ZWQnLCB0aGlzLl9vbkxvY2FsZVJlbW92ZSwgdGhpcyk7XG4gICAgICAgIGFzc2V0Lm9uY2UoJ3JlbW92ZScsIHRoaXMuX29uRGVmYXVsdEFzc2V0UmVtb3ZlLCB0aGlzKTtcbiAgICB9XG5cbiAgICBfb25EZWZhdWx0QXNzZXRSZW1vdmUoYXNzZXQpIHtcbiAgICAgICAgaWYgKHRoaXMuX2RlZmF1bHRBc3NldCAhPT0gYXNzZXQuaWQpIHJldHVybjtcbiAgICAgICAgYXNzZXQub2ZmKCdhZGQ6bG9jYWxpemVkJywgdGhpcy5fb25Mb2NhbGVBZGQsIHRoaXMpO1xuICAgICAgICBhc3NldC5vZmYoJ3JlbW92ZTpsb2NhbGl6ZWQnLCB0aGlzLl9vbkxvY2FsZUFkZCwgdGhpcyk7XG4gICAgICAgIHRoaXMuX2FwcC5hc3NldHMub25jZSgnYWRkOicgKyB0aGlzLl9kZWZhdWx0QXNzZXQsIHRoaXMuX29uRGVmYXVsdEFzc2V0QWRkLCB0aGlzKTtcbiAgICB9XG5cbiAgICBfYmluZExvY2FsaXplZEFzc2V0KCkge1xuICAgICAgICBpZiAoIXRoaXMuX2F1dG9Mb2FkKSByZXR1cm47XG5cbiAgICAgICAgY29uc3QgYXNzZXQgPSB0aGlzLl9hcHAuYXNzZXRzLmdldCh0aGlzLl9sb2NhbGl6ZWRBc3NldCk7XG4gICAgICAgIGlmICghYXNzZXQpIHJldHVybjtcblxuICAgICAgICBhc3NldC5vbignbG9hZCcsIHRoaXMuX29uTG9jYWxpemVkQXNzZXRMb2FkLCB0aGlzKTtcbiAgICAgICAgYXNzZXQub24oJ2NoYW5nZScsIHRoaXMuX29uTG9jYWxpemVkQXNzZXRDaGFuZ2UsIHRoaXMpO1xuICAgICAgICBhc3NldC5vbigncmVtb3ZlJywgdGhpcy5fb25Mb2NhbGl6ZWRBc3NldFJlbW92ZSwgdGhpcyk7XG5cbiAgICAgICAgaWYgKGFzc2V0LnJlc291cmNlKSB7XG4gICAgICAgICAgICB0aGlzLl9vbkxvY2FsaXplZEFzc2V0TG9hZChhc3NldCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9hcHAuYXNzZXRzLmxvYWQoYXNzZXQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgX3VuYmluZExvY2FsaXplZEFzc2V0KCkge1xuICAgICAgICBjb25zdCBhc3NldCA9IHRoaXMuX2FwcC5hc3NldHMuZ2V0KHRoaXMuX2xvY2FsaXplZEFzc2V0KTtcbiAgICAgICAgaWYgKCFhc3NldCkgcmV0dXJuO1xuXG4gICAgICAgIGFzc2V0Lm9mZignbG9hZCcsIHRoaXMuX29uTG9jYWxpemVkQXNzZXRMb2FkLCB0aGlzKTtcbiAgICAgICAgYXNzZXQub2ZmKCdjaGFuZ2UnLCB0aGlzLl9vbkxvY2FsaXplZEFzc2V0Q2hhbmdlLCB0aGlzKTtcbiAgICAgICAgYXNzZXQub2ZmKCdyZW1vdmUnLCB0aGlzLl9vbkxvY2FsaXplZEFzc2V0UmVtb3ZlLCB0aGlzKTtcbiAgICB9XG5cbiAgICBfb25Mb2NhbGl6ZWRBc3NldEFkZChhc3NldCkge1xuICAgICAgICBpZiAodGhpcy5fbG9jYWxpemVkQXNzZXQgIT09IGFzc2V0LmlkKSByZXR1cm47XG5cbiAgICAgICAgdGhpcy5fYmluZExvY2FsaXplZEFzc2V0KCk7XG4gICAgfVxuXG4gICAgX29uTG9jYWxpemVkQXNzZXRMb2FkKGFzc2V0KSB7XG4gICAgICAgIHRoaXMuZmlyZSgnbG9hZCcsIGFzc2V0KTtcbiAgICB9XG5cbiAgICBfb25Mb2NhbGl6ZWRBc3NldENoYW5nZShhc3NldCwgbmFtZSwgbmV3VmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgICAgIHRoaXMuZmlyZSgnY2hhbmdlJywgYXNzZXQsIG5hbWUsIG5ld1ZhbHVlLCBvbGRWYWx1ZSk7XG4gICAgfVxuXG4gICAgX29uTG9jYWxpemVkQXNzZXRSZW1vdmUoYXNzZXQpIHtcbiAgICAgICAgaWYgKHRoaXMuX2xvY2FsaXplZEFzc2V0ID09PSBhc3NldC5pZCkge1xuICAgICAgICAgICAgdGhpcy5sb2NhbGl6ZWRBc3NldCA9IHRoaXMuX2RlZmF1bHRBc3NldDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmZpcmUoJ3JlbW92ZScsIGFzc2V0KTtcbiAgICB9XG5cbiAgICBfb25Mb2NhbGVBZGQobG9jYWxlLCBhc3NldElkKSB7XG4gICAgICAgIGlmICh0aGlzLl9hcHAuaTE4bi5sb2NhbGUgIT09IGxvY2FsZSkgcmV0dXJuO1xuXG4gICAgICAgIC8vIHJlc2V0IGxvY2FsaXplZCBhc3NldFxuICAgICAgICB0aGlzLl9vblNldExvY2FsZShsb2NhbGUpO1xuICAgIH1cblxuICAgIF9vbkxvY2FsZVJlbW92ZShsb2NhbGUsIGFzc2V0SWQpIHtcbiAgICAgICAgaWYgKHRoaXMuX2FwcC5pMThuLmxvY2FsZSAhPT0gbG9jYWxlKSByZXR1cm47XG5cbiAgICAgICAgLy8gcmVzZXQgbG9jYWxpemVkIGFzc2V0XG4gICAgICAgIHRoaXMuX29uU2V0TG9jYWxlKGxvY2FsZSk7XG4gICAgfVxuXG4gICAgX29uU2V0TG9jYWxlKGxvY2FsZSkge1xuICAgICAgICBpZiAoIXRoaXMuX2RlZmF1bHRBc3NldCkge1xuICAgICAgICAgICAgdGhpcy5sb2NhbGl6ZWRBc3NldCA9IG51bGw7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBhc3NldCA9IHRoaXMuX2FwcC5hc3NldHMuZ2V0KHRoaXMuX2RlZmF1bHRBc3NldCk7XG4gICAgICAgIGlmICghYXNzZXQgfHwgdGhpcy5fZGlzYWJsZUxvY2FsaXphdGlvbikge1xuICAgICAgICAgICAgdGhpcy5sb2NhbGl6ZWRBc3NldCA9IHRoaXMuX2RlZmF1bHRBc3NldDtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGxvY2FsaXplZEFzc2V0SWQgPSBhc3NldC5nZXRMb2NhbGl6ZWRBc3NldElkKGxvY2FsZSk7XG4gICAgICAgIGlmICghbG9jYWxpemVkQXNzZXRJZCkge1xuICAgICAgICAgICAgdGhpcy5sb2NhbGl6ZWRBc3NldCA9IHRoaXMuX2RlZmF1bHRBc3NldDtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMubG9jYWxpemVkQXNzZXQgPSBsb2NhbGl6ZWRBc3NldElkO1xuICAgIH1cblxuICAgIGRlc3Ryb3koKSB7XG4gICAgICAgIHRoaXMuZGVmYXVsdEFzc2V0ID0gbnVsbDtcbiAgICAgICAgdGhpcy5fYXBwLmkxOG4ub2ZmKCdzZXQ6bG9jYWxlJywgdGhpcy5fb25TZXRMb2NhbGUsIHRoaXMpO1xuICAgICAgICB0aGlzLm9mZigpO1xuICAgIH1cbn1cblxuZXhwb3J0IHsgTG9jYWxpemVkQXNzZXQgfTtcbiJdLCJuYW1lcyI6WyJMb2NhbGl6ZWRBc3NldCIsIkV2ZW50SGFuZGxlciIsImNvbnN0cnVjdG9yIiwiYXBwIiwiX2FwcCIsImkxOG4iLCJvbiIsIl9vblNldExvY2FsZSIsIl9hdXRvTG9hZCIsIl9kaXNhYmxlTG9jYWxpemF0aW9uIiwiX2RlZmF1bHRBc3NldCIsIl9sb2NhbGl6ZWRBc3NldCIsImRlZmF1bHRBc3NldCIsInZhbHVlIiwiaWQiLCJBc3NldCIsIl91bmJpbmREZWZhdWx0QXNzZXQiLCJfYmluZERlZmF1bHRBc3NldCIsImxvY2FsZSIsImxvY2FsaXplZEFzc2V0IiwiYXNzZXRzIiwib2ZmIiwiX29uTG9jYWxpemVkQXNzZXRBZGQiLCJfdW5iaW5kTG9jYWxpemVkQXNzZXQiLCJhc3NldCIsImdldCIsIm9uY2UiLCJfYmluZExvY2FsaXplZEFzc2V0IiwiYXV0b0xvYWQiLCJkaXNhYmxlTG9jYWxpemF0aW9uIiwiX29uRGVmYXVsdEFzc2V0QWRkIiwiX29uTG9jYWxlQWRkIiwiX29uTG9jYWxlUmVtb3ZlIiwiX29uRGVmYXVsdEFzc2V0UmVtb3ZlIiwiX29uTG9jYWxpemVkQXNzZXRMb2FkIiwiX29uTG9jYWxpemVkQXNzZXRDaGFuZ2UiLCJfb25Mb2NhbGl6ZWRBc3NldFJlbW92ZSIsInJlc291cmNlIiwibG9hZCIsImZpcmUiLCJuYW1lIiwibmV3VmFsdWUiLCJvbGRWYWx1ZSIsImFzc2V0SWQiLCJsb2NhbGl6ZWRBc3NldElkIiwiZ2V0TG9jYWxpemVkQXNzZXRJZCIsImRlc3Ryb3kiXSwibWFwcGluZ3MiOiI7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
