/**
 * @license
 * PlayCanvas Engine v1.58.0 revision 6672f604c (DEBUG PROFILER)
 * Copyright 2011-2022 PlayCanvas Ltd. All rights reserved.
 */
import { Debug } from './debug.js';

const TRACEID = 'Preprocessor';

const KEYWORD = /[ \t]*#(ifn?def|if|endif|else|elif|define|undef|extension)/g;

const DEFINE = /define[ \t]+([^\n]+)\r?(?:\n|$)/g;

const EXTENSION = /extension[ \t]+([\w-]+)[ \t]*:[ \t]*enable/g;

const UNDEF = /undef[ \t]+([^\n]+)\r?(?:\n|$)/g;

const IF = /(ifdef|ifndef|if)[ \t]*([^\r\n]+)\r?\n/g;

const ENDIF = /(endif|else|elif)([ \t]+[^\r\n]+)?\r?(?:\n|$)/g;

const IDENTIFIER = /([\w-]+)/;

const DEFINED = /(!|\s)?defined\(([\w-]+)\)/;

const INVALID = /[><=|&+-]/g;

class Preprocessor {
  static run(source) {
    source = source.replace(/\/\*[\s\S]*?\*\/|([^\\:]|^)\/\/.*$/gm, '$1');

    source = source.split(/\r?\n/).map(line => line.trimEnd()).join('\n');

    source = this._preprocess(source);
    if (source !== null) {
      source = source.split(/\r?\n/).map(line => line.trim() === '' ? '' : line).join('\n');

      source = source.replace(/(\n\n){3,}/gm, '\n\n');
    }
    return source;
  }
  static _preprocess(source) {
    const originalSource = source;

    const stack = [];

    let error = false;

    const defines = new Map();
    let match;
    while ((match = KEYWORD.exec(source)) !== null) {
      const keyword = match[1];
      switch (keyword) {
        case 'define':
          {
            DEFINE.lastIndex = match.index;
            const define = DEFINE.exec(source);
            Debug.assert(define, `Invalid [${keyword}]: ${source.substring(match.index, match.index + 100)}...`);
            error || (error = define === null);
            const expression = define[1];

            IDENTIFIER.lastIndex = define.index;
            const identifierValue = IDENTIFIER.exec(expression);
            const identifier = identifierValue[1];
            let value = expression.substring(identifier.length).trim();
            if (value === "") value = "true";

            const keep = Preprocessor._keep(stack);
            if (keep) {
              defines.set(identifier, value);
            }
            Debug.trace(TRACEID, `${keyword}: [${identifier}] ${value} ${keep ? "" : "IGNORED"}`);

            KEYWORD.lastIndex = define.index + define[0].length;
            break;
          }
        case 'undef':
          {
            UNDEF.lastIndex = match.index;
            const undef = UNDEF.exec(source);
            const identifier = undef[1].trim();

            const keep = Preprocessor._keep(stack);

            if (keep) {
              defines.delete(identifier);
            }
            Debug.trace(TRACEID, `${keyword}: [${identifier}] ${keep ? "" : "IGNORED"}`);

            KEYWORD.lastIndex = undef.index + undef[0].length;
            break;
          }
        case 'extension':
          {
            EXTENSION.lastIndex = match.index;
            const extension = EXTENSION.exec(source);
            Debug.assert(extension, `Invalid [${keyword}]: ${source.substring(match.index, match.index + 100)}...`);
            error || (error = extension === null);
            if (extension) {
              const identifier = extension[1];

              const keep = Preprocessor._keep(stack);
              if (keep) {
                defines.set(identifier, "true");
              }
              Debug.trace(TRACEID, `${keyword}: [${identifier}] ${keep ? "" : "IGNORED"}`);
            }

            KEYWORD.lastIndex = extension.index + extension[0].length;
            break;
          }
        case 'ifdef':
        case 'ifndef':
        case 'if':
          {
            IF.lastIndex = match.index;
            const iff = IF.exec(source);
            const expression = iff[2];

            const evaluated = Preprocessor.evaluate(expression, defines);
            error || (error = evaluated.error);
            let result = evaluated.result;
            if (keyword === 'ifndef') {
              result = !result;
            }

            stack.push({
              anyKeep: result,
              keep: result,
              start: match.index,
              end: IF.lastIndex
            });

            Debug.trace(TRACEID, `${keyword}: [${expression}] => ${result}`);

            KEYWORD.lastIndex = iff.index + iff[0].length;
            break;
          }
        case 'endif':
        case 'else':
        case 'elif':
          {
            ENDIF.lastIndex = match.index;
            const endif = ENDIF.exec(source);
            const blockInfo = stack.pop();

            const blockCode = blockInfo.keep ? source.substring(blockInfo.end, match.index) : "";
            Debug.trace(TRACEID, `${keyword}: [previous block] => ${blockCode !== ""}`);

            source = source.substring(0, blockInfo.start) + blockCode + source.substring(ENDIF.lastIndex);
            KEYWORD.lastIndex = blockInfo.start + blockCode.length;

            const endifCommand = endif[1];
            if (endifCommand === 'else' || endifCommand === 'elif') {
              let result = false;
              if (!blockInfo.anyKeep) {
                if (endifCommand === 'else') {
                  result = !blockInfo.keep;
                } else {
                  const evaluated = Preprocessor.evaluate(endif[2], defines);
                  result = evaluated.result;
                  error || (error = evaluated.error);
                }
              }

              stack.push({
                anyKeep: blockInfo.anyKeep || result,
                keep: result,
                start: KEYWORD.lastIndex,
                end: KEYWORD.lastIndex
              });
              Debug.trace(TRACEID, `${keyword}: [${endif[2]}] => ${result}`);
            }
            break;
          }
      }
    }
    if (error) {
      console.warn("Failed to preprocess shader: ", {
        source: originalSource
      });
      return originalSource;
    }
    return source;
  }

  static _keep(stack) {
    for (let i = 0; i < stack.length; i++) {
      if (!stack[i].keep) return false;
    }
    return true;
  }

  static evaluate(expression, defines) {
    const correct = INVALID.exec(expression) === null;
    Debug.assert(correct, `Resolving expression like this is not supported: ${expression}`);

    let invert = false;
    const defined = DEFINED.exec(expression);
    if (defined) {
      invert = defined[1] === '!';
      expression = defined[2];
    }

    expression = expression.trim();
    let exists = defines.has(expression);

    if (invert) {
      exists = !exists;
    }
    return {
      result: exists,
      error: !correct
    };
  }
}

export { Preprocessor };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJlcHJvY2Vzc29yLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvY29yZS9wcmVwcm9jZXNzb3IuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGVidWcgfSBmcm9tICcuL2RlYnVnLmpzJztcblxuLy8gaWQgZm9yIGRlYnVnIHRyYWNpbmdcbmNvbnN0IFRSQUNFSUQgPSAnUHJlcHJvY2Vzc29yJztcblxuLy8gYWNjZXB0ZWQga2V5d29yZHNcbmNvbnN0IEtFWVdPUkQgPSAvWyBcXHRdKiMoaWZuP2RlZnxpZnxlbmRpZnxlbHNlfGVsaWZ8ZGVmaW5lfHVuZGVmfGV4dGVuc2lvbikvZztcblxuLy8gI2RlZmluZSBFWFBSRVNTSU9OXG5jb25zdCBERUZJTkUgPSAvZGVmaW5lWyBcXHRdKyhbXlxcbl0rKVxccj8oPzpcXG58JCkvZztcblxuLy8gI2V4dGVuc2lvbiBJREVOVElGSUVSIDogZW5hYmxlZFxuY29uc3QgRVhURU5TSU9OID0gL2V4dGVuc2lvblsgXFx0XSsoW1xcdy1dKylbIFxcdF0qOlsgXFx0XSplbmFibGUvZztcblxuLy8gI3VuZGVmIEVYUFJFU1NJT05cbmNvbnN0IFVOREVGID0gL3VuZGVmWyBcXHRdKyhbXlxcbl0rKVxccj8oPzpcXG58JCkvZztcblxuLy8gI2lmZGVmLyNpZm5kZWYgU09NRURFRklORSwgI2lmIEVYUFJFU1NJT05cbmNvbnN0IElGID0gLyhpZmRlZnxpZm5kZWZ8aWYpWyBcXHRdKihbXlxcclxcbl0rKVxccj9cXG4vZztcblxuLy8gI2VuZGlmLyNlbHNlIG9yICNlbGlmIEVYUFJFU1NJT05cbmNvbnN0IEVORElGID0gLyhlbmRpZnxlbHNlfGVsaWYpKFsgXFx0XStbXlxcclxcbl0rKT9cXHI/KD86XFxufCQpL2c7XG5cbi8vIGlkZW50aWZpZXJcbmNvbnN0IElERU5USUZJRVIgPSAvKFtcXHctXSspLztcblxuLy8gWyFdZGVmaW5lZChFWFBSRVNTSU9OKVxuY29uc3QgREVGSU5FRCA9IC8oIXxcXHMpP2RlZmluZWRcXCgoW1xcdy1dKylcXCkvO1xuXG4vLyBjdXJyZW50bHkgdW5zdXBwb3J0ZWQgY2hhcmFjdGVycyBpbiB0aGUgZXhwcmVzc2lvbjogfCAmIDwgPiA9ICsgLVxuY29uc3QgSU5WQUxJRCA9IC9bPjw9fCYrLV0vZztcblxuLyoqXG4gKiBQdXJlIHN0YXRpYyBjbGFzcyBpbXBsZW1lbnRpbmcgc3Vic2V0IG9mIEMtc3R5bGUgcHJlcHJvY2Vzc29yLlxuICogaW5zcGlyZWQgYnk6IGh0dHBzOi8vZ2l0aHViLmNvbS9kY29kZUlPL1ByZXByb2Nlc3Nvci5qc1xuICpcbiAqIEBpZ25vcmVcbiAqL1xuY2xhc3MgUHJlcHJvY2Vzc29yIHtcbiAgICAvKipcbiAgICAgKiBSdW4gYy1saWtlIHByZXByb2Nlc3NvciBvbiB0aGUgc291cmNlIGNvZGUsIGFuZCByZXNvbHZlcyB0aGUgY29kZSBiYXNlZCBvbiB0aGUgZGVmaW5lcyBhbmQgaWZkZWZzXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gc291cmNlIC0gVGhlIHNvdXJjZSBjb2RlIHRvIHdvcmsgb24uXG4gICAgICogQHJldHVybnMge3N0cmluZ3xudWxsfSBSZXR1cm5zIHByZXByb2Nlc3NlZCBzb3VyY2UgY29kZSwgb3IgbnVsbCBpbiBjYXNlIG9mIGVycm9yLlxuICAgICAqL1xuICAgIHN0YXRpYyBydW4oc291cmNlKSB7XG5cbiAgICAgICAgLy8gc3RyaXBzIGNvbW1lbnRzLCBoYW5kbGVzIC8vIGFuZCBtYW55IGNhc2VzIG9mIC8qXG4gICAgICAgIHNvdXJjZSA9IHNvdXJjZS5yZXBsYWNlKC9cXC9cXCpbXFxzXFxTXSo/XFwqXFwvfChbXlxcXFw6XXxeKVxcL1xcLy4qJC9nbSwgJyQxJyk7XG5cbiAgICAgICAgLy8gcmlnaHQgdHJpbSBlYWNoIGxpbmVcbiAgICAgICAgc291cmNlID0gc291cmNlLnNwbGl0KC9cXHI/XFxuLylcbiAgICAgICAgICAgIC5tYXAobGluZSA9PiBsaW5lLnRyaW1FbmQoKSlcbiAgICAgICAgICAgIC5qb2luKCdcXG4nKTtcblxuICAgICAgICAvLyBwcmVwcm9jZXNzIGRlZmluZXMgLyBpZmRlZnMgLi5cbiAgICAgICAgc291cmNlID0gdGhpcy5fcHJlcHJvY2Vzcyhzb3VyY2UpO1xuXG4gICAgICAgIGlmIChzb3VyY2UgIT09IG51bGwpIHtcbiAgICAgICAgICAgIC8vIGNvbnZlcnQgbGluZXMgd2l0aCBvbmx5IHdoaXRlIHNwYWNlIGludG8gZW1wdHkgc3RyaW5nXG4gICAgICAgICAgICBzb3VyY2UgPSBzb3VyY2Uuc3BsaXQoL1xccj9cXG4vKVxuICAgICAgICAgICAgICAgIC5tYXAobGluZSA9PiAobGluZS50cmltKCkgPT09ICcnID8gJycgOiBsaW5lKSlcbiAgICAgICAgICAgICAgICAuam9pbignXFxuJyk7XG5cbiAgICAgICAgICAgIC8vIHJlbW92ZSBtb3JlIHRoYW4gMSBjb25zZWN1dGl2ZSBlbXB0eSBsaW5lc1xuICAgICAgICAgICAgc291cmNlID0gc291cmNlLnJlcGxhY2UoLyhcXG5cXG4pezMsfS9nbSwgJ1xcblxcbicpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHNvdXJjZTtcbiAgICB9XG5cbiAgICBzdGF0aWMgX3ByZXByb2Nlc3Moc291cmNlKSB7XG5cbiAgICAgICAgY29uc3Qgb3JpZ2luYWxTb3VyY2UgPSBzb3VyY2U7XG5cbiAgICAgICAgLy8gc3RhY2ssIHN0b3JpbmcgaW5mbyBhYm91dCBpZmRlZiBibG9ja3NcbiAgICAgICAgY29uc3Qgc3RhY2sgPSBbXTtcblxuICAgICAgICAvLyB0cnVlIGlmIHRoZSBmdW5jdGlvbiBlbmNvdW50ZXIgYSBwcm9ibGVtXG4gICAgICAgIGxldCBlcnJvciA9IGZhbHNlO1xuXG4gICAgICAgIC8vIGFjdGl2ZSBkZWZpbmVzLCBtYXBzIGRlZmluZSBuYW1lIHRvIGl0cyB2YWx1ZVxuICAgICAgICAvKiogQHR5cGUge01hcDxzdHJpbmcsIHN0cmluZz59ICovXG4gICAgICAgIGNvbnN0IGRlZmluZXMgPSBuZXcgTWFwKCk7XG5cbiAgICAgICAgbGV0IG1hdGNoO1xuICAgICAgICB3aGlsZSAoKG1hdGNoID0gS0VZV09SRC5leGVjKHNvdXJjZSkpICE9PSBudWxsKSB7XG5cbiAgICAgICAgICAgIGNvbnN0IGtleXdvcmQgPSBtYXRjaFsxXTtcbiAgICAgICAgICAgIHN3aXRjaCAoa2V5d29yZCkge1xuICAgICAgICAgICAgICAgIGNhc2UgJ2RlZmluZSc6IHtcblxuICAgICAgICAgICAgICAgICAgICAvLyByZWFkIHRoZSByZXN0IG9mIHRoZSBkZWZpbmUgbGluZVxuICAgICAgICAgICAgICAgICAgICBERUZJTkUubGFzdEluZGV4ID0gbWF0Y2guaW5kZXg7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGRlZmluZSA9IERFRklORS5leGVjKHNvdXJjZSk7XG4gICAgICAgICAgICAgICAgICAgIERlYnVnLmFzc2VydChkZWZpbmUsIGBJbnZhbGlkIFske2tleXdvcmR9XTogJHtzb3VyY2Uuc3Vic3RyaW5nKG1hdGNoLmluZGV4LCBtYXRjaC5pbmRleCArIDEwMCl9Li4uYCk7XG4gICAgICAgICAgICAgICAgICAgIGVycm9yIHx8PSBkZWZpbmUgPT09IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGV4cHJlc3Npb24gPSBkZWZpbmVbMV07XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gc3BsaXQgaXQgdG8gaWRlbnRpZmllciBuYW1lIGFuZCBhIHZhbHVlXG4gICAgICAgICAgICAgICAgICAgIElERU5USUZJRVIubGFzdEluZGV4ID0gZGVmaW5lLmluZGV4O1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBpZGVudGlmaWVyVmFsdWUgPSBJREVOVElGSUVSLmV4ZWMoZXhwcmVzc2lvbik7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGlkZW50aWZpZXIgPSBpZGVudGlmaWVyVmFsdWVbMV07XG4gICAgICAgICAgICAgICAgICAgIGxldCB2YWx1ZSA9IGV4cHJlc3Npb24uc3Vic3RyaW5nKGlkZW50aWZpZXIubGVuZ3RoKS50cmltKCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gXCJcIikgdmFsdWUgPSBcInRydWVcIjtcblxuICAgICAgICAgICAgICAgICAgICAvLyBhcmUgd2UgaW5zaWRlIGlmLWJsb2NrcyB0aGF0IGFyZSBhY2NlcHRlZFxuICAgICAgICAgICAgICAgICAgICBjb25zdCBrZWVwID0gUHJlcHJvY2Vzc29yLl9rZWVwKHN0YWNrKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoa2VlcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVmaW5lcy5zZXQoaWRlbnRpZmllciwgdmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgRGVidWcudHJhY2UoVFJBQ0VJRCwgYCR7a2V5d29yZH06IFske2lkZW50aWZpZXJ9XSAke3ZhbHVlfSAke2tlZXAgPyBcIlwiIDogXCJJR05PUkVEXCJ9YCk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gY29udGludWUgb24gdGhlIG5leHQgbGluZVxuICAgICAgICAgICAgICAgICAgICBLRVlXT1JELmxhc3RJbmRleCA9IGRlZmluZS5pbmRleCArIGRlZmluZVswXS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNhc2UgJ3VuZGVmJzoge1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIHJlYWQgdGhlIHJlc3Qgb2YgdGhlIGRlZmluZSBsaW5lXG4gICAgICAgICAgICAgICAgICAgIFVOREVGLmxhc3RJbmRleCA9IG1hdGNoLmluZGV4O1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB1bmRlZiA9IFVOREVGLmV4ZWMoc291cmNlKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaWRlbnRpZmllciA9IHVuZGVmWzFdLnRyaW0oKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBhcmUgd2UgaW5zaWRlIGlmLWJsb2NrcyB0aGF0IGFyZSBhY2NlcHRlZFxuICAgICAgICAgICAgICAgICAgICBjb25zdCBrZWVwID0gUHJlcHJvY2Vzc29yLl9rZWVwKHN0YWNrKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyByZW1vdmUgaXQgZnJvbSBkZWZpbmVzXG4gICAgICAgICAgICAgICAgICAgIGlmIChrZWVwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZpbmVzLmRlbGV0ZShpZGVudGlmaWVyKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIERlYnVnLnRyYWNlKFRSQUNFSUQsIGAke2tleXdvcmR9OiBbJHtpZGVudGlmaWVyfV0gJHtrZWVwID8gXCJcIiA6IFwiSUdOT1JFRFwifWApO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbnRpbnVlIG9uIHRoZSBuZXh0IGxpbmVcbiAgICAgICAgICAgICAgICAgICAgS0VZV09SRC5sYXN0SW5kZXggPSB1bmRlZi5pbmRleCArIHVuZGVmWzBdLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY2FzZSAnZXh0ZW5zaW9uJzoge1xuICAgICAgICAgICAgICAgICAgICBFWFRFTlNJT04ubGFzdEluZGV4ID0gbWF0Y2guaW5kZXg7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGV4dGVuc2lvbiA9IEVYVEVOU0lPTi5leGVjKHNvdXJjZSk7XG4gICAgICAgICAgICAgICAgICAgIERlYnVnLmFzc2VydChleHRlbnNpb24sIGBJbnZhbGlkIFske2tleXdvcmR9XTogJHtzb3VyY2Uuc3Vic3RyaW5nKG1hdGNoLmluZGV4LCBtYXRjaC5pbmRleCArIDEwMCl9Li4uYCk7XG4gICAgICAgICAgICAgICAgICAgIGVycm9yIHx8PSBleHRlbnNpb24gPT09IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIGlmIChleHRlbnNpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlkZW50aWZpZXIgPSBleHRlbnNpb25bMV07XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFyZSB3ZSBpbnNpZGUgaWYtYmxvY2tzIHRoYXQgYXJlIGFjY2VwdGVkXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBrZWVwID0gUHJlcHJvY2Vzc29yLl9rZWVwKHN0YWNrKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtlZXApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZpbmVzLnNldChpZGVudGlmaWVyLCBcInRydWVcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIERlYnVnLnRyYWNlKFRSQUNFSUQsIGAke2tleXdvcmR9OiBbJHtpZGVudGlmaWVyfV0gJHtrZWVwID8gXCJcIiA6IFwiSUdOT1JFRFwifWApO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gY29udGludWUgb24gdGhlIG5leHQgbGluZVxuICAgICAgICAgICAgICAgICAgICBLRVlXT1JELmxhc3RJbmRleCA9IGV4dGVuc2lvbi5pbmRleCArIGV4dGVuc2lvblswXS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNhc2UgJ2lmZGVmJzpcbiAgICAgICAgICAgICAgICBjYXNlICdpZm5kZWYnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2lmJzoge1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIHJlYWQgdGhlIGlmIGxpbmVcbiAgICAgICAgICAgICAgICAgICAgSUYubGFzdEluZGV4ID0gbWF0Y2guaW5kZXg7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGlmZiA9IElGLmV4ZWMoc291cmNlKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZXhwcmVzc2lvbiA9IGlmZlsyXTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBldmFsdWF0ZSBleHByZXNzaW9uXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGV2YWx1YXRlZCA9IFByZXByb2Nlc3Nvci5ldmFsdWF0ZShleHByZXNzaW9uLCBkZWZpbmVzKTtcbiAgICAgICAgICAgICAgICAgICAgZXJyb3IgfHw9IGV2YWx1YXRlZC5lcnJvcjtcbiAgICAgICAgICAgICAgICAgICAgbGV0IHJlc3VsdCA9IGV2YWx1YXRlZC5yZXN1bHQ7XG4gICAgICAgICAgICAgICAgICAgIGlmIChrZXl3b3JkID09PSAnaWZuZGVmJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gIXJlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIGFkZCBpbmZvIHRvIHRoZSBzdGFjayAodG8gYmUgaGFuZGxlZCBsYXRlcilcbiAgICAgICAgICAgICAgICAgICAgc3RhY2sucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBhbnlLZWVwOiByZXN1bHQsICAgICAgICAvLyB0cnVlIGlmIGFueSBicmFuY2ggd2FzIGFscmVhZHkgYWNjZXB0ZWRcbiAgICAgICAgICAgICAgICAgICAgICAgIGtlZXA6IHJlc3VsdCwgICAgICAgICAgIC8vIHRydWUgaWYgdGhpcyBicmFuY2ggaXMgYmVpbmcgdGFrZW5cbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBtYXRjaC5pbmRleCwgICAgIC8vIHN0YXJ0IGluZGV4IGlmIElGIGxpbmVcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuZDogSUYubGFzdEluZGV4ICAgICAgIC8vIGVuZCBpbmRleCBvZiBJRiBsaW5lXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIERlYnVnLnRyYWNlKFRSQUNFSUQsIGAke2tleXdvcmR9OiBbJHtleHByZXNzaW9ufV0gPT4gJHtyZXN1bHR9YCk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gY29udGludWUgb24gdGhlIG5leHQgbGluZVxuICAgICAgICAgICAgICAgICAgICBLRVlXT1JELmxhc3RJbmRleCA9IGlmZi5pbmRleCArIGlmZlswXS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNhc2UgJ2VuZGlmJzpcbiAgICAgICAgICAgICAgICBjYXNlICdlbHNlJzpcbiAgICAgICAgICAgICAgICBjYXNlICdlbGlmJzoge1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIG1hdGNoIHRoZSBlbmRpZlxuICAgICAgICAgICAgICAgICAgICBFTkRJRi5sYXN0SW5kZXggPSBtYXRjaC5pbmRleDtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZW5kaWYgPSBFTkRJRi5leGVjKHNvdXJjZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYmxvY2tJbmZvID0gc3RhY2sucG9wKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gY29kZSBiZXR3ZWVuIGlmIGFuZCBlbmRpZlxuICAgICAgICAgICAgICAgICAgICBjb25zdCBibG9ja0NvZGUgPSBibG9ja0luZm8ua2VlcCA/IHNvdXJjZS5zdWJzdHJpbmcoYmxvY2tJbmZvLmVuZCwgbWF0Y2guaW5kZXgpIDogXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgRGVidWcudHJhY2UoVFJBQ0VJRCwgYCR7a2V5d29yZH06IFtwcmV2aW91cyBibG9ja10gPT4gJHtibG9ja0NvZGUgIT09IFwiXCJ9YCk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gY3V0IG91dCB0aGUgSUYgYW5kIEVORElGIGxpbmVzLCBsZWF2ZSBibG9jayBpZiByZXF1aXJlZFxuICAgICAgICAgICAgICAgICAgICBzb3VyY2UgPSBzb3VyY2Uuc3Vic3RyaW5nKDAsIGJsb2NrSW5mby5zdGFydCkgKyBibG9ja0NvZGUgKyBzb3VyY2Uuc3Vic3RyaW5nKEVORElGLmxhc3RJbmRleCk7XG4gICAgICAgICAgICAgICAgICAgIEtFWVdPUkQubGFzdEluZGV4ID0gYmxvY2tJbmZvLnN0YXJ0ICsgYmxvY2tDb2RlLmxlbmd0aDtcblxuICAgICAgICAgICAgICAgICAgICAvLyBoYW5kbGUgZWxzZSBpZlxuICAgICAgICAgICAgICAgICAgICBjb25zdCBlbmRpZkNvbW1hbmQgPSBlbmRpZlsxXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVuZGlmQ29tbWFuZCA9PT0gJ2Vsc2UnIHx8IGVuZGlmQ29tbWFuZCA9PT0gJ2VsaWYnKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIGFueSBicmFuY2ggd2FzIGFscmVhZHkgYWNjZXB0ZWQsIGFsbCBlbHNlIGJyYW5jaGVzIG5lZWQgdG8gZmFpbCByZWdhcmRsZXNzIG9mIHRoZSByZXN1bHRcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCByZXN1bHQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghYmxvY2tJbmZvLmFueUtlZXApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZW5kaWZDb21tYW5kID09PSAnZWxzZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gIWJsb2NrSW5mby5rZWVwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGV2YWx1YXRlZCA9IFByZXByb2Nlc3Nvci5ldmFsdWF0ZShlbmRpZlsyXSwgZGVmaW5lcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGV2YWx1YXRlZC5yZXN1bHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yIHx8PSBldmFsdWF0ZWQuZXJyb3I7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBhZGQgYmFjayB0byBzdGFja1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2sucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYW55S2VlcDogYmxvY2tJbmZvLmFueUtlZXAgfHwgcmVzdWx0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtlZXA6IHJlc3VsdCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydDogS0VZV09SRC5sYXN0SW5kZXgsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kOiBLRVlXT1JELmxhc3RJbmRleFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBEZWJ1Zy50cmFjZShUUkFDRUlELCBgJHtrZXl3b3JkfTogWyR7ZW5kaWZbMl19XSA9PiAke3Jlc3VsdH1gKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKFwiRmFpbGVkIHRvIHByZXByb2Nlc3Mgc2hhZGVyOiBcIiwgeyBzb3VyY2U6IG9yaWdpbmFsU291cmNlIH0pO1xuICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsU291cmNlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHNvdXJjZTtcbiAgICB9XG5cbiAgICAvLyBmdW5jdGlvbiByZXR1cm5zIHRydWUgaWYgdGhlIGV2YWx1YXRpb24gaXMgaW5zaWRlIGtlZXAgYnJhbmNoZXNcbiAgICBzdGF0aWMgX2tlZXAoc3RhY2spIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdGFjay5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKCFzdGFja1tpXS5rZWVwKVxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFZlcnkgc2ltcGxlIGV4cHJlc3Npb24gZXZhbHVhdGlvbiwgaGFuZGxlcyBjYXNlczpcbiAgICAgKiBleHByZXNzaW9uXG4gICAgICogZGVmaW5lZChleHByZXNzaW9uKVxuICAgICAqICFkZWZpbmVkKGV4cHJlc3Npb24pXG4gICAgICpcbiAgICAgKiBCdXQgZG9lcyBub3QgaGFuZGxlIG1vcmUgY29tcGxleCBjYXNlcywgd2hpY2ggd291bGQgcmVxdWlyZSBtb3JlIGNvbXBsZXggc3lzdGVtOlxuICAgICAqIGRlZmluZWQoQSkgfHwgZGVmaW5lZChCKVxuICAgICAqL1xuICAgIHN0YXRpYyBldmFsdWF0ZShleHByZXNzaW9uLCBkZWZpbmVzKSB7XG5cbiAgICAgICAgY29uc3QgY29ycmVjdCA9IElOVkFMSUQuZXhlYyhleHByZXNzaW9uKSA9PT0gbnVsbDtcbiAgICAgICAgRGVidWcuYXNzZXJ0KGNvcnJlY3QsIGBSZXNvbHZpbmcgZXhwcmVzc2lvbiBsaWtlIHRoaXMgaXMgbm90IHN1cHBvcnRlZDogJHtleHByZXNzaW9ufWApO1xuXG4gICAgICAgIC8vIGlmIHRoZSBmb3JtYXQgaXMgZGVmaW5lZChleHByZXNzaW9uKSwgZXh0cmFjdCBleHByZXNzaW9uXG4gICAgICAgIGxldCBpbnZlcnQgPSBmYWxzZTtcbiAgICAgICAgY29uc3QgZGVmaW5lZCA9IERFRklORUQuZXhlYyhleHByZXNzaW9uKTtcbiAgICAgICAgaWYgKGRlZmluZWQpIHtcbiAgICAgICAgICAgIGludmVydCA9IGRlZmluZWRbMV0gPT09ICchJztcbiAgICAgICAgICAgIGV4cHJlc3Npb24gPSBkZWZpbmVkWzJdO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gdGVzdCBpZiBleHByZXNzaW9uIGRlZmluZSBleGlzdHNcbiAgICAgICAgZXhwcmVzc2lvbiA9IGV4cHJlc3Npb24udHJpbSgpO1xuICAgICAgICBsZXQgZXhpc3RzID0gZGVmaW5lcy5oYXMoZXhwcmVzc2lvbik7XG5cbiAgICAgICAgLy8gaGFuZGxlIGludmVyc2lvblxuICAgICAgICBpZiAoaW52ZXJ0KSB7XG4gICAgICAgICAgICBleGlzdHMgPSAhZXhpc3RzO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJlc3VsdDogZXhpc3RzLFxuICAgICAgICAgICAgZXJyb3I6ICFjb3JyZWN0XG4gICAgICAgIH07XG4gICAgfVxufVxuXG5leHBvcnQgeyBQcmVwcm9jZXNzb3IgfTtcbiJdLCJuYW1lcyI6WyJUUkFDRUlEIiwiS0VZV09SRCIsIkRFRklORSIsIkVYVEVOU0lPTiIsIlVOREVGIiwiSUYiLCJFTkRJRiIsIklERU5USUZJRVIiLCJERUZJTkVEIiwiSU5WQUxJRCIsIlByZXByb2Nlc3NvciIsInJ1biIsInNvdXJjZSIsInJlcGxhY2UiLCJzcGxpdCIsIm1hcCIsImxpbmUiLCJ0cmltRW5kIiwiam9pbiIsIl9wcmVwcm9jZXNzIiwidHJpbSIsIm9yaWdpbmFsU291cmNlIiwic3RhY2siLCJlcnJvciIsImRlZmluZXMiLCJNYXAiLCJtYXRjaCIsImV4ZWMiLCJrZXl3b3JkIiwibGFzdEluZGV4IiwiaW5kZXgiLCJkZWZpbmUiLCJEZWJ1ZyIsImFzc2VydCIsInN1YnN0cmluZyIsImV4cHJlc3Npb24iLCJpZGVudGlmaWVyVmFsdWUiLCJpZGVudGlmaWVyIiwidmFsdWUiLCJsZW5ndGgiLCJrZWVwIiwiX2tlZXAiLCJzZXQiLCJ0cmFjZSIsInVuZGVmIiwiZGVsZXRlIiwiZXh0ZW5zaW9uIiwiaWZmIiwiZXZhbHVhdGVkIiwiZXZhbHVhdGUiLCJyZXN1bHQiLCJwdXNoIiwiYW55S2VlcCIsInN0YXJ0IiwiZW5kIiwiZW5kaWYiLCJibG9ja0luZm8iLCJwb3AiLCJibG9ja0NvZGUiLCJlbmRpZkNvbW1hbmQiLCJjb25zb2xlIiwi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
