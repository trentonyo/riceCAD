import{math as t}from"./math.js";import{Vec3 as s}from"./vec3.js";class h{constructor(t=0,s=0,h=0,i=1){4===t.length?(this.x=t[0],this.y=t[1],this.z=t[2],this.w=t[3]):(this.x=t,this.y=s,this.z=h,this.w=i)}clone(){return new(0,this.constructor)(this.x,this.y,this.z,this.w)}conjugate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w}getAxisAngle(s){let h=2*Math.acos(this.w);const i=Math.sin(h/2);return 0!==i?(s.x=this.x/i,s.y=this.y/i,s.z=this.z/i,(s.x<0||s.y<0||s.z<0)&&(s.x*=-1,s.y*=-1,s.z*=-1,h*=-1)):(s.x=1,s.y=0,s.z=0),h*t.RAD_TO_DEG}getEulerAngles(h=new s){let i,r,n;const e=this.x,a=this.y,z=this.z,x=this.w,y=2*(x*a-e*z);return y<=-.99999?(i=2*Math.atan2(e,x),r=-Math.PI/2,n=0):y>=.99999?(i=2*Math.atan2(e,x),r=Math.PI/2,n=0):(i=Math.atan2(2*(x*e+a*z),1-2*(e*e+a*a)),r=Math.asin(y),n=Math.atan2(2*(x*z+e*a),1-2*(a*a+z*z))),h.set(i,r,n).mulScalar(t.RAD_TO_DEG)}invert(){return this.conjugate().normalize()}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}mul(t){const s=this.x,h=this.y,i=this.z,r=this.w,n=t.x,e=t.y,a=t.z,z=t.w;return this.x=r*n+s*z+h*a-i*e,this.y=r*e+h*z+i*n-s*a,this.z=r*a+i*z+s*e-h*n,this.w=r*z-s*n-h*e-i*a,this}mul2(t,s){const h=t.x,i=t.y,r=t.z,n=t.w,e=s.x,a=s.y,z=s.z,x=s.w;return this.x=n*e+h*x+i*z-r*a,this.y=n*a+i*x+r*e-h*z,this.z=n*z+r*x+h*a-i*e,this.w=n*x-h*e-i*a-r*z,this}normalize(){let t=this.length();return 0===t?(this.x=this.y=this.z=0,this.w=1):(t=1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t),this}set(t,s,h,i){return this.x=t,this.y=s,this.z=h,this.w=i,this}setFromAxisAngle(s,h){h*=.5*t.DEG_TO_RAD;const i=Math.sin(h),r=Math.cos(h);return this.x=i*s.x,this.y=i*s.y,this.z=i*s.z,this.w=r,this}setFromEulerAngles(h,i,r){if(h instanceof s){const t=h;h=t.x,i=t.y,r=t.z}const n=.5*t.DEG_TO_RAD;h*=n,i*=n,r*=n;const e=Math.sin(h),a=Math.cos(h),z=Math.sin(i),x=Math.cos(i),y=Math.sin(r),o=Math.cos(r);return this.x=e*x*o-a*z*y,this.y=a*z*o+e*x*y,this.z=a*x*y-e*z*o,this.w=a*x*o+e*z*y,this}setFromMat4(t){let s,h,i,r,n,e,a,z,x,y,o,w,c,u;if(s=(t=t.data)[0],h=t[1],i=t[2],r=t[4],n=t[5],e=t[6],a=t[8],z=t[9],x=t[10],w=s*s+h*h+i*i,0===w)return this;if(w=1/Math.sqrt(w),c=r*r+n*n+e*e,0===c)return this;if(c=1/Math.sqrt(c),u=a*a+z*z+x*x,0===u)return this;u=1/Math.sqrt(u),s*=w,h*=w,i*=w,r*=c,n*=c,e*=c,a*=u,z*=u,x*=u;const M=s+n+x;return M>=0?(y=Math.sqrt(M+1),this.w=.5*y,y=.5/y,this.x=(e-z)*y,this.y=(a-i)*y,this.z=(h-r)*y):s>n?s>x?(o=s-(n+x)+1,o=Math.sqrt(o),this.x=.5*o,o=.5/o,this.w=(e-z)*o,this.y=(h+r)*o,this.z=(i+a)*o):(o=x-(s+n)+1,o=Math.sqrt(o),this.z=.5*o,o=.5/o,this.w=(h-r)*o,this.x=(a+i)*o,this.y=(z+e)*o):n>x?(o=n-(x+s)+1,o=Math.sqrt(o),this.y=.5*o,o=.5/o,this.w=(a-i)*o,this.z=(e+z)*o,this.x=(r+h)*o):(o=x-(s+n)+1,o=Math.sqrt(o),this.z=.5*o,o=.5/o,this.w=(h-r)*o,this.x=(a+i)*o,this.y=(z+e)*o),this}slerp(t,s,h){const i=t.x,r=t.y,n=t.z,e=t.w;let a=s.x,z=s.y,x=s.z,y=s.w,o=e*y+i*a+r*z+n*x;if(o<0&&(y=-y,a=-a,z=-z,x=-x,o=-o),Math.abs(o)>=1)return this.w=e,this.x=i,this.y=r,this.z=n,this;const w=Math.acos(o),c=Math.sqrt(1-o*o);if(Math.abs(c)<.001)return this.w=.5*e+.5*y,this.x=.5*i+.5*a,this.y=.5*r+.5*z,this.z=.5*n+.5*x,this;const u=Math.sin((1-h)*w)/c,M=Math.sin(h*w)/c;return this.w=e*u+y*M,this.x=i*u+a*M,this.y=r*u+z*M,this.z=n*u+x*M,this}transformVector(t,h=new s){const i=t.x,r=t.y,n=t.z,e=this.x,a=this.y,z=this.z,x=this.w,y=x*i+a*n-z*r,o=x*r+z*i-e*n,w=x*n+e*r-a*i,c=-e*i-a*r-z*n;return h.x=y*x+c*-e+o*-z-w*-a,h.y=o*x+c*-a+w*-e-y*-z,h.z=w*x+c*-z+y*-a-o*-e,h}toString(){return`[${this.x}, ${this.y}, ${this.z}, ${this.w}]`}}h.IDENTITY=Object.freeze(new h(0,0,0,1)),h.ZERO=Object.freeze(new h(0,0,0,0));export{h as Quat};
