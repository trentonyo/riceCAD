import"../../core/tracing.js";import{UNIFORMTYPE_FLOAT as t,UNIFORMTYPE_VEC2 as o,UNIFORMTYPE_VEC3 as s,UNIFORMTYPE_VEC4 as e,UNIFORMTYPE_INT as r,UNIFORMTYPE_IVEC2 as n,UNIFORMTYPE_IVEC3 as i,UNIFORMTYPE_IVEC4 as a,UNIFORMTYPE_MAT2 as c,UNIFORMTYPE_MAT3 as f}from"./constants.js";const h=[];h[t]=function(t,o,s){t.storageFloat32[s]=o},h[o]=(t,o,s)=>{const e=t.storageFloat32;e[s]=o[0],e[s+1]=o[1]},h[s]=(t,o,s)=>{const e=t.storageFloat32;e[s]=o[0],e[s+1]=o[1],e[s+2]=o[2]},h[e]=(t,o,s)=>{const e=t.storageFloat32;e[s]=o[0],e[s+1]=o[1],e[s+2]=o[2],e[s+3]=o[3]},h[r]=function(t,o,s){t.storageInt32[s]=o},h[n]=function(t,o,s){const e=t.storageInt32;e[s]=o[0],e[s+1]=o[1]},h[i]=function(t,o,s){const e=t.storageInt32;e[s]=o[0],e[s+1]=o[1],e[s+2]=o[2]},h[a]=function(t,o,s){const e=t.storageInt32;e[s]=o[0],e[s+1]=o[1],e[s+2]=o[2],e[s+3]=o[3]},h[c]=(t,o,s)=>{const e=t.storageFloat32;e[s]=o[0],e[s+1]=o[1],e[s+4]=o[2],e[s+5]=o[3],e[s+8]=o[4],e[s+9]=o[5]},h[f]=(t,o,s)=>{const e=t.storageFloat32;e[s]=o[0],e[s+1]=o[1],e[s+2]=o[2],e[s+4]=o[3],e[s+5]=o[4],e[s+6]=o[5],e[s+8]=o[6],e[s+9]=o[7],e[s+10]=o[8]};class l{constructor(t,o){this.device=t,this.format=o,this.impl=t.createUniformBufferImpl(this),this.storage=new ArrayBuffer(o.byteSize),this.storageFloat32=new Float32Array(this.storage),this.storageInt32=new Int32Array(this.storage),t._vram.ub+=this.format.byteSize}destroy(){const t=this.device;this.impl.destroy(t),t._vram.ub-=this.format.byteSize}loseContext(){this.impl.loseContext()}setUniform(t){const o=t.offset,s=t.scopeId.value;if(null!=s){const e=h[t.type];e?e(this,s,o):this.storageFloat32.set(s,o)}}set(t){const o=this.format.map.get(t);o&&this.setUniform(o)}update(){const t=this.format.uniforms;for(let o=0;o<t.length;o++)this.setUniform(t[o]);this.impl.unlock(this)}}export{l as UniformBuffer};
