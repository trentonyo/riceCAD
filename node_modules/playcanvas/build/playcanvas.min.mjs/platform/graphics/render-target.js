import"../../core/tracing.js";import{PIXELFORMAT_DEPTH as e,PIXELFORMAT_DEPTHSTENCIL as t}from"./constants.js";import{GraphicsDevice as i}from"./graphics-device.js";const s={depth:!0,face:0};let h=0;class r{constructor(r){var o,f;this.id=h++;const d=arguments[1],l=arguments[2];if(r instanceof i?(this._colorBuffer=d,r=l):this._colorBuffer=r.colorBuffer,this._colorBuffer&&(this._colorBuffer._isRenderTarget=!0),r=void 0!==r?r:s,this._depthBuffer=r.depthBuffer,this._face=void 0!==r.face?r.face:0,this._depthBuffer){const i=this._depthBuffer._format;i===e?(this._depth=!0,this._stencil=!1):i===t?(this._depth=!0,this._stencil=!0):(this._depth=!1,this._stencil=!1)}else this._depth=void 0===r.depth||r.depth,this._stencil=void 0!==r.stencil&&r.stencil;const n=(null==(o=this._colorBuffer)?void 0:o.device)||(null==(f=this._depthBuffer)?void 0:f.device)||r.graphicsDevice;var c,u;(this._device=n,this._samples=void 0!==r.samples?Math.min(r.samples,this._device.maxSamples):1,this.autoResolve=void 0===r.autoResolve||r.autoResolve,this.name=r.name,this.name)||(this.name=null==(c=this._colorBuffer)?void 0:c.name);this.name||(this.name=null==(u=this._depthBuffer)?void 0:u.name);this.name||(this.name="Untitled"),this.flipY=!!r.flipY,this.impl=n.createRenderTargetImpl(this)}destroy(){const e=this._device;if(e){const t=e.targets.indexOf(this);-1!==t&&e.targets.splice(t,1),e.renderTarget===this&&e.setRenderTarget(null),this.destroyFrameBuffers()}}destroyFrameBuffers(){const e=this._device;e&&this.impl.destroy(e)}destroyTextureBuffers(){this._depthBuffer&&(this._depthBuffer.destroy(),this._depthBuffer=null),this._colorBuffer&&(this._colorBuffer.destroy(),this._colorBuffer=null)}init(){this.impl.init(this._device,this)}get initialized(){return this.impl.initialized}loseContext(){this.impl.loseContext()}resolve(e=!0,t=!!this._depthBuffer){this._device&&this._samples>1&&this.impl.resolve(this._device,this,e,t)}copy(e,t,i){if(!this._device){if(!e._device)return!1;this._device=e._device}return this._device.copyRenderTarget(e,this,t,i)}get samples(){return this._samples}get depth(){return this._depth}get stencil(){return this._stencil}get colorBuffer(){return this._colorBuffer}get depthBuffer(){return this._depthBuffer}get face(){return this._face}get width(){var e,t;return(null==(e=this._colorBuffer)?void 0:e.width)||(null==(t=this._depthBuffer)?void 0:t.width)||this._device.width}get height(){var e,t;return(null==(e=this._colorBuffer)?void 0:e.height)||(null==(t=this._depthBuffer)?void 0:t.height)||this._device.height}}export{r as RenderTarget};
