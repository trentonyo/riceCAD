import"../../core/tracing.js";import{BUFFER_STATIC as t}from"./constants.js";let s=0;class e{constructor(e,i,r,h=t,a){this.device=e,this.format=i,this.numVertices=r,this.usage=h,this.id=s++,this.impl=e.createVertexBufferImpl(this,i),this.instancing=!1,this.numBytes=i.verticesByteSize?i.verticesByteSize:i.size*r,this.adjustVramSizeTracking(e._vram,this.numBytes),a?this.setData(a):this.storage=new ArrayBuffer(this.numBytes),this.device.buffers.push(this)}destroy(){const t=this.device,s=t.buffers.indexOf(this);-1!==s&&t.buffers.splice(s,1),this.impl.initialized&&(this.impl.destroy(t),this.adjustVramSizeTracking(t._vram,-this.storage.byteLength))}adjustVramSizeTracking(t,s){t.vb+=s}loseContext(){this.impl.loseContext()}getFormat(){return this.format}getUsage(){return this.usage}getNumVertices(){return this.numVertices}lock(){return this.storage}unlock(){this.impl.unlock(this)}setData(t){return t.byteLength===this.numBytes&&(this.storage=t,this.unlock(),!0)}}export{e as VertexBuffer};
