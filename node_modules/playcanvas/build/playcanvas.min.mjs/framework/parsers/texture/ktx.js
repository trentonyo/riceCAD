import"../../../core/tracing.js";import{Asset as e}from"../../asset/asset.js";import{Texture as t}from"../../../platform/graphics/texture.js";import{ADDRESS_CLAMP_TO_EDGE as r,ADDRESS_REPEAT as a,PIXELFORMAT_DXT1 as n,PIXELFORMAT_DXT3 as s,PIXELFORMAT_DXT5 as l,PIXELFORMAT_ETC1 as i,PIXELFORMAT_ETC2_RGB as o,PIXELFORMAT_ETC2_RGBA as m,PIXELFORMAT_PVRTC_4BPP_RGB_1 as p,PIXELFORMAT_PVRTC_2BPP_RGB_1 as u,PIXELFORMAT_PVRTC_4BPP_RGBA_1 as f,PIXELFORMAT_PVRTC_2BPP_RGBA_1 as c,PIXELFORMAT_R8_G8_B8 as h,PIXELFORMAT_R8_G8_B8_A8 as d,PIXELFORMAT_SRGB as g,PIXELFORMAT_SRGBA as b,PIXELFORMAT_111110F as y,PIXELFORMAT_RGB16F as x,PIXELFORMAT_RGBA16F as O}from"../../../platform/graphics/constants.js";const v=[1481919403,3140563232,169478669],w={33776:n,33778:s,33779:l,36196:i,37492:o,37496:m,35840:p,35841:u,35842:f,35843:c,32849:h,32856:d,35905:g,35907:b,35898:y,34843:x,34842:O};class A{constructor(e){this.maxRetries=0}load(t,r,a){e.fetchArrayBuffer(t.load,r,a,this.maxRetries)}open(e,n,s){const l=this.parse(n);if(!l)return null;const i=new t(s,{name:e,addressU:l.cubemap?r:a,addressV:l.cubemap?r:a,width:l.width,height:l.height,format:l.format,cubemap:l.cubemap,levels:l.levels});return i.upload(),i}parse(e){const t=new Uint32Array(e);if(v[0]!==t[0]||v[1]!==t[1]||v[2]!==t[2])return null;const r={endianness:t[3],glType:t[4],glTypeSize:t[5],glFormat:t[6],glInternalFormat:t[7],glBaseInternalFormat:t[8],pixelWidth:t[9],pixelHeight:t[10],pixelDepth:t[11],numberOfArrayElements:t[12],numberOfFaces:t[13],numberOfMipmapLevels:t[14],bytesOfKeyValueData:t[15]};if(r.pixelDepth>1)return null;if(0!==r.numberOfArrayElements)return null;const a=w[r.glInternalFormat];if(void 0===a)return null;let n=16+r.bytesOfKeyValueData/4;const s=r.numberOfFaces>1,l=[];for(let p=0;p<(r.numberOfMipmapLevels||1);p++){const r=t[n++];s&&l.push([]);const u=s?l[p]:l;for(let t=0;t<(s?6:1);++t)u.push((i=e,o=4*n,m=r,a===y?new Uint32Array(i,o,m/4):new Uint8Array(i,o,m))),n+=r+3>>2}var i,o,m;return{format:a,width:r.pixelWidth,height:r.pixelHeight,levels:l,cubemap:s}}}export{A as KtxParser};
