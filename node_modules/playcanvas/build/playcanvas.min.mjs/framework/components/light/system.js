import{Color as e}from"../../../core/math/color.js";import{Vec2 as o}from"../../../core/math/vec2.js";import{LIGHTSHAPE_PUNCTUAL as t}from"../../../scene/constants.js";import{Light as n,lightTypes as r}from"../../../scene/light.js";import{ComponentSystem as s}from"../system.js";import{LightComponent as a,_lightProps as i}from"./component.js";import{LightComponentData as c}from"./data.js";class l extends s{constructor(e){super(e),this.id="light",this.ComponentType=a,this.DataType=c,this.on("beforeremove",this._onRemoveComponent,this)}initializeComponentData(s,a){const c=i,l={};for(let e=0,o=c.length;e<o;e++){const o=c[e];l[o]=a[o]}l.type||(l.type=s.data.type),s.data.type=l.type,l.layers&&Array.isArray(l.layers)&&(l.layers=l.layers.slice(0)),l.color&&Array.isArray(l.color)&&(l.color=new e(l.color[0],l.color[1],l.color[2])),l.cookieOffset&&l.cookieOffset instanceof Array&&(l.cookieOffset=new o(l.cookieOffset[0],l.cookieOffset[1])),l.cookieScale&&l.cookieScale instanceof Array&&(l.cookieScale=new o(l.cookieScale[0],l.cookieScale[1])),l.enable&&(console.warn("WARNING: enable: Property is deprecated. Set enabled property instead."),l.enabled=l.enable),l.shape||(l.shape=t);const p=new n(this.app.graphicsDevice);p.type=r[l.type],p._node=s.entity,p._scene=this.app.scene,s.data.light=p,super.initializeComponentData(s,l,c)}_onRemoveComponent(e,o){o.onRemove()}cloneComponent(e,o){const t=e.light,n=[];let r;const s=i;for(let e=0;e<s.length;e++)r=s[e],"light"!==r&&(t[r]&&t[r].clone?n[r]=t[r].clone():n[r]=t[r]);return this.addComponent(o,n)}changeType(e,o,t){o!==t&&(e.light.type=r[t])}}export{l as LightComponentSystem};
