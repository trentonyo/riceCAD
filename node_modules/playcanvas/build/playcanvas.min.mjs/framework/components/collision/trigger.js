import{BODYFLAG_NORESPONSE_OBJECT as t,BODYGROUP_TRIGGER as i,BODYMASK_NOT_STATIC as e,BODYSTATE_ACTIVE_TAG as s,BODYSTATE_DISABLE_SIMULATION as o}from"../rigid-body/constants.js";let n,r,a;class d{constructor(t,i,e){this.entity=i.entity,this.component=i,this.app=t,"undefined"==typeof Ammo||n||(n=new Ammo.btVector3,r=new Ammo.btQuaternion,a=new Ammo.btTransform),this.initialize(e)}initialize(i){const e=this.entity,s=i.shape;if(s&&"undefined"!=typeof Ammo){e.trigger&&e.trigger.destroy();const i=1,o=e.getPosition(),d=e.getRotation();n.setValue(o.x,o.y,o.z),r.setValue(d.x,d.y,d.z,d.w),a.setOrigin(n),a.setRotation(r);const y=this.app.systems.rigidbody.createBody(i,s,a);y.setRestitution(0),y.setFriction(0),y.setDamping(0,0),n.setValue(0,0,0),y.setLinearFactor(n),y.setAngularFactor(n),y.setCollisionFlags(y.getCollisionFlags()|t),y.entity=e,this.body=y,this.component.enabled&&e.enabled&&this.enable()}}destroy(){const t=this.body;t&&(this.disable(),this.app.systems.rigidbody.destroyBody(t))}_getEntityTransform(t){const i=this.entity.getPosition(),e=this.entity.getRotation();n.setValue(i.x,i.y,i.z),r.setValue(e.x,e.y,e.z,e.w),t.setOrigin(n),t.setRotation(r)}updateTransform(){this._getEntityTransform(a);const t=this.body;t.setWorldTransform(a),t.activate()}enable(){const t=this.body;if(!t)return;const o=this.app.systems;o.rigidbody.addBody(t,i,e^i),o.rigidbody._triggers.push(this),t.forceActivationState(s),this.updateTransform()}disable(){const t=this.body;if(!t)return;const i=this.app.systems,e=i.rigidbody._triggers.indexOf(this);e>-1&&i.rigidbody._triggers.splice(e,1),i.rigidbody.removeBody(t),t.forceActivationState(o)}}export{d as Trigger};
