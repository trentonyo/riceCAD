import{path as t}from"../../core/path.js";import"../../core/tracing.js";import{Http as o,http as e}from"../../platform/net/http.js";import{hasAudioContext as n}from"../../platform/audio/capabilities.js";import{Sound as r}from"../../platform/sound/sound.js";const i=function(){if("undefined"==typeof window)return!1;const t=window.navigator.userAgent,o=t.indexOf("MSIE ");if(o>0)return parseInt(t.substring(o+5,t.indexOf(".",o)),10);if(t.indexOf("Trident/")>0){const o=t.indexOf("rv:");return parseInt(t.substring(o+3,t.indexOf(".",o)),10)}return!1}(),s=[".ogg",".mp3",".wav",".mp4a",".m4a",".mp4",".aac",".opus"];class a{constructor(t){this.handlerType="audio",this.manager=t.soundManager,this.maxRetries=0}_isSupported(o){const e=t.getExtension(o);return s.indexOf(e)>-1}load(t,o){"string"==typeof t&&(t={load:t,original:t});const e=function(t){o(null,new r(t))},n=function(e){let n="Error loading audio url: "+t.original;e&&(n+=": "+(e.message||e)),console.warn(n),o(n)};if(this._createSound){if(!this._isSupported(t.original))return void n(`Audio format for ${t.original} not supported`);this._createSound(t.load,e,n)}else n(null)}open(t,o){return o}patch(t,o){}_createSound(t,r,s){if(n()){const n=this.manager;if(!n.context)return void s("Audio manager has no audio context");const i={retry:this.maxRetries>0,maxRetries:this.maxRetries};(t.startsWith("blob:")||t.startsWith("data:"))&&(i.responseType=o.ResponseType.ARRAY_BUFFER),e.get(t,i,(function(t,o){t?s(t):n.context.decodeAudioData(o,r,s)}))}else{let o=null;try{o=new Audio}catch(t){return void s("No support for Audio element")}i&&document.body.appendChild(o);const e=function t(){o.removeEventListener("canplaythrough",t),i&&document.body.removeChild(o),r(o)};o.onerror=function(){o.onerror=null,i&&document.body.removeChild(o),s()},o.addEventListener("canplaythrough",e),o.src=t}}}export{a as AudioHandler};
