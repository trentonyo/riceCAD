import{ShaderUtils as e}from"../../../platform/graphics/shader-utils.js";import{BLEND_NORMAL as a,BLEND_ADDITIVE as n,BLEND_MULTIPLICATIVE as r}from"../../constants.js";import{shaderChunks as t}from"../chunks/chunks.js";import{gammaCode as i,tonemapCode as l}from"./common.js";const o={generateKey:function(e){let a="particle";for(const n in e)e.hasOwnProperty(n)&&(a+=e[n]);return a},_animTex:function(e){let a="";return a+=e.animTexLoop?t.particleAnimFrameLoopVS:t.particleAnimFrameClampVS,a+=t.particleAnimTexVS,a},createShaderDefinition:function(o,c){let m="#define PARTICLE\n",p="#define VERTEXSHADER\n";c.mesh&&(p+="#define USE_MESH\n"),c.localSpace&&(p+="#define LOCAL_SPACE\n"),c.screenSpace&&(p+="#define SCREEN_SPACE\n"),c.animTex&&(p+="\nuniform vec2 animTexTilesParams;\n"),c.animTex&&(p+="\nuniform vec4 animTexParams;\n"),c.animTex&&(p+="\nuniform vec2 animTexIndexParams;\n"),2===c.normal&&(p+="\nvarying mat3 ParticleMat;\n"),1===c.normal&&(p+="\nvarying vec3 Normal;\n"),c.soft&&(p+="\nvarying float vDepth;\n");const S=c.customFace?t.particle_customFaceVS:t.particle_billboardVS;return c.useCpu?(c.soft>0&&(p+=t.screenDepthPS),p+=t.particle_cpuVS,c.localSpace&&(p+=t.particle_localShiftVS),c.animTex&&(p+=this._animTex(c)),c.alignToMotion&&(p+=t.particle_pointAlongVS),p+=c.mesh?t.particle_meshVS:S,1===c.normal&&(p+=t.particle_normalVS),2===c.normal&&(p+=t.particle_TBNVS),c.stretch>0&&(p+=t.particle_stretchVS),p+=t.particle_cpu_endVS,c.soft>0&&(p+=t.particle_softVS)):(p+=t.particle_initVS,p+=c.pack8?t.particleInputRgba8PS:t.particleInputFloatPS,c.soft>0&&(p+=t.screenDepthPS),p+=t.particleVS,c.localSpace&&(p+=t.particle_localShiftVS),c.animTex&&(p+=this._animTex(c)),c.wrap&&(p+=t.particle_wrapVS),c.alignToMotion&&(p+=t.particle_pointAlongVS),p+=c.mesh?t.particle_meshVS:S,1===c.normal&&(p+=t.particle_normalVS),2===c.normal&&(p+=t.particle_TBNVS),c.stretch>0&&(p+=t.particle_stretchVS),p+=t.particle_endVS,c.soft>0&&(p+=t.particle_softVS)),p+="}\n",c.normal>0&&(1===c.normal?m+="\nvarying vec3 Normal;\n":2===c.normal&&(m+="\nvarying mat3 ParticleMat;\n"),m+="\nuniform vec3 lightCube[6];\n"),c.soft&&(m+="\nvarying float vDepth;\n"),0===c.normal&&"none"===c.fog&&(c.srgb=!1),m+=t.decodePS,m+=i(c.gamma),m+=l(c.toneMap),"linear"===c.fog?m+=t.fogLinearPS:"exp"===c.fog?m+=t.fogExpPS:"exp2"===c.fog?m+=t.fogExp2PS:m+=t.fogNonePS,2===c.normal&&(m+="\nuniform sampler2D normalMap;\n"),c.soft>0&&(m+=t.screenDepthPS),m+=t.particlePS,c.soft>0&&(m+=t.particle_softPS),1===c.normal&&(m+="\nvec3 normal = Normal;\n"),2===c.normal&&(m+=t.particle_normalMapPS),c.normal>0&&(m+=c.halflambert?t.particle_halflambertPS:t.particle_lambertPS),c.normal>0&&(m+=t.particle_lightingPS),c.blend===a?m+=t.particle_blendNormalPS:c.blend===n?m+=t.particle_blendAddPS:c.blend===r&&(m+=t.particle_blendMultiplyPS),m+=t.particle_endPS,e.createDefinition(o,{vertexCode:p,fragmentCode:m})}};export{o as particle};
