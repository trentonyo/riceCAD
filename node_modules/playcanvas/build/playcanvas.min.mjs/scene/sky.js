import{CULLFACE_FRONT as e}from"../platform/graphics/constants.js";import{SHADER_FORWARDHDR as s,GAMMA_SRGBHDR as t,GAMMA_NONE as a,TONEMAP_LINEAR as r,LAYERID_SKYBOX as n}from"./constants.js";import{createBox as o}from"./procedural.js";import{GraphNode as i}from"./graph-node.js";import{Material as m}from"./materials/material.js";import{MeshInstance as p}from"./mesh-instance.js";import{skybox as c}from"./shader-lib/programs/skybox.js";import{getProgramLibrary as y}from"./shader-lib/get-program-library.js";class h{constructor(h,g,l){this.meshInstance=void 0;const b=new m;b.getShaderVariant=function(e,n,o,i,m,p,b,u){const d=y(h);return d.register("skybox",c),l.cubemap?d.getProgram("skybox",{type:"cubemap",encoding:l.encoding,useIntensity:1!==g.skyboxIntensity||g.physicalUnits,mip:l.fixCubemapSeams?g.skyboxMip:0,fixSeams:l.fixCubemapSeams,gamma:m===s?g.gammaCorrection?t:a:g.gammaCorrection,toneMapping:m===s?r:g.toneMapping}):d.getProgram("skybox",{type:"envAtlas",encoding:l.encoding,useIntensity:1!==g.skyboxIntensity||g.physicalUnits,gamma:m===s?g.gammaCorrection?t:a:g.gammaCorrection,toneMapping:m===s?r:g.toneMapping})},l.cubemap?b.setParameter("texture_cubeMap",l):(b.setParameter("texture_envAtlas",l),b.setParameter("mipLevel",g._skyboxMip)),b.cull=e,b.depthWrite=!1;const u=g.layers.getLayerById(n);if(u){const e=new i("Skybox"),s=o(h),t=new p(s,b,e);this.meshInstance=t,t.cull=!1,t._noDepthDrawGl1=!0,t.pick=!1,u.addMeshInstances([t]),this.skyLayer=u}}destroy(){this.meshInstance&&(this.skyLayer&&this.skyLayer.removeMeshInstances([this.meshInstance]),this.meshInstance.destroy(),this.meshInstance=null)}}export{h as Sky};
