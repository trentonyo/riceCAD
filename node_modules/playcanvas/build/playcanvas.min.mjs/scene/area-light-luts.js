import{FloatPacking as t}from"../core/math/float-packing.js";import{Texture as e}from"../platform/graphics/texture.js";import{DeviceCache as r}from"../platform/graphics/device-cache.js";import{ADDRESS_CLAMP_TO_EDGE as o,TEXTURETYPE_DEFAULT as s,FILTER_LINEAR as a,FILTER_NEAREST as n,PIXELFORMAT_R8_G8_B8_A8 as l,PIXELFORMAT_RGBA32F as c,PIXELFORMAT_RGBA16F as i}from"../platform/graphics/constants.js";class u{constructor(t,e){this.texture0=t,this.texture1=e}destroy(){var t,e;null==(t=this.texture0)||t.destroy(),null==(e=this.texture1)||e.destroy()}}const p=new r;class f{static createTexture(t,r,l,c=""){return new e(t,{width:l,height:l,format:r,addressU:o,addressV:o,type:s,magFilter:a,minFilter:n,anisotropy:1,name:`AreaLightLUT${c}`})}static applyTextures(t,e,r){p.remove(t),p.get(t,(()=>new u(e,e===r?null:r))),t.scope.resolve("areaLightsLutTex1").setValue(e),t.scope.resolve("areaLightsLutTex2").setValue(r)}static createPlaceholder(t){const e=f.createTexture(t,l,2,"placeholder");e.lock().fill(0),e.unlock(),f.applyTextures(t,e,e)}static set(e,r,o){function s(t,e,r){const o=f.createTexture(t,r,64);return o.lock().set(e),o.unlock(),o.upload(),o}function a(t,e,r){const o=t.length,s=new Float32Array(o);for(let a=0;a<o;a++){const o=a%4;s[a]=(t[a]+e[o])*r[o]}return s}function n(e){const r=e.length,o=new Uint16Array(r),s=t.float2Half;for(let t=0;t<r;t++)o[t]=s(e[t]);return o}function l(t){const e=t.length,r=new Uint8ClampedArray(e);for(let o=0;o<e;o++)r[o]=255*t[o];return r}const u=r,p=o;let h,m;const g=e.areaLightLutFormat;if(g===c)h=u,m=p;else if(g===i)h=n(u),m=n(p);else{const t=[-.306897,0,0,0],e=[1.442787,1,1,1];h=l(a(u,[0,.2976,.01381,0],[.999,3.08737,1.6546,.603249])),m=l(a(p,t,e))}const x=s(e,h,g),d=s(e,m,g);f.applyTextures(e,x,d)}}export{f as AreaLightLuts};
