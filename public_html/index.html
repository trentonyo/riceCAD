<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>riceCAD</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="../playcanvas-latest.js"></script>
    </head>
    <body>
        <script src="materials.js"></script>
        <table>
            <tr>
                <td id="editor_title" colspan="3">riceCAD v0.0.0</td>
            </tr>
            <tr>
                <td id="editor_lpanel">Left panel</td>
                <td id="editor">        
                    <canvas id="application-canvas" width="800" height="600"></canvas>
                </td>
                <td id="editor_rpanel">Right panel</td>
            </tr>
            <tr>
                <td id="edit_bpanel" colspan="3">Bottom panel</td>
            </tr>
        </table>
        
        <script>
            var canvas = document.getElementById("application-canvas");
            var app = new pc.Application(canvas);
            app.start();
            
            app.setCanvasFillMode(pc.FILLMODE_NONE);
            app.setCanvasResolution(pc.RESOLUTION_AUTO);

            var camera = new pc.Entity();
            camera.addComponent("camera", {
                clearColor: new pc.Color(0.0, 1.0, 1.0)
            });

            app.root.addChild(camera);

            function cameraToOrigin()
            {
                camera.setRotation(-0.26, 0, 0, 0.97);

                camera.setPosition(0, 10, 10);
            }

            cameraToOrigin();

            //                 ri     away
            app.scene.ambientLight = new pc.Color(0.5, 0.5, 0.5);
            var light = new pc.Entity();
            light.addComponent('light');
            app.root.addChild(light);
            light.rotate(45, 0, 0);
            
            var workingPlane = new pc.Entity();
            workingPlane.addComponent("model", { type: "plane" });
            workingPlane.rotate(0, 0, 0);
            workingPlane.setPosition(5, 0, 5);
            workingPlane.setLocalScale(10, 0, 10);
            app.root.addChild(workingPlane);

            function updateWorkingPlane(width, depth)
            {
                workingPlane.setPosition(width / 2, 0, depth / 2);
                workingPlane.setLocalScale(width, 0, depth);
            }

            //Camera and scene initialized
    

            function generateMatrix(width, depth, height)
            {
                var output = [];

                for (var i = 0; i < height; i++)
                {
                    output.push([]);
                    for (var j = 0; j < depth; j++)
                    {
                        output[i].push([]);
                        for (var k = 0; k < depth; k++)
                        {
                            output[i][j].push(0);
                        }
                    }
                }

                return output;
            }

            function transferMatrices(first, fWidth, fDepth, fHeight, second)
            {

            }

            //Initialize matrix
            let width = 16;
            let depth = 16;
            let height = 16;

            matrix = generateMatrix(width, depth, height);
            updateWorkingPlane(width, depth);

            /*var matrix = [];

            for (var i = 0; i < height; i++)
            {
                matrix.push([]);
                for (var j = 0; j < depth; j++)
                {
                    matrix[i].push([]);
                    for (var k = 0; k < depth; k++)
                    {
                        matrix[i][j].push(0);
                    }
                }
            }*/
            
            class Block 
            {
                constructor(x, y, z, b)
                {
                    this.x = x;
                    this.y = y;
                    this.z = z;
                    this.b = b;
                    
                    if(b > 0)
                    {
                        var e = new pc.Entity();
                        e.addComponent("model", { type: "box", isStatic: true });
                        
                        switch (b) {
                            case blackCode:
                                e.model.model.meshInstances[0].material = blackMaterial;
                                break;
                            case redCode:
                                e.model.model.meshInstances[0].material = redMaterial;
                                break;
                            case greenCode:
                                e.model.model.meshInstances[0].material = greenMaterial;
                                break;
                            case brownCode:
                                e.model.model.meshInstances[0].material = brownMaterial;
                                break;
                            case blueCode:
                                e.model.model.meshInstances[0].material = blueMaterial;
                                break;
                            case purpleCode:
                                e.model.model.meshInstances[0].material = purpleMaterial;
                                break;
                            case cyanCode:
                                e.model.model.meshInstances[0].material = cyanMaterial;
                                break;
                            case lightGrayCode:
                                e.model.model.meshInstances[0].material = lightGrayMaterial;
                                break;
                            case grayCode:
                                e.model.model.meshInstances[0].material = grayMaterial;
                                break;
                            case pinkCode:
                                e.model.model.meshInstances[0].material = pinkMaterial;
                                break;
                            case limeCode:
                                e.model.model.meshInstances[0].material = limeMaterial;
                                break;
                            case yellowCode:
                                e.model.model.meshInstances[0].material = yellowMaterial;
                                break;
                            case lightBlueCode:
                                e.model.model.meshInstances[0].material = lightBlueMaterial;
                                break;
                            case magentaCode:
                                e.model.model.meshInstances[0].material = magentaMaterial;
                                break;
                            case orangeCode:
                                e.model.model.meshInstances[0].material = orangeMaterial;
                                break;
                            case whiteCode:
                                e.model.model.meshInstances[0].material = whiteMaterial;
                                break;
                            default:
                                e.model.model.meshInstances[0].material = whiteMaterial;
                        }

                        app.root.addChild(e);
                        e.setPosition(x + 0.5, y + 0.5, z + 0.5);

                        this.e = e;
                    }
                }
            }

            function addBlock(x, y, z, b)
            {
                var toAdd = new Block(x, y, z, b);

                matrix[z][y][x] = toAdd;
            }
 
            addBlock(0, 0, 0, blackCode);
            addBlock(0, 0, 1, redCode);
            addBlock(0, 0, 2, greenCode);
            addBlock(0, 0, 3, brownCode);
            addBlock(0, 0, 4, blueCode);
            addBlock(0, 0, 5, purpleCode);
            addBlock(0, 0, 6, cyanCode);
            addBlock(0, 0, 7, lightGrayCode);
            addBlock(0, 0, 8, grayCode);
            addBlock(0, 0, 9, pinkCode);
            addBlock(0, 0, 10, cyanCode);
            addBlock(0, 0, 11, lightGrayCode);
            addBlock(0, 0, 12, grayCode);
            addBlock(0, 0, 13, pinkCode);
            addBlock(0, 0, 14, cyanCode);
            addBlock(0, 0, 15, lightGrayCode);

            console.log(matrix);

            for (var z = 0; z < matrix.length; z++) 
            {
                for (var y = 0; y < matrix[z].length; y++) 
                {
                    for (var x = 0; x < matrix[z][y].length; x++) 
                    {
                        //Check if there is a block in the first place
                        if (typeof(matrix[z][y][x]) === 'undefined') 
                        {
                            //There is NOT A block here
                        }
                        else
                        {
                            //There is a block here
                        }
                    }
                }
            }

            const mouse = new pc.Mouse(document.body);
            mouse.disableContextMenu();

            const keyboard = new pc.Keyboard(document.body);

            var x = 0;
            var y = 0;

            var rotateSpeed = 0.1;
            var moveSpeed = 0.05;
            var zoomModifier = 5;

            mouse.on("mousemove", function (event) {
                if (event.buttons[pc.MOUSEBUTTON_LEFT])
                {
                    x += event.dx;
                    y += event.dy;

                    camera.setLocalEulerAngles(rotateSpeed * y, rotateSpeed * x, 0);
                }
            });
            mouse.on("mousewheel", function (event) {

                camera.translateLocal(0, 0, moveSpeed * event.wheelDelta * zoomModifier);

            });


            app.on("update", function () {
                if (keyboard.isPressed(pc.KEY_UP)) {
                    camera.rotate(rotateSpeed, 0, 0);
                }
                if (keyboard.isPressed(pc.KEY_DOWN)) {
                    camera.rotate(-rotateSpeed, 0, 0);
                }
                if (keyboard.isPressed(pc.KEY_LEFT)) {
                    camera.rotate(0, rotateSpeed, 0);
                }
                if (keyboard.isPressed(pc.KEY_RIGHT)) {
                    camera.rotate(0, -rotateSpeed, 0);
                }
                if (keyboard.isPressed(pc.KEY_W)) {
                    camera.translate(0, moveSpeed, 0);
                }
                if (keyboard.isPressed(pc.KEY_S)) {
                    camera.translate(0, -moveSpeed, 0);
                }
                if (keyboard.isPressed(pc.KEY_A)) {
                    camera.translateLocal(-moveSpeed, 0, 0);
                }
                if (keyboard.isPressed(pc.KEY_D)) {
                    camera.translateLocal(moveSpeed, 0, 0);
                }
                if (keyboard.isPressed(pc.KEY_0))
                {
                    cameraToOrigin();
                }
            });

        </script>
    </body>
</html>
